<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-04-25">
<meta name="keywords" content="ml">
<meta name="description" content="blue book">

<title>Random Thoughts - Kaggle - Blue Book for Bulldozers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-20316028', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Random Thoughts - Kaggle - Blue Book for Bulldozers">
<meta property="og:description" content="blue book">
<meta property="og:image" content="images/2022-04-25-bluebook-for-bulldozers.jpeg">
<meta property="og:site-name" content="Random Thoughts">
<meta name="twitter:title" content="Random Thoughts - Kaggle - Blue Book for Bulldozers">
<meta name="twitter:description" content="blue book">
<meta name="twitter:image" content="images/2022-04-25-bluebook-for-bulldozers.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Random Thoughts</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hassaanbinaslam/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hassaanbinaslam/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hassaanbinaslam"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a>
  <ul class="collapse">
  <li><a href="#environment-details" id="toc-environment-details" class="nav-link" data-scroll-target="#environment-details">Environment Details</a></li>
  <li><a href="#prepare-the-dataset" id="toc-prepare-the-dataset" class="nav-link" data-scroll-target="#prepare-the-dataset">Prepare the dataset</a>
  <ul class="collapse">
  <li><a href="#download-the-dataset-files" id="toc-download-the-dataset-files" class="nav-link" data-scroll-target="#download-the-dataset-files">Download the dataset files</a></li>
  <li><a href="#take-an-initial-look-at-the-training-data" id="toc-take-an-initial-look-at-the-training-data" class="nav-link" data-scroll-target="#take-an-initial-look-at-the-training-data">Take an initial look at the training data</a></li>
  </ul></li>
  <li><a href="#baseline-model" id="toc-baseline-model" class="nav-link" data-scroll-target="#baseline-model">Baseline Model</a></li>
  <li><a href="#cleaning-up" id="toc-cleaning-up" class="nav-link" data-scroll-target="#cleaning-up">Cleaning up</a>
  <ul class="collapse">
  <li><a href="#remove-id-columns" id="toc-remove-id-columns" class="nav-link" data-scroll-target="#remove-id-columns">Remove ID columns</a></li>
  </ul></li>
  <li><a href="#fix-data-types-and-data-issues" id="toc-fix-data-types-and-data-issues" class="nav-link" data-scroll-target="#fix-data-types-and-data-issues">Fix data types and data issues</a>
  <ul class="collapse">
  <li><a href="#numerical-features" id="toc-numerical-features" class="nav-link" data-scroll-target="#numerical-features">Numerical features</a></li>
  <li><a href="#datetime-feature" id="toc-datetime-feature" class="nav-link" data-scroll-target="#datetime-feature">Datetime feature</a></li>
  <li><a href="#categorical-features" id="toc-categorical-features" class="nav-link" data-scroll-target="#categorical-features">Categorical features</a></li>
  </ul></li>
  <li><a href="#dealing-with-missing-data" id="toc-dealing-with-missing-data" class="nav-link" data-scroll-target="#dealing-with-missing-data">Dealing with missing data</a>
  <ul class="collapse">
  <li><a href="#replace-missing-numeric-values" id="toc-replace-missing-numeric-values" class="nav-link" data-scroll-target="#replace-missing-numeric-values">Replace missing numeric values</a></li>
  <li><a href="#replace-missing-categorical-values" id="toc-replace-missing-categorical-values" class="nav-link" data-scroll-target="#replace-missing-categorical-values">Replace missing categorical values</a></li>
  </ul></li>
  <li><a href="#preprocessed-dataset" id="toc-preprocessed-dataset" class="nav-link" data-scroll-target="#preprocessed-dataset">Preprocessed dataset</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#fiproductclassdesc" id="toc-fiproductclassdesc" class="nav-link" data-scroll-target="#fiproductclassdesc">fiProductClassDesc</a></li>
  <li><a href="#hydralics_flow" id="toc-hydralics_flow" class="nav-link" data-scroll-target="#hydralics_flow">Hydralics_Flow</a></li>
  <li><a href="#enclosure" id="toc-enclosure" class="nav-link" data-scroll-target="#enclosure">Enclosure</a></li>
  <li><a href="#saledate" id="toc-saledate" class="nav-link" data-scroll-target="#saledate">saledate</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Kaggle - Blue Book for Bulldozers</h1>
  <div class="quarto-categories">
    <div class="quarto-category">ml</div>
  </div>
  </div>

<div>
  <div class="description">
    blue book
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 25, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><img src="images/2022-04-25-bluebook-for-bulldozers.jpeg" class="img-fluid"></p>
<section id="about" class="level1">
<h1>About</h1>
<p>This notebook explores and builds a model for a bulldozer auction prices dataset from the <a href="https://www.kaggle.com/c/bluebook-for-bulldozers">Kaggle competition</a>.</p>
<section id="environment-details" class="level2">
<h2 class="anchored" data-anchor-id="environment-details">Environment Details</h2>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> platform <span class="im">import</span> python_version</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> sklearn, numpy, matplotlib, pandas</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="bu">print</span>(<span class="st">"python=="</span> <span class="op">+</span> python_version())</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="bu">print</span>(<span class="st">"sklearn=="</span> <span class="op">+</span> sklearn.__version__)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="bu">print</span>(<span class="st">"numpy=="</span> <span class="op">+</span> numpy.__version__)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="bu">print</span>(<span class="st">"pandas=="</span> <span class="op">+</span> pandas.__version__)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="bu">print</span>(<span class="st">"matplotlib=="</span> <span class="op">+</span> matplotlib.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>python==3.8.8
sklearn==1.0.2
numpy==1.20.1
pandas==1.2.3
matplotlib==3.5.1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">##</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># Notebook settings</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># display all dataframe columns </span></span>
<span id="cb3-6"><a href="#cb3-6"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prepare-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-dataset">Prepare the dataset</h2>
<section id="download-the-dataset-files" class="level3">
<h3 class="anchored" data-anchor-id="download-the-dataset-files">Download the dataset files</h3>
<ul>
<li>Train.zip and extract <code>Train.csv</code>. This is our training dataset.</li>
<li><code>Valid.csv</code>. This is our validation dataset.</li>
<li><code>Test.csv</code>. This is our test dataset.</li>
</ul>
<p>This dataset can be downloaded from the Kaggle competition site, and extracted files should be placed under folder <code>./datasets/2022-04-35-bluebook-for-bulldozers/</code>. These files are made available with this notebook in the <a href="https://github.com/hassaanbinaslam/myblog/tree/master/_notebooks/datasets/2022-04-35-bluebook-for-bulldozers">GitHub repository</a> and can be downloaded from there too. If you are using <code>Git</code> then it will not download them from the remote server as they exceed <code>50MB</code> limit (<a href="https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github#file-size-limits">read more here</a>). For working with large files Git needs an extra extension to work with them called <a href="https://git-lfs.github.com/">git-lfs</a>.</p>
<p>Follow the steps from Git-LFS site to install it on the system. To install it directly from the notebook (running on Linux) use these commands</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## </span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># download and install git-lfs. Uncomment them as execute.</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># !curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.rpm.sh | sudo bash</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># !sudo yum install git-lfs -y</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co"># !git lfs install</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once <code>git-lfs</code> is installed use the below command to download large files from the remote server (GitHub).</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">##</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># uncomment them and execute</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># git lfs fetch --all</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># git lfs checkout</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="take-an-initial-look-at-the-training-data" class="level3">
<h3 class="anchored" data-anchor-id="take-an-initial-look-at-the-training-data">Take an initial look at the training data</h3>
<p>Load the training data and look for the following information * column names * column data types * how much data is missing? * sample data elements</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">##</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># load the training dataset</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>dataset_path <span class="op">=</span> <span class="st">'datasets/2022-04-35-bluebook-for-bulldozers/'</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>df_raw <span class="op">=</span> pd.read_csv(dataset_path<span class="op">+</span><span class="st">'Train.csv'</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>df <span class="op">=</span> df_raw.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">##</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># print training dataset summary information</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>df_info <span class="op">=</span> pd.DataFrame()</span>
<span id="cb7-4"><a href="#cb7-4"></a>df_info[<span class="st">'sample'</span>] <span class="op">=</span> df.iloc[<span class="dv">0</span>]</span>
<span id="cb7-5"><a href="#cb7-5"></a>df_info[<span class="st">'data_type'</span>] <span class="op">=</span> df.dtypes</span>
<span id="cb7-6"><a href="#cb7-6"></a>df_info[<span class="st">'percent_missing'</span>] <span class="op">=</span> <span class="dv">100</span><span class="op">*</span>df.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df)</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="bu">print</span>(<span class="ss">f"Total features: </span><span class="sc">{</span><span class="bu">len</span>(df.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a>df_info.sort_values(<span class="st">'percent_missing'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sample</th>
      <th>data_type</th>
      <th>percent_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SalesID</th>
      <td>1139246</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>state</th>
      <td>Alabama</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fiProductClassDesc</th>
      <td>Wheel Loader - 110.0 to 120.0 Horsepower</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fiBaseModel</th>
      <td>521</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>fiModelDesc</th>
      <td>521D</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ProductGroup</th>
      <td>WL</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>saledate</th>
      <td>11/16/2006 0:00</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>datasource</th>
      <td>121</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ModelID</th>
      <td>3157</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>MachineID</th>
      <td>999089</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>SalePrice</th>
      <td>66000</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>YearMade</th>
      <td>2004</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ProductGroupDesc</th>
      <td>Wheel Loader</td>
      <td>object</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Enclosure</th>
      <td>EROPS w AC</td>
      <td>object</td>
      <td>0.081022</td>
    </tr>
    <tr>
      <th>auctioneerID</th>
      <td>3.0</td>
      <td>float64</td>
      <td>5.019882</td>
    </tr>
    <tr>
      <th>Hydraulics</th>
      <td>2 Valve</td>
      <td>object</td>
      <td>20.082269</td>
    </tr>
    <tr>
      <th>fiSecondaryDesc</th>
      <td>D</td>
      <td>object</td>
      <td>34.201558</td>
    </tr>
    <tr>
      <th>Coupler</th>
      <td>None or Unspecified</td>
      <td>object</td>
      <td>46.662013</td>
    </tr>
    <tr>
      <th>Forks</th>
      <td>None or Unspecified</td>
      <td>object</td>
      <td>52.115425</td>
    </tr>
    <tr>
      <th>ProductSize</th>
      <td>NaN</td>
      <td>object</td>
      <td>52.545964</td>
    </tr>
    <tr>
      <th>Transmission</th>
      <td>NaN</td>
      <td>object</td>
      <td>54.320972</td>
    </tr>
    <tr>
      <th>Ride_Control</th>
      <td>None or Unspecified</td>
      <td>object</td>
      <td>62.952696</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter</th>
      <td>68.0</td>
      <td>float64</td>
      <td>64.408850</td>
    </tr>
    <tr>
      <th>Drive_System</th>
      <td>NaN</td>
      <td>object</td>
      <td>73.982923</td>
    </tr>
    <tr>
      <th>Ripper</th>
      <td>NaN</td>
      <td>object</td>
      <td>74.038766</td>
    </tr>
    <tr>
      <th>Undercarriage_Pad_Width</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.102026</td>
    </tr>
    <tr>
      <th>Thumb</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.247616</td>
    </tr>
    <tr>
      <th>Stick_Length</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.265067</td>
    </tr>
    <tr>
      <th>Pattern_Changer</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.265067</td>
    </tr>
    <tr>
      <th>Grouser_Type</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.281271</td>
    </tr>
    <tr>
      <th>Track_Type</th>
      <td>NaN</td>
      <td>object</td>
      <td>75.281271</td>
    </tr>
    <tr>
      <th>Tire_Size</th>
      <td>None or Unspecified</td>
      <td>object</td>
      <td>76.386912</td>
    </tr>
    <tr>
      <th>Travel_Controls</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.097476</td>
    </tr>
    <tr>
      <th>Blade_Type</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.097725</td>
    </tr>
    <tr>
      <th>Turbocharged</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.271985</td>
    </tr>
    <tr>
      <th>Stick</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.271985</td>
    </tr>
    <tr>
      <th>Pad_Type</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.271985</td>
    </tr>
    <tr>
      <th>Backhoe_Mounting</th>
      <td>NaN</td>
      <td>object</td>
      <td>80.387161</td>
    </tr>
    <tr>
      <th>fiModelDescriptor</th>
      <td>NaN</td>
      <td>object</td>
      <td>82.070676</td>
    </tr>
    <tr>
      <th>UsageBand</th>
      <td>Low</td>
      <td>object</td>
      <td>82.639078</td>
    </tr>
    <tr>
      <th>Differential_Type</th>
      <td>Standard</td>
      <td>object</td>
      <td>82.695918</td>
    </tr>
    <tr>
      <th>Steering_Controls</th>
      <td>Conventional</td>
      <td>object</td>
      <td>82.706388</td>
    </tr>
    <tr>
      <th>fiModelSeries</th>
      <td>NaN</td>
      <td>object</td>
      <td>85.812901</td>
    </tr>
    <tr>
      <th>Coupler_System</th>
      <td>NaN</td>
      <td>object</td>
      <td>89.165971</td>
    </tr>
    <tr>
      <th>Grouser_Tracks</th>
      <td>NaN</td>
      <td>object</td>
      <td>89.189903</td>
    </tr>
    <tr>
      <th>Hydraulics_Flow</th>
      <td>NaN</td>
      <td>object</td>
      <td>89.189903</td>
    </tr>
    <tr>
      <th>Scarifier</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.710190</td>
    </tr>
    <tr>
      <th>Pushblock</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
    <tr>
      <th>Engine_Horsepower</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
    <tr>
      <th>Enclosure_Type</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
    <tr>
      <th>Blade_Width</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
    <tr>
      <th>Blade_Extension</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
    <tr>
      <th>Tip_Control</th>
      <td>NaN</td>
      <td>object</td>
      <td>93.712932</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">##</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># print some unique values against each feature</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="kw">def</span> sniff(df, rows<span class="op">=</span><span class="dv">7</span>):</span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="co">"""</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">    For each column return a set of unique values</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">    """</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    data <span class="op">=</span> {}</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb8-9"><a href="#cb8-9"></a>        data[col] <span class="op">=</span> df[col].unique()[:rows]</span>
<span id="cb8-10"><a href="#cb8-10"></a>    </span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="cf">return</span> pd.DataFrame.from_dict(data, orient<span class="op">=</span><span class="st">'index'</span>).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>sniff(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalesID</th>
      <th>SalePrice</th>
      <th>MachineID</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>saledate</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Enclosure</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Hydraulics_Flow</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1139246</td>
      <td>66000</td>
      <td>999089</td>
      <td>3157</td>
      <td>121</td>
      <td>3.0</td>
      <td>2004</td>
      <td>68.0</td>
      <td>Low</td>
      <td>11/16/2006 0:00</td>
      <td>521D</td>
      <td>521</td>
      <td>D</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wheel Loader - 110.0 to 120.0 Horsepower</td>
      <td>Alabama</td>
      <td>WL</td>
      <td>Wheel Loader</td>
      <td>NaN</td>
      <td>EROPS w AC</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2 Valve</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Standard</td>
      <td>Conventional</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1139248</td>
      <td>57000</td>
      <td>117657</td>
      <td>77</td>
      <td>132</td>
      <td>1.0</td>
      <td>1996</td>
      <td>4640.0</td>
      <td>High</td>
      <td>3/26/2004 0:00</td>
      <td>950FII</td>
      <td>950</td>
      <td>F</td>
      <td>II</td>
      <td>LC</td>
      <td>Medium</td>
      <td>Wheel Loader - 150.0 to 175.0 Horsepower</td>
      <td>North Carolina</td>
      <td>SSL</td>
      <td>Skid Steer Loaders</td>
      <td>Four Wheel Drive</td>
      <td>OROPS</td>
      <td>NaN</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>Extended</td>
      <td>Powershuttle</td>
      <td>None or Unspecified</td>
      <td>Yes</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>No</td>
      <td>Auxiliary</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>Yes</td>
      <td>Sideshift &amp; Tip</td>
      <td>23.5</td>
      <td>NaN</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>Standard</td>
      <td>Steel</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>Double</td>
      <td>None or Unspecified</td>
      <td>PAT</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1139249</td>
      <td>10000</td>
      <td>434808</td>
      <td>7009</td>
      <td>136</td>
      <td>2.0</td>
      <td>2001</td>
      <td>2838.0</td>
      <td>Medium</td>
      <td>2/26/2004 0:00</td>
      <td>226</td>
      <td>226</td>
      <td>NaN</td>
      <td>-6E</td>
      <td>6</td>
      <td>Small</td>
      <td>Skid Steer Loader - 1351.0 to 1601.0 Lb Operat...</td>
      <td>New York</td>
      <td>TEX</td>
      <td>Track Excavators</td>
      <td>Two Wheel Drive</td>
      <td>EROPS</td>
      <td>Yes</td>
      <td>Reversible</td>
      <td>No</td>
      <td>Standard</td>
      <td>Standard</td>
      <td>Yes</td>
      <td>None or Unspecified</td>
      <td>12'</td>
      <td>Low Profile</td>
      <td>Variable</td>
      <td>NaN</td>
      <td>Yes</td>
      <td>Yes</td>
      <td>None or Unspecified</td>
      <td>None or Unspecified</td>
      <td>NaN</td>
      <td>Manual</td>
      <td>Yes</td>
      <td>Yes</td>
      <td>High Flow</td>
      <td>Rubber</td>
      <td>16 inch</td>
      <td>11' 0"</td>
      <td>Hydraulic</td>
      <td>Yes</td>
      <td>Triple</td>
      <td>Yes</td>
      <td>None or Unspecified</td>
      <td>Differential Steer</td>
      <td>Limited Slip</td>
      <td>Command Control</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1139251</td>
      <td>38500</td>
      <td>1026470</td>
      <td>332</td>
      <td>149</td>
      <td>11.0</td>
      <td>2007</td>
      <td>3486.0</td>
      <td>NaN</td>
      <td>5/19/2011 0:00</td>
      <td>PC120-6E</td>
      <td>PC120</td>
      <td>G</td>
      <td>LC</td>
      <td>L</td>
      <td>Large / Medium</td>
      <td>Hydraulic Excavator, Track - 12.0 to 14.0 Metr...</td>
      <td>Texas</td>
      <td>BL</td>
      <td>Backhoe Loaders</td>
      <td>No</td>
      <td>NaN</td>
      <td>None</td>
      <td>Street</td>
      <td>Yes</td>
      <td>None</td>
      <td>Powershift</td>
      <td>None</td>
      <td>None</td>
      <td>14'</td>
      <td>High Profile</td>
      <td>None</td>
      <td>Standard</td>
      <td>None</td>
      <td>Single Shank</td>
      <td>None</td>
      <td>Tip</td>
      <td>13"</td>
      <td>Hydraulic</td>
      <td>None</td>
      <td>None</td>
      <td>None or Unspecified</td>
      <td>None</td>
      <td>32 inch</td>
      <td>15' 9"</td>
      <td>Manual</td>
      <td>No</td>
      <td>Single</td>
      <td>None</td>
      <td>Semi U</td>
      <td>Lever</td>
      <td>No Spin</td>
      <td>Four Wheel Standard</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1139253</td>
      <td>11000</td>
      <td>1057373</td>
      <td>17311</td>
      <td>172</td>
      <td>4.0</td>
      <td>1993</td>
      <td>722.0</td>
      <td>None</td>
      <td>7/23/2009 0:00</td>
      <td>S175</td>
      <td>S175</td>
      <td>E</td>
      <td>-5</td>
      <td>LT</td>
      <td>Mini</td>
      <td>Skid Steer Loader - 1601.0 to 1751.0 Lb Operat...</td>
      <td>Arizona</td>
      <td>TTT</td>
      <td>Track Type Tractors</td>
      <td>All Wheel Drive</td>
      <td>EROPS AC</td>
      <td>None</td>
      <td>Grouser</td>
      <td>None</td>
      <td>None</td>
      <td>None or Unspecified</td>
      <td>None</td>
      <td>None</td>
      <td>13'</td>
      <td>None</td>
      <td>None</td>
      <td>Base + 1 Function</td>
      <td>None</td>
      <td>Multi Shank</td>
      <td>None</td>
      <td>None</td>
      <td>26.5</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>28 inch</td>
      <td>10' 2"</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>VPAT</td>
      <td>Finger Tip</td>
      <td>Locking</td>
      <td>Wheel</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1139255</td>
      <td>26500</td>
      <td>1001274</td>
      <td>4605</td>
      <td>None</td>
      <td>7.0</td>
      <td>2008</td>
      <td>508.0</td>
      <td>None</td>
      <td>12/18/2008 0:00</td>
      <td>310G</td>
      <td>310</td>
      <td>HAG</td>
      <td>III</td>
      <td>CR</td>
      <td>Large</td>
      <td>Backhoe Loader - 14.0 to 15.0 Ft Standard Digg...</td>
      <td>Florida</td>
      <td>MG</td>
      <td>Motor Graders</td>
      <td>None</td>
      <td>NO ROPS</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Hydrostatic</td>
      <td>None</td>
      <td>None</td>
      <td>16'</td>
      <td>None</td>
      <td>None</td>
      <td>Base + 3 Function</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>29.5</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>30 inch</td>
      <td>10' 6"</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Straight</td>
      <td>2 Pedal</td>
      <td>None</td>
      <td>No</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1139256</td>
      <td>21000</td>
      <td>772701</td>
      <td>1937</td>
      <td>None</td>
      <td>99.0</td>
      <td>1000</td>
      <td>11540.0</td>
      <td>None</td>
      <td>8/26/2004 0:00</td>
      <td>790ELC</td>
      <td>790</td>
      <td>B</td>
      <td>-1</td>
      <td>SB</td>
      <td>Compact</td>
      <td>Hydraulic Excavator, Track - 21.0 to 24.0 Metr...</td>
      <td>Illinois</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None or Unspecified</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Autoshift</td>
      <td>None</td>
      <td>None</td>
      <td>&lt;12'</td>
      <td>None</td>
      <td>None</td>
      <td>4 Valve</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>14"</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>22 inch</td>
      <td>9' 10"</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>Angle</td>
      <td>Pedal</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From this first look at the data, we can see that * data is of three types * numeric * string * datetime * some columns have missing data up to 94% e.g.&nbsp;<code>Tip_Control</code> * missing data is represented as * NaN * None or unspecified * some columns’ data types need to be corrected for example * <code>SaleID</code>, <code>MachineID</code> are represented as integers but they are categorical nominal features meaning each value is discrete and has no relation among them * <code>UsageBand</code> is of type string but is a categorical ordinal feature meaning their values cannot be measured but have some order between them * <code>Tire_size</code>, <code>Stick_length</code> are actual measurements and need to be converted to appropriate units</p>
</section>
</section>
<section id="baseline-model" class="level2">
<h2 class="anchored" data-anchor-id="baseline-model">Baseline Model</h2>
<p>It is a good idea to create a baseline model early in the data science project as it can help to establish a baseline for * time it takes to train a model * if the baseline model is taking too much time then we may use a smaller set of the training data for further steps * feature importances * it can help us establish a relationship between features and the target * help us remove features that have no relationship with the target sooner * model performance * we can take this model performance as a baseline, and compare it to see how much cleanup and feature engineering steps improve the model performance</p>
<p>For the baseline model, we would have to rely on numerical features as they don’t require any preprocessing and can be readily used. Some numerical features have too much missing data so we have to be selective here.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">##</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># filter columns that are not string along with their percentage of missing data</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>numerical_features <span class="op">=</span> df_info.loc[df_info.data_type <span class="op">!=</span> <span class="st">'object'</span>].sort_values(<span class="st">'percent_missing'</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>numerical_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sample</th>
      <th>data_type</th>
      <th>percent_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SalesID</th>
      <td>1139246</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>SalePrice</th>
      <td>66000</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>MachineID</th>
      <td>999089</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ModelID</th>
      <td>3157</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>datasource</th>
      <td>121</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>YearMade</th>
      <td>2004</td>
      <td>int64</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>auctioneerID</th>
      <td>3.0</td>
      <td>float64</td>
      <td>5.019882</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter</th>
      <td>68.0</td>
      <td>float64</td>
      <td>64.408850</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From these numerical features <code>MachineHoursCurrentMeter</code> has around 64% missing data. Let’s keep this feature as well for our baseline model.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">##</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># establish target and baseline features</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>target <span class="op">=</span> <span class="st">'SalePrice'</span> <span class="co"># this is the feature we are trying to predict</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>baseline_features <span class="op">=</span> <span class="bu">list</span>(numerical_features.index)</span>
<span id="cb11-5"><a href="#cb11-5"></a>baseline_features.remove(target) <span class="co"># remove target feature form input variables</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>baseline_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['SalesID',
 'MachineID',
 'ModelID',
 'datasource',
 'YearMade',
 'auctioneerID',
 'MachineHoursCurrentMeter']</code></pre>
</div>
</div>
<p>We have established our target and features, and can now train our baseline model. We will use only <code>RandomForrest</code> for this dataset. We have 7 features to learn from so let’s start with <code>n_estimators=70</code></p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a>X, y <span class="op">=</span> df[baseline_features], df[target]</span>
<span id="cb13-4"><a href="#cb13-4"></a>X <span class="op">=</span> X.fillna(<span class="dv">0</span>) <span class="co"># replace missing numerical values with 0</span></span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a>rf <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">70</span>, oob_score<span class="op">=</span><span class="va">True</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a>rf.fit(X, y)</span>
<span id="cb13-8"><a href="#cb13-8"></a>oob_score <span class="op">=</span> rf.oob_score_</span>
<span id="cb13-9"><a href="#cb13-9"></a>oob_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  1.2min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  1.9min finished</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.7901663917842495</code></pre>
</div>
</div>
<p>Besides the OOB score, we can also interpret our model by looking into the trained model trees’ depth and leaves. If OOB score is same but our trees are smaller with fewer nodes then that model is better and more generalized. Larger trees make the model more complex and less generalized. For this let’s create two more functions.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="kw">def</span> rf_n_leaves(rf):</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="co">"""</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">    return the total number of nodes in all the trees of the forrest.</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">    """</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="cf">return</span> <span class="bu">sum</span>(est.tree_.n_leaves <span class="cf">for</span> est <span class="kw">in</span> rf.estimators_)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="kw">def</span> rf_m_depth(rf):</span>
<span id="cb16-10"><a href="#cb16-10"></a>    <span class="co">"""</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">    return a median height of all the trees of the forrest.</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">    """</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>    <span class="cf">return</span> np.median([est.tree_.max_depth <span class="cf">for</span> est <span class="kw">in</span> rf.estimators_])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">##</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># print model oob_score, number of forrest leaves and median height</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>n_leaves <span class="op">=</span> rf_n_leaves(rf)</span>
<span id="cb17-4"><a href="#cb17-4"></a>m_depth <span class="op">=</span> rf_m_depth(rf)</span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="bu">print</span>(<span class="ss">f"OOB scrore = </span><span class="sc">{</span>oob_score<span class="sc">: .3f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">Tree leaves = </span><span class="sc">{</span>n_leaves<span class="sc">:</span> <span class="sc">,</span>d<span class="sc">}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">Median depth = </span><span class="sc">{</span>m_depth<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.790 
Tree leaves =  16,209,726 
Median depth = 53.5</code></pre>
</div>
</div>
<p>Our baseline model has an OOB score of just around 79% which is not bad as a starter. Now let’s also plot the feature importance for this model.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">def</span> plot_feature_importance(feature_importance, feature_names, figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>)):</span>
<span id="cb19-2"><a href="#cb19-2"></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">    plot the feature importances in a bar graph along with feature names.</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">    """</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>    fimp <span class="op">=</span> pd.Series(feature_importance, feature_names)</span>
<span id="cb19-6"><a href="#cb19-6"></a>    fimp.nlargest(<span class="bu">len</span>(fimp)).plot(figsize<span class="op">=</span>figsize, kind<span class="op">=</span><span class="st">'barh'</span>).invert_yaxis()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>feature_importance <span class="op">=</span> rf.feature_importances_</span>
<span id="cb20-2"><a href="#cb20-2"></a>feature_names <span class="op">=</span> X.columns</span>
<span id="cb20-3"><a href="#cb20-3"></a>plot_feature_importance(feature_importance, feature_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>From this feature importance plot, we can see that * <code>ModelID</code> is the highest predictor of <code>SalePrice</code>. This could be because vehicles belonging to a certain <code>ModelID</code> category could have their <code>SalePrice</code> in the same range. * <code>SalesID</code> and <code>MachineID</code> are coming up next as important features. This is not a good signal as both these features are unique for sale transactions and machine identification. <code>MachineID</code> also has inconsistencies as noted in this <a href="https://www.kaggle.com/c/bluebook-for-bulldozers/discussion/3694">kaggle discussion</a>. A model using these features will not be generalized. It would be better if we remove these features altogether otherwise they can affect the model’s performance. * <code>YearMade</code> comes next which also makes sense as older vehicles will have less price compared to the new ones.</p>
</section>
<section id="cleaning-up" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-up">Cleaning up</h2>
<p>In this section we will remove unimportanct features and fix the data types of remaining features.</p>
<section id="remove-id-columns" class="level3">
<h3 class="anchored" data-anchor-id="remove-id-columns">Remove ID columns</h3>
<p>As noted in last section we noted that following ID features can be removed from the dataset. * SalesID * MachineID</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">del</span> df[<span class="st">'SalesID'</span>]</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">del</span> df[<span class="st">'MachineID'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="fix-data-types-and-data-issues" class="level2">
<h2 class="anchored" data-anchor-id="fix-data-types-and-data-issues">Fix data types and data issues</h2>
<p>Let’s visit each feature from our dataset and check whether we need to fix the data type. Use <code>df_info</code> created in the last section to verify the data types of each feature.</p>
<section id="numerical-features" class="level3">
<h3 class="anchored" data-anchor-id="numerical-features">Numerical features</h3>
<p>Let’s first visit the numerical feature.</p>
<section id="auctioneerid" class="level4">
<h4 class="anchored" data-anchor-id="auctioneerid">auctioneerID</h4>
<p>It has the datatype as <code>float64</code> but this feature is actually categorical nominal as each ID is discrete and has no relation between them. It should be of type <code>str</code>. So let’s fix that.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>df[<span class="st">'auctioneerID'</span>] <span class="op">=</span> df[<span class="st">'auctioneerID'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="datetime-feature" class="level3">
<h3 class="anchored" data-anchor-id="datetime-feature">Datetime feature</h3>
<p>Let’s visit DateTime features and correct their data type #### saledate ‘saledate’ is a DateTime feature. So let’s correct its data type.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>df[<span class="st">'saledate'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'saledate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="categorical-features" class="level3">
<h3 class="anchored" data-anchor-id="categorical-features">Categorical features</h3>
<p>Let’s now visit the categorical features.</p>
<p>For categorical features, there is no better way than printing the unique values for each column and spend some time analyzing the values. Analyze * if the feature has some missing values * if there are any missing values but are represented by some other value like ‘Unspecified’, ‘None or Unspecified’ * keep a separate sheet with all the features and make notes for each feature like * there are no further actions required. The feature is good for use * need to replace missing values * any other observations * etc.</p>
<section id="transform-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="transform-missing-values">Transform missing values</h4>
<p>After visiting all the features we have found that missing values are represented in multiple ways like * Unspecified * None or Unspecified * None * #NAME? * “”</p>
<p>So we would transform and replace all these values with <code>np.nan</code> so they all represent the same thing.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">##</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># before transformation. </span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co"># let's use this feature to verify results.</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>df[<span class="st">'Hydraulics'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array(['2 Valve', 'Auxiliary', nan, 'Standard', 'Base + 1 Function',
       'Base + 3 Function', '4 Valve', '3 Valve', 'Base + 2 Function',
       'Base + 4 Function', 'None or Unspecified', 'Base + 5 Function',
       'Base + 6 Function'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">#collapse-output</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">def</span> normalize_str_values(df):</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="co">"""</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">    normalize dataframe str values</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">    * transform case to lowercase</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">    * replace missing values with np.nan</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">    """</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb26-9"><a href="#cb26-9"></a>        <span class="cf">if</span> df[col].dtype <span class="op">==</span> <span class="bu">object</span>: </span>
<span id="cb26-10"><a href="#cb26-10"></a>            <span class="bu">print</span>(<span class="ss">f"normalize column: </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-11"><a href="#cb26-11"></a>            df[col] <span class="op">=</span> df[col].<span class="bu">str</span>.lower()</span>
<span id="cb26-12"><a href="#cb26-12"></a>            df[col] <span class="op">=</span> df[col].fillna(np.nan)</span>
<span id="cb26-13"><a href="#cb26-13"></a>            df[col] <span class="op">=</span> df[col].replace(<span class="st">'unspecified'</span>, np.nan)</span>
<span id="cb26-14"><a href="#cb26-14"></a>            df[col] <span class="op">=</span> df[col].replace(<span class="st">'none or unspecified'</span>, np.nan)</span>
<span id="cb26-15"><a href="#cb26-15"></a>            df[col] <span class="op">=</span> df[col].replace(<span class="st">'none'</span>, np.nan)</span>
<span id="cb26-16"><a href="#cb26-16"></a>            df[col] <span class="op">=</span> df[col].replace(<span class="st">'#name?'</span>, np.nan)</span>
<span id="cb26-17"><a href="#cb26-17"></a>            df[col] <span class="op">=</span> df[col].replace(<span class="st">''</span>, np.nan)</span>
<span id="cb26-18"><a href="#cb26-18"></a></span>
<span id="cb26-19"><a href="#cb26-19"></a>normalize_str_values(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>normalize column: auctioneerID
normalize column: UsageBand
normalize column: fiModelDesc
normalize column: fiBaseModel
normalize column: fiSecondaryDesc
normalize column: fiModelSeries
normalize column: fiModelDescriptor
normalize column: ProductSize
normalize column: fiProductClassDesc
normalize column: state
normalize column: ProductGroup
normalize column: ProductGroupDesc
normalize column: Drive_System
normalize column: Enclosure
normalize column: Forks
normalize column: Pad_Type
normalize column: Ride_Control
normalize column: Stick
normalize column: Transmission
normalize column: Turbocharged
normalize column: Blade_Extension
normalize column: Blade_Width
normalize column: Enclosure_Type
normalize column: Engine_Horsepower
normalize column: Hydraulics
normalize column: Pushblock
normalize column: Ripper
normalize column: Scarifier
normalize column: Tip_Control
normalize column: Tire_Size
normalize column: Coupler
normalize column: Coupler_System
normalize column: Grouser_Tracks
normalize column: Hydraulics_Flow
normalize column: Track_Type
normalize column: Undercarriage_Pad_Width
normalize column: Stick_Length
normalize column: Thumb
normalize column: Pattern_Changer
normalize column: Grouser_Type
normalize column: Backhoe_Mounting
normalize column: Blade_Type
normalize column: Travel_Controls
normalize column: Differential_Type
normalize column: Steering_Controls</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">##</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co"># after transformation.</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co"># remember that transformation is applied to all string type columns. We are using just one column to verify the results.</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>df[<span class="st">'Hydraulics'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array(['2 valve', 'auxiliary', nan, 'standard', 'base + 1 function',
       'base + 3 function', '4 valve', '3 valve', 'base + 2 function',
       'base + 4 function', 'base + 5 function', 'base + 6 function'],
      dtype=object)</code></pre>
</div>
</div>
</section>
<section id="transform-measurements" class="level4">
<h4 class="anchored" data-anchor-id="transform-measurements">Transform measurements</h4>
<p>Some features are represented as a string but actually they are numerical measurement values. For example * <code>Tire_Size</code> has the size in inches with a symbol attached <code>"</code> * <code>Undercarriage_Pad_Width</code> has the size in inches with the unit attached <code>inch</code> * <code>Blade_Width</code> has the size in cm with a symbol attached <code>'</code>. It also has values less the 12cm represented as <code>&lt;12'</code> * <code>Stick_Length</code> has values in both feet and inches. We can simply convert them from <code>19\'8"</code> to 19.8 * After the above transformations, their data types should be converted to numeric</p>
<p>let’s apply these changes to our dataset.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">##</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># before transformation</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'Tire_Size'</span>, <span class="st">'Undercarriage_Pad_Width'</span>, <span class="st">'Blade_Width'</span>, <span class="st">'Stick_Length'</span>]:</span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">**: "</span>, df[col].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Tire_Size**:  [nan '23.5' '13"' '26.5' '29.5' '14"' '20.5' '17.5"' '15.5"' '20.5"'
 '17.5' '7.0"' '15.5' '23.5"' '10"' '23.1"' '10 inch']
**Undercarriage_Pad_Width**:  [nan '16 inch' '32 inch' '28 inch' '30 inch' '22 inch' '24 inch' '18 inch'
 '36 inch' '20 inch' '27 inch' '15 inch' '26 inch' '34 inch' '33 inch'
 '14 inch' '31 inch' '25 inch' '31.5 inch']
**Blade_Width**:  [nan "12'" "14'" "13'" "16'" "&lt;12'"]
**Stick_Length**:  [nan '11\' 0"' '15\' 9"' '10\' 2"' '10\' 6"' '9\' 10"' '10\' 10"' '9\' 6"'
 '9\' 7"' '12\' 8"' '8\' 2"' '8\' 6"' '9\' 8"' '12\' 10"' '11\' 10"'
 '8\' 10"' '8\' 4"' '12\' 4"' '9\' 5"' '6\' 3"' '14\' 1"' '13\' 7"'
 '13\' 10"' '13\' 9"' '7\' 10"' '15\' 4"' '9\' 2"' '24\' 3"' '19\' 8"']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>df[<span class="st">'Stick_Length'</span>] <span class="op">=</span> df[<span class="st">'Stick_Length'</span>].replace(<span class="vs">r"' "</span>, <span class="st">"."</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'Tire_Size'</span>, <span class="st">'Undercarriage_Pad_Width'</span>, <span class="st">'Blade_Width'</span>, <span class="st">'Stick_Length'</span>]:</span>
<span id="cb32-3"><a href="#cb32-3"></a>    df[col] <span class="op">=</span> df[col].<span class="bu">str</span>.extract(<span class="vs">r'([0-9.]*)'</span>, expand<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a>    df[col] <span class="op">=</span> df[col].replace(<span class="st">''</span>, np.nan)</span>
<span id="cb32-5"><a href="#cb32-5"></a>    df[col] <span class="op">=</span> pd.to_numeric(df[col])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">##</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># after transformation</span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'Tire_Size'</span>, <span class="st">'Undercarriage_Pad_Width'</span>, <span class="st">'Blade_Width'</span>, <span class="st">'Stick_Length'</span>]:</span>
<span id="cb33-4"><a href="#cb33-4"></a>    <span class="bu">print</span>(<span class="ss">f"**</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">**: "</span>, df[col].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**Tire_Size**:  [ nan 23.5 13.  26.5 29.5 14.  20.5 17.5 15.5  7.  10.  23.1]
**Undercarriage_Pad_Width**:  [ nan 16.  32.  28.  30.  22.  24.  18.  36.  20.  27.  15.  26.  34.
 33.  14.  31.  25.  31.5]
**Blade_Width**:  [nan 12. 14. 13. 16.]
**Stick_Length**:  [ nan 11.  15.9 10.2 10.6  9.1 10.1  9.6  9.7 12.8  8.2  8.6  9.8 12.1
 11.1  8.1  8.4 12.4  9.5  6.3 14.1 13.7 13.1 13.9  7.1 15.4  9.2 24.3
 19.8]</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="dealing-with-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-missing-data">Dealing with missing data</h2>
<section id="replace-missing-numeric-values" class="level3">
<h3 class="anchored" data-anchor-id="replace-missing-numeric-values">Replace missing numeric values</h3>
<p>For numerical features, we will follow the following approach to replace missing values * For a column <code>x</code> create a new column <code>x_na</code> where <code>x_na[i]</code> is marked as True if <code>x[i]</code> is missing * Replace the missing values in the x column with a median value</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">def</span> fix_missing_num(df, colname):</span>
<span id="cb35-2"><a href="#cb35-2"></a>    <span class="co">"""</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co">    replace missing values with</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co">    * median value</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co">    * flag the missing value in a separate *_na column</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co">    """</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>    df[colname<span class="op">+</span><span class="st">'_na'</span>] <span class="op">=</span> pd.isnull(df[colname])</span>
<span id="cb35-8"><a href="#cb35-8"></a>    df[colname].fillna(df[colname].median(), inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="yearmade" class="level4">
<h4 class="anchored" data-anchor-id="yearmade">YearMade</h4>
<p>“YearMade” doesn’t show any missing values but if we look closely at the data we will find that some instances have the value “1000”. The year 1000 is very unlikely for any vehicle to be made in and we can consider these instances as missing values. Let’s do that</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">##</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co"># befor transformation</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>df.plot.scatter(<span class="st">'YearMade'</span>, <span class="st">'SalePrice'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;AxesSubplot:xlabel='YearMade', ylabel='SalePrice'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-27-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>df.loc[df.YearMade<span class="op">==</span><span class="dv">1000</span>, <span class="st">'YearMade'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">##</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># after transformation</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>df.plot.scatter(<span class="st">'YearMade'</span>, <span class="st">'SalePrice'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>&lt;AxesSubplot:xlabel='YearMade', ylabel='SalePrice'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The plot now shows a more clear relationship between ‘YearMade’ and ‘SalePrice’. But the spike in the year 1920 is still concerning. Most probably it is also a recording error when the manufacturing year was not known then it was assigned some lowest available value in the system (similar to the year 1000). Let’s take this assumption that manufacturing years before 1950 are unknown and should be assigned <code>np.nan</code></p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>df.loc[df.YearMade<span class="op">&lt;</span><span class="dv">1950</span>, <span class="st">'YearMade'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="co">##</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="co"># after transformation</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>df.plot.scatter(<span class="st">'YearMade'</span>, <span class="st">'SalePrice'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>&lt;AxesSubplot:xlabel='YearMade', ylabel='SalePrice'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-31-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s also replace the missing values with the function created above.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>fix_missing_num(df, <span class="st">'YearMade'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="machinehourscurrentmeter" class="level4">
<h4 class="anchored" data-anchor-id="machinehourscurrentmeter">MachineHoursCurrentMeter</h4>
<p>The next numerical feature that comes is <code>MachineHoursCurrentMeter</code>. This feature tells us the number of hours a machine has been in use when it was brought to the auction. So older machines are much more likely to have more hours on them as compared to newer machines. There should be a correlation between machine hours and the vehicle in use period (a period between manufacturing and auction). To verify this relationship we first need to find the period in years between manufacturing and auction. We have the ‘YearMade’ that tells us when the vehicle was made. We have the ‘saledate’ which is a DateTime string object but we can use it to find the ‘YearSold’.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>df[<span class="st">'YearSold'</span>] <span class="op">=</span> df[<span class="st">'saledate'</span>].dt.year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">##</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="co"># verify that we have correct data</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>df[[<span class="st">'saledate'</span>, <span class="st">'YearSold'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>saledate</th>
      <th>YearSold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2006-11-16</td>
      <td>2006</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2004-03-26</td>
      <td>2004</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2004-02-26</td>
      <td>2004</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-05-19</td>
      <td>2011</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009-07-23</td>
      <td>2009</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Now we can use ‘YearMade’ and ‘YearSold’ to find the number of years the vehicle remained in use. Let’s call this new column ‘YearsInUse’</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>df[<span class="st">'YearsInUse'</span>] <span class="op">=</span> df[<span class="st">'YearSold'</span>] <span class="op">-</span> df[<span class="st">'YearMade'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="co">##</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co"># verify the results</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>df[[<span class="st">'YearsInUse'</span>, <span class="st">'YearSold'</span>, <span class="st">'YearMade'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>YearsInUse</th>
      <th>YearSold</th>
      <th>YearMade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>2006</td>
      <td>2004.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>2004</td>
      <td>1996.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>2004</td>
      <td>2001.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10.0</td>
      <td>2011</td>
      <td>2001.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>2009</td>
      <td>2007.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>A sold year cannot be less than a manufacturing year. So let’s verify data integrity as well.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>df.loc[df.YearsInUse<span class="op">&lt;</span><span class="dv">0</span>, [<span class="st">'YearsInUse'</span>, <span class="st">'saledate'</span>, <span class="st">'YearSold'</span>, <span class="st">'YearMade'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>YearsInUse</th>
      <th>saledate</th>
      <th>YearSold</th>
      <th>YearMade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>24007</th>
      <td>-2.0</td>
      <td>1994-02-11</td>
      <td>1994</td>
      <td>1996.0</td>
    </tr>
    <tr>
      <th>24009</th>
      <td>-1.0</td>
      <td>1995-04-18</td>
      <td>1995</td>
      <td>1996.0</td>
    </tr>
    <tr>
      <th>24015</th>
      <td>-2.0</td>
      <td>1994-09-20</td>
      <td>1994</td>
      <td>1996.0</td>
    </tr>
    <tr>
      <th>24029</th>
      <td>-1.0</td>
      <td>1995-04-28</td>
      <td>1995</td>
      <td>1996.0</td>
    </tr>
    <tr>
      <th>24064</th>
      <td>-1.0</td>
      <td>1995-04-28</td>
      <td>1995</td>
      <td>1996.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><code>YearInUse</code> cannot have a negative value and this shows that either ‘YearMade’ or ‘saledate’ is incorrect. We can assume that error can be with ‘YearMade’ as this is an auction dataset and ‘saledate’ will be more reliable. For entries where ‘YearMade’ is greater than ‘YearSold’ we can replace ‘YearMade’ with ‘YearSold’ (better to have ‘YearsInUse’ equal to zero than negative).</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>df.loc[df.YearMade<span class="op">&gt;</span>df.YearSold, <span class="st">'YearMade'</span>] <span class="op">=</span> df.YearSold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s recalculate the ‘YearsInUse’ with corrected data.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>df[<span class="st">'YearsInUse'</span>] <span class="op">=</span> df[<span class="st">'YearSold'</span>] <span class="op">-</span> df[<span class="st">'YearMade'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s verify that the data is consistent and all vehicles have ‘YearMade’ less than their ‘YearSold’</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>df.loc[df.YearsInUse<span class="op">&lt;</span><span class="dv">0</span>, [<span class="st">'YearsInUse'</span>, <span class="st">'saledate'</span>, <span class="st">'YearSold'</span>, <span class="st">'YearMade'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>YearsInUse</th>
      <th>saledate</th>
      <th>YearSold</th>
      <th>YearMade</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can now plot the relationship between ‘YearsInUse’ and ‘MachineHoursCurrentMeter’</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a>df.plot.scatter(<span class="st">'YearsInUse'</span>, <span class="st">'MachineHoursCurrentMeter'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>&lt;AxesSubplot:xlabel='YearsInUse', ylabel='MachineHoursCurrentMeter'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>This plot shows that there is some relation between a vehicle being in use and its meter hours. As the ‘YearsInUse’ value increases we also see an increase in meter hours, but after around 15 ‘YearsInUse’ the relationship does not hold on and meter hours start dropping to zero. It means that <code>MachineHoursCurrentMeter</code> data has inconsistencies as many vehicles remained in use for multiple years but they also have zero meter readings. This is very unrealistic and vehicles will not be sitting idle for many years till their auction. It could be that the meter reading for them was not known and 0 could have been used for the ‘Unspecified or Unknown’ value.</p>
<p>Let’s take this assumption and transform ‘MachineHoursCurrentMeter’ to correctly represent that</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>df.loc[df.MachineHoursCurrentMeter<span class="op">==</span><span class="dv">0</span>, <span class="st">'MachineHoursCurrentMeter'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Also apply our missing values fix on this feature</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>fix_missing_num(df, <span class="st">'MachineHoursCurrentMeter'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tire_size" class="level4">
<h4 class="anchored" data-anchor-id="tire_size">Tire_Size</h4>
<p>The next numerical feature is ‘Tire_Size’. We can plot the distribution of tire sizes to find any outliers.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>df[<span class="st">'Tire_Size'</span>].hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-44-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">##</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="co"># print tire sizes</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>np.sort(df[<span class="st">'Tire_Size'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>array([ 7. , 10. , 13. , 14. , 15.5, 17.5, 20.5, 23.1, 23.5, 26.5, 29.5,
        nan])</code></pre>
</div>
</div>
<p>The plot does not show any outliers and data seems consistant, so we can apply our missing values fix on this feature.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>fix_missing_num(df, <span class="st">'Tire_Size'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stick_length" class="level4">
<h4 class="anchored" data-anchor-id="stick_length">Stick_Length</h4>
<p>The Next numerical feature is ‘Stick_Lenght’. Let’s plot the distribution to check for any outliers.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>np.sort(df[<span class="st">'Stick_Length'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>array([ 6.3,  7.1,  8.1,  8.2,  8.4,  8.6,  9.1,  9.2,  9.5,  9.6,  9.7,
        9.8, 10.1, 10.2, 10.6, 11. , 11.1, 12.1, 12.4, 12.8, 13.1, 13.7,
       13.9, 14.1, 15.4, 15.9, 19.8, 24.3,  nan])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>df[<span class="st">'Stick_Length'</span>].plot.hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>&lt;AxesSubplot:ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-48-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The above plot shows a normal distribution and no outliers. So we can apply our missing values fix on this feature.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>fix_missing_num(df, <span class="st">'Stick_Length'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="undercarriage_pad_width" class="level4">
<h4 class="anchored" data-anchor-id="undercarriage_pad_width">Undercarriage_Pad_Width</h4>
<p>Next numerical feature is ‘Undercarriage_Pad_Width’. Let’s follow the same steps for this feature.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>np.sort(df[<span class="st">'Undercarriage_Pad_Width'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>array([14. , 15. , 16. , 18. , 20. , 22. , 24. , 25. , 26. , 27. , 28. ,
       30. , 31. , 31.5, 32. , 33. , 34. , 36. ,  nan])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>df[<span class="st">'Undercarriage_Pad_Width'</span>].plot.hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>&lt;AxesSubplot:ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-51-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The distribution for this feature looks fine, and we can apply missing values fix on it.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a>fix_missing_num(df, <span class="st">'Undercarriage_Pad_Width'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="blade_width" class="level4">
<h4 class="anchored" data-anchor-id="blade_width">Blade_Width</h4>
<p>Next numerical feature in ‘Blade_Width’. Following the same steps as before.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>np.sort(df[<span class="st">'Blade_Width'</span>].unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>array([12., 13., 14., 16., nan])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>df[<span class="st">'Blade_Width'</span>].plot.hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>&lt;AxesSubplot:ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-54-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Apply the fix on this feature.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>fix_missing_num(df, <span class="st">'Blade_Width'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="replace-missing-categorical-values" class="level3">
<h3 class="anchored" data-anchor-id="replace-missing-categorical-values">Replace missing categorical values</h3>
<p>encoding and checking the importance We will now replace missing values for categorical features in the following way. * We will label encode them. We will treat them as ordinal features and assign them a numeric value * Missing values will automatically be assigned a value, and that will be 0</p>
<p>Some important discussion points on treating nominal categorical features as ordinal and then encoding them. A more prevalent approach is to one hot encode (OHE) them. The drawback of OHE approach is that it makes the decision trees very unbalanced if the dataset has multiple categorical features with high variance. So instead of applying OHE to all features, we will do it in a two-step approach. First, we will label encode them and train a model on them. After that, we will check their feature importance, and if a feature comes up as an important with a low variance then we will use OHE for it. Otherwise we will leave them with label encoding.</p>
<p>More can be read about categorical features encoding from these references * <a href="https://mlbook.explained.ai/catvars.html#sec:catvars">The Mechanics of Machine Learning</a> by Terence Parr and Jeremy Howard section 6.2 * <a href="https://towardsdatascience.com/getting-deeper-into-categorical-encodings-for-machine-learning-2312acd347c8">Getting Deeper into Categorical Encodings for Machine Learning</a> * <a href="https://towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769">One-Hot Encoding is making your Tree-Based Ensembles worse, here’s why?</a></p>
<p>Let’s create some functions to encode our categorical features.</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> is_categorical_dtype, is_string_dtype</span>
<span id="cb77-2"><a href="#cb77-2"></a></span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="kw">def</span> df_string_to_cat(df):</span>
<span id="cb77-4"><a href="#cb77-4"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb77-5"><a href="#cb77-5"></a>        <span class="cf">if</span> is_string_dtype(df[col]):</span>
<span id="cb77-6"><a href="#cb77-6"></a>            <span class="bu">print</span>(<span class="ss">f"label encoding applied on </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-7"><a href="#cb77-7"></a>            df[col] <span class="op">=</span> df[col].astype(<span class="st">'category'</span>).cat.as_ordered()</span>
<span id="cb77-8"><a href="#cb77-8"></a></span>
<span id="cb77-9"><a href="#cb77-9"></a><span class="kw">def</span> df_cat_to_catcode(df):</span>
<span id="cb77-10"><a href="#cb77-10"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb77-11"><a href="#cb77-11"></a>        <span class="cf">if</span> is_categorical_dtype(df[col]):</span>
<span id="cb77-12"><a href="#cb77-12"></a>            df[col] <span class="op">=</span> df[col].cat.codes <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please note that Pandas represents <code>np.nan</code> with category code “-1”, and so adding “1” in function <code>df_cat_to_catcode</code> shifts np.nan to 0 and all category codes to be 1 and above.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">##</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="co"># before transformation</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>df.head(<span class="dv">5</span>).T.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SalePrice</th>
      <td>66000</td>
      <td>57000</td>
      <td>10000</td>
      <td>38500</td>
      <td>11000</td>
    </tr>
    <tr>
      <th>ModelID</th>
      <td>3157</td>
      <td>77</td>
      <td>7009</td>
      <td>332</td>
      <td>17311</td>
    </tr>
    <tr>
      <th>datasource</th>
      <td>121</td>
      <td>121</td>
      <td>121</td>
      <td>121</td>
      <td>121</td>
    </tr>
    <tr>
      <th>auctioneerID</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>YearMade</th>
      <td>2004.0</td>
      <td>1996.0</td>
      <td>2001.0</td>
      <td>2001.0</td>
      <td>2007.0</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter</th>
      <td>68.0</td>
      <td>4640.0</td>
      <td>2838.0</td>
      <td>3486.0</td>
      <td>722.0</td>
    </tr>
    <tr>
      <th>UsageBand</th>
      <td>low</td>
      <td>low</td>
      <td>high</td>
      <td>high</td>
      <td>medium</td>
    </tr>
    <tr>
      <th>saledate</th>
      <td>2006-11-16 00:00:00</td>
      <td>2004-03-26 00:00:00</td>
      <td>2004-02-26 00:00:00</td>
      <td>2011-05-19 00:00:00</td>
      <td>2009-07-23 00:00:00</td>
    </tr>
    <tr>
      <th>fiModelDesc</th>
      <td>521d</td>
      <td>950fii</td>
      <td>226</td>
      <td>pc120-6e</td>
      <td>s175</td>
    </tr>
    <tr>
      <th>fiBaseModel</th>
      <td>521</td>
      <td>950</td>
      <td>226</td>
      <td>pc120</td>
      <td>s175</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="co">#collapse-output</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co"># apply the cat transformation</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>df_string_to_cat(df)</span>
<span id="cb79-4"><a href="#cb79-4"></a>df_cat_to_catcode(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>label encoding applied on auctioneerID
label encoding applied on UsageBand
label encoding applied on fiModelDesc
label encoding applied on fiBaseModel
label encoding applied on fiSecondaryDesc
label encoding applied on fiModelSeries
label encoding applied on fiModelDescriptor
label encoding applied on ProductSize
label encoding applied on fiProductClassDesc
label encoding applied on state
label encoding applied on ProductGroup
label encoding applied on ProductGroupDesc
label encoding applied on Drive_System
label encoding applied on Enclosure
label encoding applied on Forks
label encoding applied on Pad_Type
label encoding applied on Ride_Control
label encoding applied on Stick
label encoding applied on Transmission
label encoding applied on Turbocharged
label encoding applied on Blade_Extension
label encoding applied on Enclosure_Type
label encoding applied on Engine_Horsepower
label encoding applied on Hydraulics
label encoding applied on Pushblock
label encoding applied on Ripper
label encoding applied on Scarifier
label encoding applied on Tip_Control
label encoding applied on Coupler
label encoding applied on Coupler_System
label encoding applied on Grouser_Tracks
label encoding applied on Hydraulics_Flow
label encoding applied on Track_Type
label encoding applied on Thumb
label encoding applied on Pattern_Changer
label encoding applied on Grouser_Type
label encoding applied on Backhoe_Mounting
label encoding applied on Blade_Type
label encoding applied on Travel_Controls
label encoding applied on Differential_Type
label encoding applied on Steering_Controls</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="co">##</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="co"># after transformation</span></span>
<span id="cb81-3"><a href="#cb81-3"></a>df.head(<span class="dv">5</span>).T.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SalePrice</th>
      <td>66000</td>
      <td>57000</td>
      <td>10000</td>
      <td>38500</td>
      <td>11000</td>
    </tr>
    <tr>
      <th>ModelID</th>
      <td>3157</td>
      <td>77</td>
      <td>7009</td>
      <td>332</td>
      <td>17311</td>
    </tr>
    <tr>
      <th>datasource</th>
      <td>121</td>
      <td>121</td>
      <td>121</td>
      <td>121</td>
      <td>121</td>
    </tr>
    <tr>
      <th>auctioneerID</th>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
      <td>23</td>
    </tr>
    <tr>
      <th>YearMade</th>
      <td>2004.0</td>
      <td>1996.0</td>
      <td>2001.0</td>
      <td>2001.0</td>
      <td>2007.0</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter</th>
      <td>68.0</td>
      <td>4640.0</td>
      <td>2838.0</td>
      <td>3486.0</td>
      <td>722.0</td>
    </tr>
    <tr>
      <th>UsageBand</th>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>saledate</th>
      <td>2006-11-16 00:00:00</td>
      <td>2004-03-26 00:00:00</td>
      <td>2004-02-26 00:00:00</td>
      <td>2011-05-19 00:00:00</td>
      <td>2009-07-23 00:00:00</td>
    </tr>
    <tr>
      <th>fiModelDesc</th>
      <td>950</td>
      <td>1725</td>
      <td>331</td>
      <td>3674</td>
      <td>4208</td>
    </tr>
    <tr>
      <th>fiBaseModel</th>
      <td>296</td>
      <td>527</td>
      <td>110</td>
      <td>1375</td>
      <td>1529</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessed-dataset" class="level2">
<h2 class="anchored" data-anchor-id="preprocessed-dataset">Preprocessed dataset</h2>
<p>At this point, all our numerical and categorical features have been preprocessed. There should be no missing values, and all categorical features should have been encoded. Only DateTime columns are remaining to be processed and we will do that in the next section.</p>
<p>Let’s verify the data using summary information.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a>df_info <span class="op">=</span> pd.DataFrame()</span>
<span id="cb82-2"><a href="#cb82-2"></a>df_info[<span class="st">'sample'</span>] <span class="op">=</span> df.iloc[<span class="dv">0</span>]</span>
<span id="cb82-3"><a href="#cb82-3"></a>df_info[<span class="st">'data_type'</span>] <span class="op">=</span> df.dtypes</span>
<span id="cb82-4"><a href="#cb82-4"></a>df_info[<span class="st">'percent_missing'</span>] <span class="op">=</span> <span class="dv">100</span><span class="op">*</span>df.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df)</span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="bu">print</span>(<span class="ss">f"Total features: </span><span class="sc">{</span><span class="bu">len</span>(df.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-6"><a href="#cb82-6"></a>df_info.sort_values(<span class="st">'percent_missing'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total features: 59</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="66">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sample</th>
      <th>data_type</th>
      <th>percent_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SalePrice</th>
      <td>66000</td>
      <td>int64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Pushblock</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Ripper</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Scarifier</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Tip_Control</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Tire_Size</th>
      <td>20.5</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Coupler</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Coupler_System</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Grouser_Tracks</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Hydraulics_Flow</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Track_Type</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Undercarriage_Pad_Width</th>
      <td>28.0</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Stick_Length</th>
      <td>9.7</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Hydraulics</th>
      <td>1</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Thumb</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Grouser_Type</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Backhoe_Mounting</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Blade_Type</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Travel_Controls</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Differential_Type</th>
      <td>4</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Steering_Controls</th>
      <td>2</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>YearMade_na</th>
      <td>False</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>YearSold</th>
      <td>2006</td>
      <td>int64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>YearsInUse</th>
      <td>2.0</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter_na</th>
      <td>False</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Tire_Size_na</th>
      <td>True</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Stick_Length_na</th>
      <td>True</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Pattern_Changer</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Undercarriage_Pad_Width_na</th>
      <td>True</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Engine_Horsepower</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Blade_Width</th>
      <td>14.0</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ModelID</th>
      <td>3157</td>
      <td>int64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>datasource</th>
      <td>121</td>
      <td>int64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>auctioneerID</th>
      <td>23</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>YearMade</th>
      <td>2004.0</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MachineHoursCurrentMeter</th>
      <td>68.0</td>
      <td>float64</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>UsageBand</th>
      <td>2</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>saledate</th>
      <td>2006-11-16 00:00:00</td>
      <td>datetime64[ns]</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiModelDesc</th>
      <td>950</td>
      <td>int16</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiBaseModel</th>
      <td>296</td>
      <td>int16</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiSecondaryDesc</th>
      <td>40</td>
      <td>int16</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiModelSeries</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiModelDescriptor</th>
      <td>0</td>
      <td>int16</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Enclosure_Type</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ProductSize</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>state</th>
      <td>1</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ProductGroup</th>
      <td>6</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ProductGroupDesc</th>
      <td>6</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Drive_System</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Enclosure</th>
      <td>3</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Forks</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Pad_Type</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Ride_Control</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Stick</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Transmission</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Turbocharged</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Blade_Extension</th>
      <td>0</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>fiProductClassDesc</th>
      <td>59</td>
      <td>int8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Blade_Width_na</th>
      <td>True</td>
      <td>bool</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s retrain our base model one more time but this time with all the features except datetime columns to see where we stand in our OOB score. Below is a utility function created to quickly iterate over model training.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">def</span> train_and_plot_model(df, target<span class="op">=</span><span class="st">'SalePrice'</span>, drop_features<span class="op">=</span>[], n_estimators<span class="op">=</span><span class="dv">70</span>, plot<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb84-2"><a href="#cb84-2"></a>    <span class="co">"""</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="co">    A utility function to train a RandomForrest model on the provided data, and plot the feature importances.</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="co">    </span></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="co">    Parameters</span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="co">    ----------</span></span>
<span id="cb84-7"><a href="#cb84-7"></a><span class="co">    df: pandas.DataFrame</span></span>
<span id="cb84-8"><a href="#cb84-8"></a><span class="co">        input dataset to be used for training</span></span>
<span id="cb84-9"><a href="#cb84-9"></a><span class="co">    target: str</span></span>
<span id="cb84-10"><a href="#cb84-10"></a><span class="co">        target feature. this is the feature we are trying to predict</span></span>
<span id="cb84-11"><a href="#cb84-11"></a><span class="co">    drop_features: list</span></span>
<span id="cb84-12"><a href="#cb84-12"></a><span class="co">        any features to be dropped before training. Default is empty list.</span></span>
<span id="cb84-13"><a href="#cb84-13"></a><span class="co">    n_estimators: int</span></span>
<span id="cb84-14"><a href="#cb84-14"></a><span class="co">        number of estimators to be used for model training. Default is 50.</span></span>
<span id="cb84-15"><a href="#cb84-15"></a><span class="co">    """</span></span>
<span id="cb84-16"><a href="#cb84-16"></a></span>
<span id="cb84-17"><a href="#cb84-17"></a>    <span class="co"># target = 'SalePrice' # this is the feature we are trying to predict</span></span>
<span id="cb84-18"><a href="#cb84-18"></a>    features <span class="op">=</span> <span class="bu">list</span>(df.columns)</span>
<span id="cb84-19"><a href="#cb84-19"></a></span>
<span id="cb84-20"><a href="#cb84-20"></a>    <span class="co"># remove target feature and other specified features form the input variables</span></span>
<span id="cb84-21"><a href="#cb84-21"></a>    features.remove(target)</span>
<span id="cb84-22"><a href="#cb84-22"></a>    <span class="cf">for</span> f <span class="kw">in</span> drop_features:</span>
<span id="cb84-23"><a href="#cb84-23"></a>        features.remove(f)</span>
<span id="cb84-24"><a href="#cb84-24"></a></span>
<span id="cb84-25"><a href="#cb84-25"></a>    X, y <span class="op">=</span> df[features], df[target]</span>
<span id="cb84-26"><a href="#cb84-26"></a></span>
<span id="cb84-27"><a href="#cb84-27"></a>    rf <span class="op">=</span> RandomForestRegressor(n_estimators, oob_score<span class="op">=</span><span class="va">True</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span>verbose)</span>
<span id="cb84-28"><a href="#cb84-28"></a>    rf.fit(X, y)</span>
<span id="cb84-29"><a href="#cb84-29"></a>    oob_score <span class="op">=</span> rf.oob_score_</span>
<span id="cb84-30"><a href="#cb84-30"></a></span>
<span id="cb84-31"><a href="#cb84-31"></a>    <span class="co"># get trained model leaves and depth    </span></span>
<span id="cb84-32"><a href="#cb84-32"></a>    n_leaves <span class="op">=</span> rf_n_leaves(rf)</span>
<span id="cb84-33"><a href="#cb84-33"></a>    m_depth <span class="op">=</span> rf_m_depth(rf)</span>
<span id="cb84-34"><a href="#cb84-34"></a></span>
<span id="cb84-35"><a href="#cb84-35"></a>    <span class="co"># print trained model info</span></span>
<span id="cb84-36"><a href="#cb84-36"></a>    <span class="bu">print</span>(<span class="ss">f"OOB scrore = </span><span class="sc">{</span>oob_score<span class="sc">: .3f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">Tree leaves = </span><span class="sc">{</span>n_leaves<span class="sc">:</span> <span class="sc">,</span>d<span class="sc">}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">Median depth = </span><span class="sc">{</span>m_depth<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb84-37"><a href="#cb84-37"></a></span>
<span id="cb84-38"><a href="#cb84-38"></a>    <span class="co"># plot trained model feature importance</span></span>
<span id="cb84-39"><a href="#cb84-39"></a>    feature_importance <span class="op">=</span> rf.feature_importances_</span>
<span id="cb84-40"><a href="#cb84-40"></a>    <span class="cf">if</span> plot:</span>
<span id="cb84-41"><a href="#cb84-41"></a>        plot_feature_importance(feature_importance, features, (<span class="dv">10</span>,<span class="dv">15</span>))</span>
<span id="cb84-42"><a href="#cb84-42"></a>    </span>
<span id="cb84-43"><a href="#cb84-43"></a>    <span class="co"># return trained model, feature names, and their importances</span></span>
<span id="cb84-44"><a href="#cb84-44"></a>    <span class="cf">return</span> (rf, features, feature_importance, oob_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a><span class="co">##</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="co"># keeping n_estimators same as previous base model i.e. 70</span></span>
<span id="cb85-3"><a href="#cb85-3"></a>(rf, feature_names, feature_importance, oob_pre) <span class="op">=</span> train_and_plot_model(df, drop_features<span class="op">=</span>[<span class="st">'saledate'</span>], n_estimators<span class="op">=</span><span class="dv">70</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  2.7min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  4.2min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.904 
Tree leaves =  14,660,873 
Median depth = 45.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-62-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>This is a big improvement in our model performance. Our base model had 0.790 OOB score and now we are at 0.904. Our features count has also increased from 7 to 59, so we can take one more shot at it by increasing the estomators count (<code>n_estimators</code>). Let’s use <code>150</code> trees this time (double that last time) to see how much effect it can have on model performance.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a>(rf, feature_names, feature_importance, oob_pre) <span class="op">=</span> train_and_plot_model(df, drop_features<span class="op">=</span>[<span class="st">'saledate'</span>], n_estimators<span class="op">=</span><span class="dv">150</span>, plot<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  2.8min
[Parallel(n_jobs=-1)]: Done 150 out of 150 | elapsed:  9.2min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.906 
Tree leaves =  31,408,663 
Median depth = 46.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-63-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Though there is only a slight increase in model performance but it took us significantly more time to train the model. So we will keep our estimators low and revisit them during the tuning phase. With “70” estimators our model performance is</p>
<pre><code>OOB scrore =  0.904
Tree leaves =  14,660,873 
Median depth = 45.0</code></pre>
<p>At this point, our features have correct data types and their missing values are properly adjusted. We can now focus on some feature engineering aspects. Before moving further let’s also save our dataset till this point so if we make an error we can restart from this checkpoint.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="co">##</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="co"># store preprocessed data as a check point for this state</span></span>
<span id="cb92-3"><a href="#cb92-3"></a>df.to_pickle(dataset_path<span class="op">+</span><span class="st">'preprocessed.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have used <code>pickle</code> format to preserve data types for saved data.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="co">##</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="co"># load preprocessed data (optional step)</span></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="co"># df = pd.read_pickle(dataset_path+'preprocessed.pkl')</span></span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="co"># (rf, feature_names, feature_importance, oob_pre) = train_and_plot_model(df, drop_features=['saledate'], n_estimators=70)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<p>For feature engineering, we will give priority to important features. For this let us again analyze the preprocessed dataset starting from important features to see what can be done against each feature.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a><span class="co">##</span></span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="co"># sort the dataframe with important features at the start</span></span>
<span id="cb94-3"><a href="#cb94-3"></a>temp <span class="op">=</span> pd.Series(feature_importance, feature_names)</span>
<span id="cb94-4"><a href="#cb94-4"></a>cols <span class="op">=</span> temp.nlargest(<span class="bu">len</span>(temp)).index</span>
<span id="cb94-5"><a href="#cb94-5"></a></span>
<span id="cb94-6"><a href="#cb94-6"></a>sniff(df[cols], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ProductSize</th>
      <th>YearsInUse</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>YearMade</th>
      <th>fiProductClassDesc</th>
      <th>ModelID</th>
      <th>YearMade_na</th>
      <th>fiModelDesc</th>
      <th>Hydraulics_Flow</th>
      <th>YearSold</th>
      <th>state</th>
      <th>Enclosure</th>
      <th>Hydraulics</th>
      <th>auctioneerID</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>MachineHoursCurrentMeter</th>
      <th>Transmission</th>
      <th>Pushblock</th>
      <th>Engine_Horsepower</th>
      <th>Ripper</th>
      <th>Drive_System</th>
      <th>datasource</th>
      <th>Blade_Type</th>
      <th>Stick_Length</th>
      <th>UsageBand</th>
      <th>Coupler</th>
      <th>Tire_Size</th>
      <th>Tire_Size_na</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Thumb</th>
      <th>Grouser_Type</th>
      <th>Travel_Controls</th>
      <th>Track_Type</th>
      <th>Stick_Length_na</th>
      <th>Forks</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Ride_Control</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Tip_Control</th>
      <th>Differential_Type</th>
      <th>Pattern_Changer</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Scarifier</th>
      <th>Enclosure_Type</th>
      <th>Stick</th>
      <th>Steering_Controls</th>
      <th>Blade_Width</th>
      <th>Blade_Width_na</th>
      <th>Pad_Type</th>
      <th>Blade_Extension</th>
      <th>Turbocharged</th>
      <th>Grouser_Tracks</th>
      <th>Coupler_System</th>
      <th>Backhoe_Mounting</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2.0</td>
      <td>296</td>
      <td>40</td>
      <td>2004.0</td>
      <td>59</td>
      <td>3157</td>
      <td>False</td>
      <td>950</td>
      <td>0</td>
      <td>2006</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>68.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>121</td>
      <td>0</td>
      <td>9.7</td>
      <td>2</td>
      <td>0</td>
      <td>20.5</td>
      <td>True</td>
      <td>28.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>True</td>
      <td>0</td>
      <td>False</td>
      <td>0</td>
      <td>True</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>14.0</td>
      <td>True</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>8.0</td>
      <td>527</td>
      <td>54</td>
      <td>1996.0</td>
      <td>62</td>
      <td>77</td>
      <td>True</td>
      <td>1725</td>
      <td>2</td>
      <td>2004</td>
      <td>33</td>
      <td>5</td>
      <td>4</td>
      <td>2</td>
      <td>97</td>
      <td>65</td>
      <td>4640.0</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>132</td>
      <td>5</td>
      <td>11.0</td>
      <td>1</td>
      <td>2</td>
      <td>23.5</td>
      <td>False</td>
      <td>16.0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>False</td>
      <td>1</td>
      <td>True</td>
      <td>1</td>
      <td>False</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>12.0</td>
      <td>False</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6.0</td>
      <td>3.0</td>
      <td>110.0</td>
      <td>0.0</td>
      <td>2001.0</td>
      <td>39.0</td>
      <td>7009.0</td>
      <td>NaN</td>
      <td>331.0</td>
      <td>1.0</td>
      <td>2011.0</td>
      <td>32.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>44.0</td>
      <td>20.0</td>
      <td>2838.0</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>136.0</td>
      <td>6.0</td>
      <td>15.9</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>13.0</td>
      <td>NaN</td>
      <td>32.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>13.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>10.0</td>
      <td>1375.0</td>
      <td>56.0</td>
      <td>2007.0</td>
      <td>8.0</td>
      <td>332.0</td>
      <td>NaN</td>
      <td>3674.0</td>
      <td>NaN</td>
      <td>2009.0</td>
      <td>44.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>102.0</td>
      <td>64.0</td>
      <td>3486.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>149.0</td>
      <td>9.0</td>
      <td>10.2</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>26.5</td>
      <td>NaN</td>
      <td>30.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>16.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>1529.0</td>
      <td>47.0</td>
      <td>1993.0</td>
      <td>40.0</td>
      <td>17311.0</td>
      <td>NaN</td>
      <td>4208.0</td>
      <td>NaN</td>
      <td>2008.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>24.0</td>
      <td>33.0</td>
      <td>83.0</td>
      <td>722.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>172.0</td>
      <td>7.0</td>
      <td>10.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>29.5</td>
      <td>NaN</td>
      <td>22.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2.0</td>
      <td>11.0</td>
      <td>175.0</td>
      <td>61.0</td>
      <td>2008.0</td>
      <td>2.0</td>
      <td>4605.0</td>
      <td>NaN</td>
      <td>493.0</td>
      <td>NaN</td>
      <td>2005.0</td>
      <td>9.0</td>
      <td>4.0</td>
      <td>7.0</td>
      <td>27.0</td>
      <td>98.0</td>
      <td>33.0</td>
      <td>508.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>9.1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>419.0</td>
      <td>20.0</td>
      <td>1998.0</td>
      <td>14.0</td>
      <td>1937.0</td>
      <td>NaN</td>
      <td>1453.0</td>
      <td>NaN</td>
      <td>2007.0</td>
      <td>13.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>30.0</td>
      <td>2.0</td>
      <td>100.0</td>
      <td>11540.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>10.1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>17.5</td>
      <td>NaN</td>
      <td>18.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>7.0</td>
      <td>243.0</td>
      <td>105.0</td>
      <td>1999.0</td>
      <td>17.0</td>
      <td>3539.0</td>
      <td>NaN</td>
      <td>740.0</td>
      <td>NaN</td>
      <td>2010.0</td>
      <td>37.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>26.0</td>
      <td>73.0</td>
      <td>128.0</td>
      <td>4883.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>9.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.5</td>
      <td>NaN</td>
      <td>36.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NaN</td>
      <td>5.0</td>
      <td>250.0</td>
      <td>133.0</td>
      <td>2003.0</td>
      <td>68.0</td>
      <td>36003.0</td>
      <td>NaN</td>
      <td>779.0</td>
      <td>NaN</td>
      <td>2000.0</td>
      <td>35.0</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>25.0</td>
      <td>13.0</td>
      <td>71.0</td>
      <td>302.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>12.8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>14.0</td>
      <td>540.0</td>
      <td>129.0</td>
      <td>1991.0</td>
      <td>51.0</td>
      <td>3883.0</td>
      <td>NaN</td>
      <td>1771.0</td>
      <td>NaN</td>
      <td>2002.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>54.0</td>
      <td>122.0</td>
      <td>20700.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>8.2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>27.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The above table is sorted based on the importance of each feature. Features at the start have more importance. So let’s visit each feature to see if any feature engineering (<code>FE</code>) can be used to gain more insights from the data.</p>
<ul>
<li>ProductSize, YearsInUse: These features have numbers. Not a candidate for FE.</li>
<li>fiBaseModel: It is label encoded. Let’s visit this column’s original values to see if any more features can be generated from it.</li>
</ul>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a>df_raw[<span class="st">'fiBaseModel'</span>].unique()[:<span class="dv">50</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>array(['521D', '950FII', '226', 'PC120-6E', 'S175', '310G', '790ELC',
       '416D', '430HAG', '988B', 'D31E', 'PC200LC6', '420D', '214E',
       '310E', '334', '45NX', '302.5', '580SUPER K', 'JS260', '120G',
       '966FII', 'EX550STD', '685B', '345BL', '330BL', '873', 'WA250',
       '750BLT', '303CR', '95ZII', '416', '303.5', 'CTL60', '140G',
       '307CSB', 'EC210LC', 'MF650', 'RC30', 'EX120-5', '70XT', '772A',
       '160HNA', '216', '304CR', 'D3CIIIXL', '236', '120C', 'PC228',
       'SK160LC'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li>fiBaseModel: original values look very random and do not give much information. There are two other columns in the importance list ‘fiModelDesc’, and ‘fiSecondaryDesc’ and from their name they look related to ‘fiBaseModel’. So let’s analyze them together.</li>
</ul>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a>df_raw[[<span class="st">'fiBaseModel'</span>, <span class="st">'fiModelDesc'</span>, <span class="st">'fiSecondaryDesc'</span>]].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>fiBaseModel</th>
      <th>fiModelDesc</th>
      <th>fiSecondaryDesc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>521</td>
      <td>521D</td>
      <td>D</td>
    </tr>
    <tr>
      <th>1</th>
      <td>950</td>
      <td>950FII</td>
      <td>F</td>
    </tr>
    <tr>
      <th>2</th>
      <td>226</td>
      <td>226</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PC120</td>
      <td>PC120-6E</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>S175</td>
      <td>S175</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>310</td>
      <td>310G</td>
      <td>G</td>
    </tr>
    <tr>
      <th>6</th>
      <td>790</td>
      <td>790ELC</td>
      <td>E</td>
    </tr>
    <tr>
      <th>7</th>
      <td>416</td>
      <td>416D</td>
      <td>D</td>
    </tr>
    <tr>
      <th>8</th>
      <td>430</td>
      <td>430HAG</td>
      <td>HAG</td>
    </tr>
    <tr>
      <th>9</th>
      <td>988</td>
      <td>988B</td>
      <td>B</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<ul>
<li>fiBaseModel, fiModelDesc, fiSecondaryDesc: From the above table all these three features are very much related but their values are very random and do not give us much information. So let’s leave them as it is.</li>
<li>YearMade: It has numbers. Not a candidate for FE.</li>
<li>fiProductClassDesc. This feature is also encode so let’s visit it’s original values.</li>
</ul>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>df_raw[<span class="st">'fiProductClassDesc'</span>].unique()[:<span class="dv">15</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>array(['Wheel Loader - 110.0 to 120.0 Horsepower',
       'Wheel Loader - 150.0 to 175.0 Horsepower',
       'Skid Steer Loader - 1351.0 to 1601.0 Lb Operating Capacity',
       'Hydraulic Excavator, Track - 12.0 to 14.0 Metric Tons',
       'Skid Steer Loader - 1601.0 to 1751.0 Lb Operating Capacity',
       'Backhoe Loader - 14.0 to 15.0 Ft Standard Digging Depth',
       'Hydraulic Excavator, Track - 21.0 to 24.0 Metric Tons',
       'Hydraulic Excavator, Track - 3.0 to 4.0 Metric Tons',
       'Wheel Loader - 350.0 to 500.0 Horsepower',
       'Track Type Tractor, Dozer - 20.0 to 75.0 Horsepower',
       'Hydraulic Excavator, Track - 19.0 to 21.0 Metric Tons',
       'Hydraulic Excavator, Track - 4.0 to 5.0 Metric Tons',
       'Hydraulic Excavator, Track - 2.0 to 3.0 Metric Tons',
       'Hydraulic Excavator, Track - 24.0 to 28.0 Metric Tons',
       'Motorgrader - 45.0 to 130.0 Horsepower'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li><strong>fiProductClassDesc</strong>: This feature has text strings and it is also showing that they are not randow but has some pattern in then. They seems to be a good candidate for FE. We will do that in next section.</li>
<li>ModelID, YearSold: These features have numbers. Not a candidate for FE.</li>
<li>Hydraulics_Flow: It is encoded so let’s visit original values first.</li>
</ul>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>df_raw[<span class="st">'Hydraulics_Flow'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>array([nan, 'Standard', 'High Flow', 'None or Unspecified'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li><strong>Hydraulics_Flow</strong>: We label encoded it and it came up as an important feature. Its values are showing low variance so it is a better candidate for one-hot encoding. We will do that in the next section.</li>
<li>state: It is encoded so let’s visit its original values.</li>
</ul>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="bu">print</span>(<span class="ss">f"total unique values: </span><span class="sc">{</span><span class="bu">len</span>(df_raw[<span class="st">'state'</span>].unique())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb102-2"><a href="#cb102-2"></a>df_raw[<span class="st">'state'</span>].unique()[:<span class="dv">15</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total unique values: 53</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>array(['Alabama', 'North Carolina', 'New York', 'Texas', 'Arizona',
       'Florida', 'Illinois', 'Oregon', 'Ohio', 'Arkansas', 'Wisconsin',
       'Kansas', 'Nevada', 'Iowa', 'Maine'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li>state: By looking at original values we can see that it is a categorical nominal feature. It can be one hot encoded but since it has high variance (53 unique values) it is better to keep it as label encoded. So leave this feature as it is.</li>
<li>Enclosure: It is encoded. So let’s check original values</li>
</ul>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="bu">print</span>(<span class="ss">f"total unique values: </span><span class="sc">{</span><span class="bu">len</span>(df_raw[<span class="st">'Enclosure'</span>].unique())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a>df_raw[<span class="st">'Enclosure'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total unique values: 7</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>array(['EROPS w AC', 'OROPS', 'EROPS', nan, 'EROPS AC', 'NO ROPS',
       'None or Unspecified'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li><strong>Enclosure</strong>: Original values show that it is a categorical feature with good importance and low variance, so it is also suitable for OHE.</li>
<li>Hydraulics: It is also encoded. So let’s check original values</li>
</ul>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a><span class="bu">print</span>(<span class="ss">f"total unique values: </span><span class="sc">{</span><span class="bu">len</span>(df_raw[<span class="st">'Hydraulics'</span>].unique())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-2"><a href="#cb108-2"></a>df_raw[<span class="st">'Hydraulics'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total unique values: 13</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>array(['2 Valve', 'Auxiliary', nan, 'Standard', 'Base + 1 Function',
       'Base + 3 Function', '4 Valve', '3 Valve', 'Base + 2 Function',
       'Base + 4 Function', 'None or Unspecified', 'Base + 5 Function',
       'Base + 6 Function'], dtype=object)</code></pre>
</div>
</div>
<ul>
<li>Hydraulics: Now this feature is again categorical, does not have high variance but also has low importance. We can consider it for OHE but since it is coming at the lower end feature importance, it will not have much impact on model performace. So we can skip it for OHE.</li>
<li>For the remaining features, importance is not significant enough to be considered for any FE. We can keep them as it is.</li>
<li><strong>saledate</strong>: We did not use this feature in our last model training. But from the feature importance we can see that features that contain any date information are showing significant importance. So we should also include this feature in our next model.</li>
</ul>
<p>To summarize this section, the features that are suitable for any FE are * fiProductClassDesc * Hydraulics_Flow * Enclosure * saledate</p>
<section id="fiproductclassdesc" class="level3">
<h3 class="anchored" data-anchor-id="fiproductclassdesc">fiProductClassDesc</h3>
<p>Let’s check the original values for this feature one more time.</p>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>df_raw[<span class="st">'fiProductClassDesc'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>0             Wheel Loader - 110.0 to 120.0 Horsepower
1             Wheel Loader - 150.0 to 175.0 Horsepower
2    Skid Steer Loader - 1351.0 to 1601.0 Lb Operat...
3    Hydraulic Excavator, Track - 12.0 to 14.0 Metr...
4    Skid Steer Loader - 1601.0 to 1751.0 Lb Operat...
Name: fiProductClassDesc, dtype: object</code></pre>
</div>
</div>
<p>Though this feature is named ‘ProductClassDesc’ but by looking at its value we can see that besides class description there is also information on class specification. If we take the first value then * ‘Wheel Loader’ -&gt; this is the class description * ‘110.0 to 120.0 Horsepower’ -&gt; this is class specification</p>
<p>and even in the class specification we have * 110 -&gt; spec lower limit * 120 -&gt; spec upper limit * ‘Horsepower’ -&gt; spec unit</p>
<p>Use this information to create new columns</p>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a><span class="co">## </span></span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="co"># split the class description</span></span>
<span id="cb113-3"><a href="#cb113-3"></a>df_split <span class="op">=</span> df_raw.fiProductClassDesc.<span class="bu">str</span>.split(<span class="st">' - '</span>,expand<span class="op">=</span><span class="va">True</span>).values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a><span class="co">##</span></span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="co"># on 0 index we have class description</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>df_split[:,<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>array(['Wheel Loader', 'Wheel Loader', 'Skid Steer Loader', ...,
       'Hydraulic Excavator, Track', 'Hydraulic Excavator, Track',
       'Hydraulic Excavator, Track'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a><span class="co">##</span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="co"># on 1 index we have class specification</span></span>
<span id="cb116-3"><a href="#cb116-3"></a>df_split[:,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>array(['110.0 to 120.0 Horsepower', '150.0 to 175.0 Horsepower',
       '1351.0 to 1601.0 Lb Operating Capacity', ...,
       '3.0 to 4.0 Metric Tons', '2.0 to 3.0 Metric Tons',
       '2.0 to 3.0 Metric Tons'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a><span class="co">##</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="co"># let's create two new columns for this</span></span>
<span id="cb118-3"><a href="#cb118-3"></a>df[<span class="st">'fiProductClassDesc'</span>] <span class="op">=</span> df_split[:,<span class="dv">0</span>] </span>
<span id="cb118-4"><a href="#cb118-4"></a>df[<span class="st">'fiProductClassSpec'</span>] <span class="op">=</span> df_split[:,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a><span class="co">##</span></span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="co"># split class spec further to get limits and units</span></span>
<span id="cb119-3"><a href="#cb119-3"></a>pattern <span class="op">=</span> <span class="vs">r'([0-9.\+]*)(?: to ([0-9.\+]*)|\+) ([a-zA-Z ]*)'</span></span>
<span id="cb119-4"><a href="#cb119-4"></a>df_split <span class="op">=</span> df[<span class="st">'fiProductClassSpec'</span>].<span class="bu">str</span>.extract(pattern, expand<span class="op">=</span><span class="va">True</span>).values</span>
<span id="cb119-5"><a href="#cb119-5"></a>df_split <span class="op">=</span> pd.DataFrame(df_split, columns<span class="op">=</span>[<span class="st">'fiProductClassSpec_lower'</span>, <span class="st">'fiProductClassSpec_upper'</span>, <span class="st">'fiProductClassSpec_units'</span>])</span>
<span id="cb119-6"><a href="#cb119-6"></a>df_split.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>110.0</td>
      <td>120.0</td>
      <td>Horsepower</td>
    </tr>
    <tr>
      <th>1</th>
      <td>150.0</td>
      <td>175.0</td>
      <td>Horsepower</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>Lb Operating Capacity</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12.0</td>
      <td>14.0</td>
      <td>Metric Tons</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>Lb Operating Capacity</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a><span class="co">##</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="co"># merge new columns to our dataset</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>df <span class="op">=</span> pd.concat([df, df_split], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="kw">del</span> df[<span class="st">'fiProductClassSpec'</span>] <span class="co"># class spec is no more required. we have it's sub-features</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalePrice</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>saledate</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Enclosure</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Hydraulics_Flow</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
      <th>YearMade_na</th>
      <th>YearSold</th>
      <th>YearsInUse</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Tire_Size_na</th>
      <th>Stick_Length_na</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Blade_Width_na</th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>66000</td>
      <td>3157</td>
      <td>121</td>
      <td>23</td>
      <td>2004.0</td>
      <td>68.0</td>
      <td>2</td>
      <td>2006-11-16</td>
      <td>950</td>
      <td>296</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Wheel Loader</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2006</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>110.0</td>
      <td>120.0</td>
      <td>Horsepower</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57000</td>
      <td>77</td>
      <td>121</td>
      <td>23</td>
      <td>1996.0</td>
      <td>4640.0</td>
      <td>2</td>
      <td>2004-03-26</td>
      <td>1725</td>
      <td>527</td>
      <td>54</td>
      <td>97</td>
      <td>0</td>
      <td>4</td>
      <td>Wheel Loader</td>
      <td>33</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2004</td>
      <td>8.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>150.0</td>
      <td>175.0</td>
      <td>Horsepower</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>7009</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>2838.0</td>
      <td>1</td>
      <td>2004-02-26</td>
      <td>331</td>
      <td>110</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Skid Steer Loader</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2004</td>
      <td>3.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>Lb Operating Capacity</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38500</td>
      <td>332</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>3486.0</td>
      <td>1</td>
      <td>2011-05-19</td>
      <td>3674</td>
      <td>1375</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>6</td>
      <td>Hydraulic Excavator, Track</td>
      <td>44</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2011</td>
      <td>10.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>12.0</td>
      <td>14.0</td>
      <td>Metric Tons</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11000</td>
      <td>17311</td>
      <td>121</td>
      <td>23</td>
      <td>2007.0</td>
      <td>722.0</td>
      <td>3</td>
      <td>2009-07-23</td>
      <td>4208</td>
      <td>1529</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Skid Steer Loader</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2009</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>Lb Operating Capacity</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="co">##</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="co"># convert to numerical features</span></span>
<span id="cb121-3"><a href="#cb121-3"></a>df[<span class="st">'fiProductClassSpec_lower'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'fiProductClassSpec_lower'</span>])</span>
<span id="cb121-4"><a href="#cb121-4"></a>df[<span class="st">'fiProductClassSpec_upper'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'fiProductClassSpec_upper'</span>])</span>
<span id="cb121-5"><a href="#cb121-5"></a></span>
<span id="cb121-6"><a href="#cb121-6"></a><span class="co"># apply fix for numerical features</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>fix_missing_num(df, <span class="st">'fiProductClassSpec_lower'</span>)</span>
<span id="cb121-8"><a href="#cb121-8"></a>fix_missing_num(df, <span class="st">'fiProductClassSpec_upper'</span>)</span>
<span id="cb121-9"><a href="#cb121-9"></a></span>
<span id="cb121-10"><a href="#cb121-10"></a><span class="co"># apply fix for categorical features</span></span>
<span id="cb121-11"><a href="#cb121-11"></a>df_string_to_cat(df)</span>
<span id="cb121-12"><a href="#cb121-12"></a>df_cat_to_catcode(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>label encoding applied on fiProductClassDesc
label encoding applied on fiProductClassSpec_units</code></pre>
</div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a>(rf, feature_names, feature_importance, oob_hydralics) <span class="op">=</span> train_and_plot_model(df, drop_features<span class="op">=</span>[<span class="st">'saledate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  1.6min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  2.6min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.905 
Tree leaves =  14,650,747 
Median depth = 47.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-82-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>There is only a slight increase in OOB score but if we check the feature importance plot both <code>fiProductClassSpec_upper</code> and <code>fiProductClassSpec_lower</code> are showing high importance. We can take this as a positive signal for good features.</p>
</section>
<section id="hydralics_flow" class="level3">
<h3 class="anchored" data-anchor-id="hydralics_flow">Hydralics_Flow</h3>
<p>We need to apply one hot encoding (OHE) to this feature. Let’s start by checking unique values for <code>Hydraulics_Flow</code>.</p>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1"></a>df[<span class="st">'Hydraulics_Flow'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>0    357788
2     42784
1       553
Name: Hydraulics_Flow, dtype: int64</code></pre>
</div>
</div>
<p>We have encoded this feature in the preprocessing section. Although we can use this encoded feature for one-hot encoding but we don’t have original labels at this point. It would be better if we use original labels for OHE so that the dummy columns created as a result of that also have proper names with labels. Using encoded dummy column names makes them difficult to understand and follow. let’s use the original dataframe to check the unique values.</p>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1"></a>df_raw[<span class="st">'Hydraulics_Flow'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>NaN                    357763
Standard                42784
High Flow                 553
None or Unspecified        25
Name: Hydraulics_Flow, dtype: int64</code></pre>
</div>
</div>
<p>Before applying OHE we need to preprocess ‘None or Unspecified’ as they repsent the same as <code>np.nan</code>. So let’s do that.</p>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a><span class="co">## </span></span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="co"># get the original values</span></span>
<span id="cb130-3"><a href="#cb130-3"></a>df[<span class="st">'Hydraulics_Flow'</span>] <span class="op">=</span> df_raw[<span class="st">'Hydraulics_Flow'</span>]</span>
<span id="cb130-4"><a href="#cb130-4"></a>df[<span class="st">'Hydraulics_Flow'</span>] <span class="op">=</span> df[<span class="st">'Hydraulics_Flow'</span>].replace(<span class="st">'None or Unspecified'</span>, np.nan)</span>
<span id="cb130-5"><a href="#cb130-5"></a></span>
<span id="cb130-6"><a href="#cb130-6"></a>df[<span class="st">'Hydraulics_Flow'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>NaN          357788
Standard      42784
High Flow       553
Name: Hydraulics_Flow, dtype: int64</code></pre>
</div>
</div>
<p>Let’s check the first few rows of this column. We will use them to verify our final result.</p>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1"></a>df[<span class="st">'Hydraulics_Flow'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>0         NaN
1         NaN
2    Standard
3         NaN
4    Standard
Name: Hydraulics_Flow, dtype: object</code></pre>
</div>
</div>
<p>Notice that in the first five rows there are ‘Standard’ values at row index 2 and 4, and the remaining are ‘NaN’ values. We will OHE them in the next step and compare the results to ensure encoding is properly working.</p>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb134-2"><a href="#cb134-2"></a></span>
<span id="cb134-3"><a href="#cb134-3"></a>onehot_encoder <span class="op">=</span> OneHotEncoder()</span>
<span id="cb134-4"><a href="#cb134-4"></a>onehot_output <span class="op">=</span> onehot_encoder.fit_transform(df[[<span class="st">'Hydraulics_Flow'</span>]])</span>
<span id="cb134-5"><a href="#cb134-5"></a></span>
<span id="cb134-6"><a href="#cb134-6"></a><span class="co"># check the output</span></span>
<span id="cb134-7"><a href="#cb134-7"></a><span class="bu">print</span>(onehot_output[:<span class="dv">5</span>].toarray())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0. 0. 1.]
 [0. 0. 1.]
 [0. 1. 0.]
 [0. 0. 1.]
 [0. 1. 0.]]</code></pre>
</div>
</div>
<p>These are same five rows but this time encoded with one-hot values. From the position of ‘1’ appearing in different columns we can deduce that first column is for label ‘High Flow’ and second is for ‘Standard’ and third is for ‘NaN’. It would be easier for us to track these dummy columns if we have proper names on them. So let’s do that.</p>
<p>We can get the dummy column names by calling <code>get_feature_names_out()</code> on our encoder.</p>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># name of the columns</span></span>
<span id="cb136-2"><a href="#cb136-2"></a>onehot_encoder.get_feature_names_out()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<pre><code>array(['Hydraulics_Flow_High Flow', 'Hydraulics_Flow_Standard',
       'Hydraulics_Flow_nan'], dtype=object)</code></pre>
</div>
</div>
<p>To create a dataframe of these dummy variables.</p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>df_onehot <span class="op">=</span> pd.DataFrame(onehot_output.toarray(), columns<span class="op">=</span>onehot_encoder.get_feature_names_out())</span>
<span id="cb138-2"><a href="#cb138-2"></a>df_onehot.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Hydraulics_Flow_High Flow</th>
      <th>Hydraulics_Flow_Standard</th>
      <th>Hydraulics_Flow_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>At this point <code>Hydraulics_Flow</code> is OHE so we can drop the original column from the dataset and add these encoded columns.</p>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a><span class="kw">del</span> df[<span class="st">'Hydraulics_Flow'</span>]</span>
<span id="cb139-2"><a href="#cb139-2"></a></span>
<span id="cb139-3"><a href="#cb139-3"></a>df <span class="op">=</span> pd.concat([df, df_onehot], axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># concat dataframes column wise</span></span>
<span id="cb139-4"><a href="#cb139-4"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalePrice</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>saledate</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Enclosure</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
      <th>YearMade_na</th>
      <th>YearSold</th>
      <th>YearsInUse</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Tire_Size_na</th>
      <th>Stick_Length_na</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Blade_Width_na</th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
      <th>fiProductClassSpec_lower_na</th>
      <th>fiProductClassSpec_upper_na</th>
      <th>Hydraulics_Flow_High Flow</th>
      <th>Hydraulics_Flow_Standard</th>
      <th>Hydraulics_Flow_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>66000</td>
      <td>3157</td>
      <td>121</td>
      <td>23</td>
      <td>2004.0</td>
      <td>68.0</td>
      <td>2</td>
      <td>2006-11-16</td>
      <td>950</td>
      <td>296</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2006</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>110.0</td>
      <td>120.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57000</td>
      <td>77</td>
      <td>121</td>
      <td>23</td>
      <td>1996.0</td>
      <td>4640.0</td>
      <td>2</td>
      <td>2004-03-26</td>
      <td>1725</td>
      <td>527</td>
      <td>54</td>
      <td>97</td>
      <td>0</td>
      <td>4</td>
      <td>6</td>
      <td>33</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2004</td>
      <td>8.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>150.0</td>
      <td>175.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>7009</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>2838.0</td>
      <td>1</td>
      <td>2004-02-26</td>
      <td>331</td>
      <td>110</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2004</td>
      <td>3.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38500</td>
      <td>332</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>3486.0</td>
      <td>1</td>
      <td>2011-05-19</td>
      <td>3674</td>
      <td>1375</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>44</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2011</td>
      <td>10.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>12.0</td>
      <td>14.0</td>
      <td>4</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11000</td>
      <td>17311</td>
      <td>121</td>
      <td>23</td>
      <td>2007.0</td>
      <td>722.0</td>
      <td>3</td>
      <td>2009-07-23</td>
      <td>4208</td>
      <td>1529</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2009</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s retain our model to check if there is any affect on model performance.</p>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a>(rf, feature_names, feature_importance, oob_hydralics) <span class="op">=</span> train_and_plot_model(df, drop_features<span class="op">=</span>[<span class="st">'saledate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  1.6min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  2.6min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.905 
Tree leaves =  14,650,376 
Median depth = 48.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-91-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>There is no effect on the model performance but one feature ‘Hydraulics_Flow_nan’ is showing some importance on the plot. The remaining features (‘Hydraulics_Flow_High Flow’ and ‘Hydraulics_Flow_Standard’) do not affect the model’s performance. If it was not of ‘Hydraulics_Flow_nan’ importance we could have skipped OHE for ‘Hydraulics_Flow’.</p>
</section>
<section id="enclosure" class="level3">
<h3 class="anchored" data-anchor-id="enclosure">Enclosure</h3>
<p>Next feature is <code>Enclosure</code>, and we will follow the same steps as for last feature to one-hot encode it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a><span class="co">##</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="co"># check value counts</span></span>
<span id="cb143-3"><a href="#cb143-3"></a>df_raw[<span class="st">'Enclosure'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>OROPS                  173932
EROPS                  139026
EROPS w AC              87820
NaN                       325
EROPS AC                   17
NO ROPS                     3
None or Unspecified         2
Name: Enclosure, dtype: int64</code></pre>
</div>
</div>
<p>Here <strong>ROPS</strong> is an abbreviation for <strong>Roll Over Protection System</strong> and there are multiple variants of this standard * OROPS = Open ROPS * EROPS = Enclosed ROPS * EROPS AC = Enclosed ROPS with Air Conditioning * EROPS w AC = Enclosed ROPS with Air Conditioning. Same as ‘EROPS AC’ * NO ROPS = No ROPS. Same as ‘NaN’ or ‘None or Unspecified’</p>
<p>You can read more about ROPS standards here * http://www.miningrops.com.au/ropsintro.html * https://www.youtube.com/watch?v=LZ40O1My8E4&amp;ab_channel=MissouriEarthMovers</p>
<p>Using this information we can also preprocess this feature to make its values more consistent.</p>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1"></a><span class="co">## </span></span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="co"># get the original values</span></span>
<span id="cb145-3"><a href="#cb145-3"></a>df[<span class="st">'Enclosure'</span>] <span class="op">=</span> df_raw[<span class="st">'Enclosure'</span>]</span>
<span id="cb145-4"><a href="#cb145-4"></a></span>
<span id="cb145-5"><a href="#cb145-5"></a><span class="co"># change 'None or Unspecified' and 'NO ROPS' to np.nan</span></span>
<span id="cb145-6"><a href="#cb145-6"></a>df[<span class="st">'Enclosure'</span>] <span class="op">=</span> df[<span class="st">'Enclosure'</span>].replace(<span class="st">'None or Unspecified'</span>, np.nan)</span>
<span id="cb145-7"><a href="#cb145-7"></a>df[<span class="st">'Enclosure'</span>] <span class="op">=</span> df[<span class="st">'Enclosure'</span>].replace(<span class="st">'NO ROPS'</span>, np.nan)</span>
<span id="cb145-8"><a href="#cb145-8"></a></span>
<span id="cb145-9"><a href="#cb145-9"></a><span class="co"># change 'EROPS w AC' to 'EROPS AC'</span></span>
<span id="cb145-10"><a href="#cb145-10"></a>df[<span class="st">'Enclosure'</span>] <span class="op">=</span> df[<span class="st">'Enclosure'</span>].replace(<span class="st">'EROPS w AC'</span>, <span class="st">'EROPS AC'</span>)</span>
<span id="cb145-11"><a href="#cb145-11"></a></span>
<span id="cb145-12"><a href="#cb145-12"></a>df[<span class="st">'Enclosure'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<pre><code>OROPS       173932
EROPS       139026
EROPS AC     87837
NaN            330
Name: Enclosure, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1"></a><span class="co">##</span></span>
<span id="cb147-2"><a href="#cb147-2"></a><span class="co"># before OHE</span></span>
<span id="cb147-3"><a href="#cb147-3"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalePrice</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>saledate</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Enclosure</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
      <th>YearMade_na</th>
      <th>YearSold</th>
      <th>YearsInUse</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Tire_Size_na</th>
      <th>Stick_Length_na</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Blade_Width_na</th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
      <th>fiProductClassSpec_lower_na</th>
      <th>fiProductClassSpec_upper_na</th>
      <th>Hydraulics_Flow_High Flow</th>
      <th>Hydraulics_Flow_Standard</th>
      <th>Hydraulics_Flow_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>66000</td>
      <td>3157</td>
      <td>121</td>
      <td>23</td>
      <td>2004.0</td>
      <td>68.0</td>
      <td>2</td>
      <td>2006-11-16</td>
      <td>950</td>
      <td>296</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>EROPS AC</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2006</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>110.0</td>
      <td>120.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57000</td>
      <td>77</td>
      <td>121</td>
      <td>23</td>
      <td>1996.0</td>
      <td>4640.0</td>
      <td>2</td>
      <td>2004-03-26</td>
      <td>1725</td>
      <td>527</td>
      <td>54</td>
      <td>97</td>
      <td>0</td>
      <td>4</td>
      <td>6</td>
      <td>33</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>EROPS AC</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2004</td>
      <td>8.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>150.0</td>
      <td>175.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>7009</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>2838.0</td>
      <td>1</td>
      <td>2004-02-26</td>
      <td>331</td>
      <td>110</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>OROPS</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2004</td>
      <td>3.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38500</td>
      <td>332</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>3486.0</td>
      <td>1</td>
      <td>2011-05-19</td>
      <td>3674</td>
      <td>1375</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>44</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>EROPS AC</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2011</td>
      <td>10.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>12.0</td>
      <td>14.0</td>
      <td>4</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11000</td>
      <td>17311</td>
      <td>121</td>
      <td>23</td>
      <td>2007.0</td>
      <td>722.0</td>
      <td>3</td>
      <td>2009-07-23</td>
      <td>4208</td>
      <td>1529</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>EROPS</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2009</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1"></a><span class="co">##</span></span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="co"># one hot encode 'Enclosure'</span></span>
<span id="cb148-3"><a href="#cb148-3"></a>onehot_encoder <span class="op">=</span> OneHotEncoder()</span>
<span id="cb148-4"><a href="#cb148-4"></a>onehot_output <span class="op">=</span> onehot_encoder.fit_transform(df[[<span class="st">'Enclosure'</span>]])</span>
<span id="cb148-5"><a href="#cb148-5"></a></span>
<span id="cb148-6"><a href="#cb148-6"></a>df_onehot <span class="op">=</span> pd.DataFrame(onehot_output.toarray(), columns<span class="op">=</span>onehot_encoder.get_feature_names_out())</span>
<span id="cb148-7"><a href="#cb148-7"></a>df_onehot.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Enclosure_EROPS</th>
      <th>Enclosure_EROPS AC</th>
      <th>Enclosure_OROPS</th>
      <th>Enclosure_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a><span class="co">## </span></span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="co"># drop original column</span></span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="kw">del</span> df[<span class="st">'Enclosure'</span>]</span>
<span id="cb149-4"><a href="#cb149-4"></a></span>
<span id="cb149-5"><a href="#cb149-5"></a><span class="co"># add dummy columns to the dataframe</span></span>
<span id="cb149-6"><a href="#cb149-6"></a>df <span class="op">=</span> pd.concat([df, df_onehot], axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># concat dataframes column wise</span></span>
<span id="cb149-7"><a href="#cb149-7"></a></span>
<span id="cb149-8"><a href="#cb149-8"></a><span class="co"># after OHE</span></span>
<span id="cb149-9"><a href="#cb149-9"></a>df.head() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalePrice</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>saledate</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
      <th>YearMade_na</th>
      <th>YearSold</th>
      <th>YearsInUse</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Tire_Size_na</th>
      <th>Stick_Length_na</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Blade_Width_na</th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
      <th>fiProductClassSpec_lower_na</th>
      <th>fiProductClassSpec_upper_na</th>
      <th>Hydraulics_Flow_High Flow</th>
      <th>Hydraulics_Flow_Standard</th>
      <th>Hydraulics_Flow_nan</th>
      <th>Enclosure_EROPS</th>
      <th>Enclosure_EROPS AC</th>
      <th>Enclosure_OROPS</th>
      <th>Enclosure_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>66000</td>
      <td>3157</td>
      <td>121</td>
      <td>23</td>
      <td>2004.0</td>
      <td>68.0</td>
      <td>2</td>
      <td>2006-11-16</td>
      <td>950</td>
      <td>296</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2006</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>110.0</td>
      <td>120.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57000</td>
      <td>77</td>
      <td>121</td>
      <td>23</td>
      <td>1996.0</td>
      <td>4640.0</td>
      <td>2</td>
      <td>2004-03-26</td>
      <td>1725</td>
      <td>527</td>
      <td>54</td>
      <td>97</td>
      <td>0</td>
      <td>4</td>
      <td>6</td>
      <td>33</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2004</td>
      <td>8.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>150.0</td>
      <td>175.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>7009</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>2838.0</td>
      <td>1</td>
      <td>2004-02-26</td>
      <td>331</td>
      <td>110</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2004</td>
      <td>3.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38500</td>
      <td>332</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>3486.0</td>
      <td>1</td>
      <td>2011-05-19</td>
      <td>3674</td>
      <td>1375</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>44</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2011</td>
      <td>10.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>12.0</td>
      <td>14.0</td>
      <td>4</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11000</td>
      <td>17311</td>
      <td>121</td>
      <td>23</td>
      <td>2007.0</td>
      <td>722.0</td>
      <td>3</td>
      <td>2009-07-23</td>
      <td>4208</td>
      <td>1529</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2009</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s retain our model to check if there is any affect on model performance.</p>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1"></a>(rf, feature_names, feature_importance, oob_enclosure) <span class="op">=</span> train_and_plot_model(df, drop_features<span class="op">=</span>[<span class="st">'saledate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  2.0min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  3.6min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.902 
Tree leaves =  14,668,686 
Median depth = 45.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-97-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>There is a slight decrease in model performance but one new feature ‘Enclosure_EROPS AC’ is showing very high on the importance plot.</p>
</section>
<section id="saledate" class="level3">
<h3 class="anchored" data-anchor-id="saledate">saledate</h3>
<p>We have already created ‘yearsold’ feature. We can more consequent features from ‘saledate’.</p>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a>df[<span class="st">"salemonth"</span>] <span class="op">=</span> df[<span class="st">'saledate'</span>].dt.month</span>
<span id="cb153-2"><a href="#cb153-2"></a>df[<span class="st">"saleday"</span>] <span class="op">=</span> df[<span class="st">'saledate'</span>].dt.day</span>
<span id="cb153-3"><a href="#cb153-3"></a>df[<span class="st">"saledayofweek"</span>] <span class="op">=</span> df[<span class="st">'saledate'</span>].dt.dayofweek</span>
<span id="cb153-4"><a href="#cb153-4"></a>df[<span class="st">"saledayofyear"</span>] <span class="op">=</span> df[<span class="st">'saledate'</span>].dt.dayofyear</span>
<span id="cb153-5"><a href="#cb153-5"></a></span>
<span id="cb153-6"><a href="#cb153-6"></a><span class="co"># we can drop the orignal</span></span>
<span id="cb153-7"><a href="#cb153-7"></a><span class="kw">del</span> df[<span class="st">'saledate'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>SalePrice</th>
      <th>ModelID</th>
      <th>datasource</th>
      <th>auctioneerID</th>
      <th>YearMade</th>
      <th>MachineHoursCurrentMeter</th>
      <th>UsageBand</th>
      <th>fiModelDesc</th>
      <th>fiBaseModel</th>
      <th>fiSecondaryDesc</th>
      <th>fiModelSeries</th>
      <th>fiModelDescriptor</th>
      <th>ProductSize</th>
      <th>fiProductClassDesc</th>
      <th>state</th>
      <th>ProductGroup</th>
      <th>ProductGroupDesc</th>
      <th>Drive_System</th>
      <th>Forks</th>
      <th>Pad_Type</th>
      <th>Ride_Control</th>
      <th>Stick</th>
      <th>Transmission</th>
      <th>Turbocharged</th>
      <th>Blade_Extension</th>
      <th>Blade_Width</th>
      <th>Enclosure_Type</th>
      <th>Engine_Horsepower</th>
      <th>Hydraulics</th>
      <th>Pushblock</th>
      <th>Ripper</th>
      <th>Scarifier</th>
      <th>Tip_Control</th>
      <th>Tire_Size</th>
      <th>Coupler</th>
      <th>Coupler_System</th>
      <th>Grouser_Tracks</th>
      <th>Track_Type</th>
      <th>Undercarriage_Pad_Width</th>
      <th>Stick_Length</th>
      <th>Thumb</th>
      <th>Pattern_Changer</th>
      <th>Grouser_Type</th>
      <th>Backhoe_Mounting</th>
      <th>Blade_Type</th>
      <th>Travel_Controls</th>
      <th>Differential_Type</th>
      <th>Steering_Controls</th>
      <th>YearMade_na</th>
      <th>YearSold</th>
      <th>YearsInUse</th>
      <th>MachineHoursCurrentMeter_na</th>
      <th>Tire_Size_na</th>
      <th>Stick_Length_na</th>
      <th>Undercarriage_Pad_Width_na</th>
      <th>Blade_Width_na</th>
      <th>fiProductClassSpec_lower</th>
      <th>fiProductClassSpec_upper</th>
      <th>fiProductClassSpec_units</th>
      <th>fiProductClassSpec_lower_na</th>
      <th>fiProductClassSpec_upper_na</th>
      <th>Hydraulics_Flow_High Flow</th>
      <th>Hydraulics_Flow_Standard</th>
      <th>Hydraulics_Flow_nan</th>
      <th>Enclosure_EROPS</th>
      <th>Enclosure_EROPS AC</th>
      <th>Enclosure_OROPS</th>
      <th>Enclosure_nan</th>
      <th>salemonth</th>
      <th>saleday</th>
      <th>saledayofweek</th>
      <th>saledayofyear</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>66000</td>
      <td>3157</td>
      <td>121</td>
      <td>23</td>
      <td>2004.0</td>
      <td>68.0</td>
      <td>2</td>
      <td>950</td>
      <td>296</td>
      <td>40</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2006</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>110.0</td>
      <td>120.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>11</td>
      <td>16</td>
      <td>3</td>
      <td>320</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57000</td>
      <td>77</td>
      <td>121</td>
      <td>23</td>
      <td>1996.0</td>
      <td>4640.0</td>
      <td>2</td>
      <td>1725</td>
      <td>527</td>
      <td>54</td>
      <td>97</td>
      <td>0</td>
      <td>4</td>
      <td>6</td>
      <td>33</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>False</td>
      <td>2004</td>
      <td>8.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>150.0</td>
      <td>175.0</td>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3</td>
      <td>26</td>
      <td>4</td>
      <td>86</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>7009</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>2838.0</td>
      <td>1</td>
      <td>331</td>
      <td>110</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2004</td>
      <td>3.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1351.0</td>
      <td>1601.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
      <td>26</td>
      <td>3</td>
      <td>57</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38500</td>
      <td>332</td>
      <td>121</td>
      <td>23</td>
      <td>2001.0</td>
      <td>3486.0</td>
      <td>1</td>
      <td>3674</td>
      <td>1375</td>
      <td>0</td>
      <td>44</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>44</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2011</td>
      <td>10.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>12.0</td>
      <td>14.0</td>
      <td>4</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5</td>
      <td>19</td>
      <td>3</td>
      <td>139</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11000</td>
      <td>17311</td>
      <td>121</td>
      <td>23</td>
      <td>2007.0</td>
      <td>722.0</td>
      <td>3</td>
      <td>4208</td>
      <td>1529</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>28.0</td>
      <td>9.7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>2009</td>
      <td>2.0</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>1601.0</td>
      <td>1751.0</td>
      <td>3</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7</td>
      <td>23</td>
      <td>3</td>
      <td>204</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1"></a>(rf, feature_names, feature_importance, oob_date) <span class="op">=</span> train_and_plot_model(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 4 concurrent workers.
[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  2.4min
[Parallel(n_jobs=-1)]: Done  70 out of  70 | elapsed:  3.9min finished</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>OOB scrore =  0.907 
Tree leaves =  14,493,456 
Median depth = 45.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-04-25-bluebook-for-bulldozers_files/figure-html/cell-100-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>There is an increase in model performance and multiple newly created date features are showing good importance on the plot.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="hassaanbinaslam/myblog_utterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>