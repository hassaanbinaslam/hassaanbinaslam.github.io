<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-08-05">
<meta name="description" content="This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.">

<title>Building a Feature Repository with SageMaker Feature Store – Random Thoughts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ec1a476101e3788554028e6f9c82f7c1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1ST9BH6HX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-D1ST9BH6HX', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Building a Feature Repository with SageMaker Feature Store – Random Thoughts">
<meta property="og:description" content="This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.">
<meta property="og:image" content="https://hassaanbinaslam.github.io/posts/images/2022-08-05-sagemaker-feature-store.jpeg">
<meta property="og:site_name" content="Random Thoughts">
<meta name="twitter:title" content="Building a Feature Repository with SageMaker Feature Store – Random Thoughts">
<meta name="twitter:description" content="This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.">
<meta name="twitter:image" content="https://hassaanbinaslam.github.io/posts/images/2022-08-05-sagemaker-feature-store.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Random Thoughts</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hassaanbinaslam/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hassaanbinaslam/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hassaanbinaslam"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#environment" id="toc-environment" class="nav-link" data-scroll-target="#environment">Environment</a></li>
  <li><a href="#dataset-used-for-this-notebook" id="toc-dataset-used-for-this-notebook" class="nav-link" data-scroll-target="#dataset-used-for-this-notebook">Dataset used for this notebook</a>
  <ul class="collapse">
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source">Data source</a></li>
  <li><a href="#data-link" id="toc-data-link" class="nav-link" data-scroll-target="#data-link">Data link</a></li>
  <li><a href="#data-classification-goaltarget" id="toc-data-classification-goaltarget" class="nav-link" data-scroll-target="#data-classification-goaltarget">Data classification goal/target</a></li>
  <li><a href="#data-attributes-information" id="toc-data-attributes-information" class="nav-link" data-scroll-target="#data-attributes-information">Data attributes information</a>
  <ul class="collapse">
  <li><a href="#input-variables" id="toc-input-variables" class="nav-link" data-scroll-target="#input-variables">Input variables</a></li>
  <li><a href="#output-variable-desired-target" id="toc-output-variable-desired-target" class="nav-link" data-scroll-target="#output-variable-desired-target">Output variable (desired target)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#load-and-explore-data" id="toc-load-and-explore-data" class="nav-link" data-scroll-target="#load-and-explore-data">Load and explore data</a></li>
  <li><a href="#creating-a-feature-group" id="toc-creating-a-feature-group" class="nav-link" data-scroll-target="#creating-a-feature-group">Creating a feature group</a>
  <ul class="collapse">
  <li><a href="#considerations-for-creating-a-feature-group" id="toc-considerations-for-creating-a-feature-group" class="nav-link" data-scroll-target="#considerations-for-creating-a-feature-group">Considerations for creating a feature group</a></li>
  <li><a href="#create-feature-group-from-sagemaker-studio-ide" id="toc-create-feature-group-from-sagemaker-studio-ide" class="nav-link" data-scroll-target="#create-feature-group-from-sagemaker-studio-ide">Create feature group from SageMaker studio IDE</a></li>
  <li><a href="#create-feature-group-from-sagemaker-sdk" id="toc-create-feature-group-from-sagemaker-sdk" class="nav-link" data-scroll-target="#create-feature-group-from-sagemaker-sdk">Create feature group from SageMaker SDK</a></li>
  </ul></li>
  <li><a href="#ingest-data-to-feature-group" id="toc-ingest-data-to-feature-group" class="nav-link" data-scroll-target="#ingest-data-to-feature-group">Ingest data to feature group</a></li>
  <li><a href="#accessing-features-from-feature-store" id="toc-accessing-features-from-feature-store" class="nav-link" data-scroll-target="#accessing-features-from-feature-store">Accessing features from feature store</a>
  <ul class="collapse">
  <li><a href="#accessing-online-feature-store-from-sdk" id="toc-accessing-online-feature-store-from-sdk" class="nav-link" data-scroll-target="#accessing-online-feature-store-from-sdk">Accessing online feature store from SDK</a></li>
  <li><a href="#accessing-offline-feature-store-from-sdk" id="toc-accessing-offline-feature-store-from-sdk" class="nav-link" data-scroll-target="#accessing-offline-feature-store-from-sdk">Accessing offline feature store from SDK</a></li>
  <li><a href="#accessing-offline-store-from-athena" id="toc-accessing-offline-store-from-athena" class="nav-link" data-scroll-target="#accessing-offline-store-from-athena">Accessing offline store from Athena</a></li>
  </ul></li>
  <li><a href="#clean-up" id="toc-clean-up" class="nav-link" data-scroll-target="#clean-up">Clean up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Building a Feature Repository with SageMaker Feature Store</h1>
  <div class="quarto-categories">
    <div class="quarto-category">aws</div>
    <div class="quarto-category">ml</div>
    <div class="quarto-category">sagemaker</div>
  </div>
  </div>

<div>
  <div class="description">
    This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 5, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="images/2022-08-05-sagemaker-feature-store.jpeg" class="img-fluid"></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Amazon SageMaker Feature Store is a fully managed, purpose-built repository to store, share, and manage features for machine learning (ML) models. Features are inputs to ML models used during training and inference. For example, in an application that recommends a music playlist, features could include song ratings, listening duration, and listener demographics. Features are used repeatedly by multiple teams and feature quality is critical to ensure a highly accurate model. Also, when features used to train models offline in batch are made available for real-time inference, it’s hard to keep the two feature stores synchronized. SageMaker Feature Store provides a secured and unified store for feature use across the ML lifecycle.</p>
<p>https://aws.amazon.com/sagemaker/feature-store/</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-08-05-sagemaker-feature-store/feature-store.png" class="img-fluid figure-img"></p>
<figcaption>feature-store.png</figcaption>
</figure>
</div>
</section>
<section id="environment" class="level1">
<h1>Environment</h1>
<p>This notebook is prepared using Amazon SageMaker studio using <code>Python 3 (Data Science)</code> kernel running on <code>ml.t3.medium</code> instance.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">!</span>aws <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>aws-cli/1.25.27 Python/3.7.10 Linux/4.14.281-212.502.amzn2.x86_64 botocore/1.27.27</code></pre>
</div>
</div>
</section>
<section id="dataset-used-for-this-notebook" class="level1">
<h1>Dataset used for this notebook</h1>
<p>We will use a publically available bank marketing dataset. The data is related to direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact with the same client was required to access if the product (bank term deposit) would be (‘yes’) or not (‘no’) subscribed.</p>
<section id="data-source" class="level2">
<h2 class="anchored" data-anchor-id="data-source">Data source</h2>
<p>[Moro et al., 2014] S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014</p>
</section>
<section id="data-link" class="level2">
<h2 class="anchored" data-anchor-id="data-link">Data link</h2>
<p>UCI Machine Learning Repository: <a href="https://archive.ics.uci.edu/ml/datasets/bank+marketing">https://archive.ics.uci.edu/ml/datasets/bank+marketing</a>. Dataset has multiple files. we will use <code>bank-additional-full.csv</code> file that has all examples (41188) and 20 inputs, ordered by date.</p>
</section>
<section id="data-classification-goaltarget" class="level2">
<h2 class="anchored" data-anchor-id="data-classification-goaltarget">Data classification goal/target</h2>
<p>The classification goal is to predict if the client will subscribe (yes/no) a term deposit (variable <code>y</code>)</p>
</section>
<section id="data-attributes-information" class="level2">
<h2 class="anchored" data-anchor-id="data-attributes-information">Data attributes information</h2>
<section id="input-variables" class="level3">
<h3 class="anchored" data-anchor-id="input-variables">Input variables</h3>
<p><strong>attributes from bank client data</strong> 1. age (numeric) 2. job : type of job (categorical: ‘admin.’, ‘blue-collar’, ‘entrepreneur’, ‘housemaid’, ‘management’, ‘retired’, ‘self-employed’, ‘services’,‘student’, ‘technician’, ‘unemployed’, ‘unknown’) 3. marital : marital status (categorical: ‘divorced’, ‘married’, ‘single’, ‘unknown’; note: ‘divorced’ means divorced or widowed) 4. education (categorical: ‘basic.4y’, ‘basic.6y’, ‘basic.9y’, ‘high.school’, ‘illiterate’,‘professional.course’, ‘university.degree’,‘unknown’) 5. default: has credit in default? (categorical: ‘no’,‘yes’,‘unknown’) 6. housing: has housing loan? (categorical: ‘no’,‘yes’,‘unknown’) 7. loan: has personal loan? (categorical: ‘no’,‘yes’,‘unknown’)</p>
<p><strong>attributes related with the last contact of the current campaign</strong></p>
<ol start="8" type="1">
<li>contact: contact communication type (categorical: ‘cellular’,‘telephone’)</li>
<li>month: last contact month of year (categorical: ‘jan’, ‘feb’, ‘mar’, …, ‘nov’, ‘dec’)</li>
<li>day_of_week: last contact day of the week (categorical: ‘mon’,‘tue’,‘wed’,‘thu’,‘fri’)</li>
<li>duration: last contact duration, in seconds (numeric). Important note: this attribute highly affects the output target (e.g., if duration=0 then y=‘no’). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.</li>
</ol>
<p><strong>other attributes</strong> 12. campaign: number of contacts performed during this campaign and for this client (numeric, includes last contact) 13. pdays: number of days that passed by after the client was last contacted from a previous campaign (numeric; 999 means client was not previously contacted) 14. previous: number of contacts performed before this campaign and for this client (numeric) 15. poutcome: outcome of the previous marketing campaign (categorical: ‘failure’,‘nonexistent’,‘success’)</p>
<p><strong>social and economic context attributes</strong> 16. emp.var.rate: employment variation rate - quarterly indicator (numeric) 17. cons.price.idx: consumer price index - monthly indicator (numeric) 18. cons.conf.idx: consumer confidence index - monthly indicator (numeric) 19. euribor3m: euribor 3 month rate - daily indicator (numeric) 20. nr.employed: number of employees - quarterly indicator (numeric)</p>
</section>
<section id="output-variable-desired-target" class="level3">
<h3 class="anchored" data-anchor-id="output-variable-desired-target">Output variable (desired target)</h3>
<ol start="21" type="1">
<li>y: has the client subscribed a term deposit? (binary: ‘yes’,‘no’)</li>
</ol>
</section>
</section>
</section>
<section id="load-and-explore-data" class="level1">
<h1>Load and explore data</h1>
<p>Let’s define a local directory <code>local_path</code> to keep all the files and artifacts related to this post.</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">##</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># local path will be the root directory for this post</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>local_path <span class="op">=</span> <span class="st">"./datasets/2022-08-05-sagemaker-feature-store/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s make sure that the local directory folder exists.</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>Path(local_path).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now download the data file to the <code>local_path</code>.</p>
<div id="cell-11" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">!</span>wget <span class="st">'https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip'</span> <span class="op">-</span>P {local_path}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--2022-08-08 06:05:57--  https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip
Resolving archive.ics.uci.edu (archive.ics.uci.edu)... 128.195.10.252
Connecting to archive.ics.uci.edu (archive.ics.uci.edu)|128.195.10.252|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 444572 (434K) [application/x-httpd-php]
Saving to: ‘./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zip’

bank-additional.zip 100%[===================&gt;] 434.15K  1.55MB/s    in 0.3s    

2022-08-08 06:05:58 (1.55 MB/s) - ‘./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zip’ saved [444572/444572]
</code></pre>
</div>
</div>
<p>Unzip the downloaded file.</p>
<div id="cell-13" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">!</span>unzip <span class="op">-</span>o {local_path}bank<span class="op">-</span>additional.<span class="bu">zip</span> <span class="op">-</span>d {local_path}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Archive:  ./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zip
   creating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/.DS_Store  
   creating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/
   creating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/bank-additional/
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/bank-additional/._.DS_Store  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/.Rhistory  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-full.csv  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-names.txt  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional.csv  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/._bank-additional  </code></pre>
</div>
</div>
<p>Extracted files contains multiple datasets. We will use <code>bank-additional-full.csv</code> which has all the examples (41188) and 20 inputs, ordered by date.</p>
<div id="cell-15" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">##</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># define data file path</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>local_data_file <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>local_path<span class="sc">}</span><span class="ss">bank-additional/bank-additional-full.csv"</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>local_data_file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>'./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-full.csv'</code></pre>
</div>
</div>
<p>Let’s read the dataset and explore it.</p>
<div id="cell-17" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>pd.set_option(<span class="st">"display.max_columns"</span>, <span class="dv">500</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>pd.set_option(<span class="st">"display.width"</span>, <span class="dv">1000</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>df <span class="op">=</span> pd.read_csv(local_data_file, sep<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="bu">print</span>(<span class="st">"df.shape: "</span>, df.shape)</span>
<span id="cb11-9"><a href="#cb11-9"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>df.shape:  (41188, 21)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp.var.rate</th>
<th data-quarto-table-cell-role="th">cons.price.idx</th>
<th data-quarto-table-cell-role="th">cons.conf.idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr.employed</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>56</td>
<td>housemaid</td>
<td>married</td>
<td>basic.4y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>261</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>57</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>unknown</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>149</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>226</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>40</td>
<td>admin.</td>
<td>married</td>
<td>basic.6y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>151</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>56</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>no</td>
<td>yes</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>307</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creating-a-feature-group" class="level1">
<h1>Creating a feature group</h1>
<p>A feature group in the SageMaker feature store defines the metadata, feature definition, unique identifier for data entries, and other store configurations.</p>
<p>There are two ways to create a feature group in SageMaker. - Using SageMaker Studio IDE - SageMaker Python SDK</p>
<section id="considerations-for-creating-a-feature-group" class="level2">
<h2 class="anchored" data-anchor-id="considerations-for-creating-a-feature-group">Considerations for creating a feature group</h2>
<ul>
<li>Supported data types in feature group are: string, integral, and fractional</li>
<li>There should be a feature that can uniquely identify each row</li>
<li>There should be a feature that defines event time (event_time). This feature is required for versioning and time travel. Excepted data types for this feature are string or fractional.
<ul>
<li>For <code>String</code> type event time has to be ISO-8601 format in UTC time with the <code>yyyy-MM-dd'T'HH:mm:ssZ</code> or <code>yyyy-MM-dd'T'HH:mm:ss.SSSZ</code> patterns</li>
<li>For <code>Fractional</code> type, the values are expected to be in seconds from Unix epoch time with millisecond precision</li>
</ul></li>
</ul>
<p>Our dataset does not have a feature that can uniquely identify each row. So let’s create one.</p>
<div id="cell-19" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">##</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># 'FS_id' defines unique id for each row</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>df[<span class="st">'FS_id'</span>] <span class="op">=</span> df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, we also need to create an event time feature. For this, we will use string type with <code>yyyy-MM-dd'T'HH:mm:ss.SSSZ</code> pattern.</p>
<div id="cell-21" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timezone, date</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw">def</span> generate_event_timestamp():</span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="co"># naive datetime representing local time</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    naive_dt <span class="op">=</span> datetime.now()</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="co"># take timezone into account</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    aware_dt <span class="op">=</span> naive_dt.astimezone()</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="co"># time in UTC</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>    utc_dt <span class="op">=</span> aware_dt.astimezone(timezone.utc)</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="co"># transform to ISO-8601 format</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>    event_time <span class="op">=</span> utc_dt.isoformat(timespec<span class="op">=</span><span class="st">"milliseconds"</span>)</span>
<span id="cb14-12"><a href="#cb14-12"></a>    event_time <span class="op">=</span> event_time.replace(<span class="st">"+00:00"</span>, <span class="st">"Z"</span>)</span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="cf">return</span> event_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>generate_event_timestamp()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>'2022-08-08T06:06:07.059Z'</code></pre>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">##</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># `FS_event_time` contains event timestamps</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>df[<span class="st">'FS_event_time'</span>] <span class="op">=</span> [generate_event_timestamp() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check our dataset with two new features.</p>
<div id="cell-25" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp.var.rate</th>
<th data-quarto-table-cell-role="th">cons.price.idx</th>
<th data-quarto-table-cell-role="th">cons.conf.idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr.employed</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">FS_id</th>
<th data-quarto-table-cell-role="th">FS_event_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>56</td>
<td>housemaid</td>
<td>married</td>
<td>basic.4y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>261</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>0</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>57</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>unknown</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>149</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>1</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>226</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>2</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>40</td>
<td>admin.</td>
<td>married</td>
<td>basic.6y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>151</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>3</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>56</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>no</td>
<td>yes</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>307</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>4</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Initialize SageMaker session.</p>
<div id="cell-27" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">import</span> sagemaker</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>session <span class="op">=</span> sagemaker.Session()</span>
<span id="cb19-4"><a href="#cb19-4"></a>role <span class="op">=</span> sagemaker.get_execution_role()</span>
<span id="cb19-5"><a href="#cb19-5"></a>bucket <span class="op">=</span> session.default_bucket()</span>
<span id="cb19-6"><a href="#cb19-6"></a>region <span class="op">=</span> session.boto_region_name</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="bu">print</span>(<span class="st">"sagemaker.__version__: "</span>, sagemaker.__version__)</span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="bu">print</span>(<span class="st">"Session: "</span>, session)</span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="bu">print</span>(<span class="st">"Role: "</span>, role)</span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="bu">print</span>(<span class="st">"Bucket: "</span>, bucket)</span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="bu">print</span>(<span class="st">"Region: "</span>, region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sagemaker.__version__:  2.99.0
Session:  &lt;sagemaker.session.Session object at 0x7fb40934c890&gt;
Role:  arn:aws:iam::801598032724:role/service-role/AmazonSageMaker-ExecutionRole-20220804T174502
Bucket:  sagemaker-us-east-1-801598032724
Region:  us-east-1</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># You may choose any other prefix for your bucket.</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co"># All the data related to this post will be under this prefix.</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>bucket_prefix <span class="op">=</span> <span class="st">"2022-08-05-sagemaker-feature-store"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature store requires an S3 location for storing the ingested data. Let’s define it as well.</p>
<div id="cell-30" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>fs_offline_bucket_studio <span class="op">=</span> <span class="ss">f"s3://</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>bucket_prefix<span class="sc">}</span><span class="ss">/fs_offline/studio"</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>fs_offline_bucket_studio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>'s3://sagemaker-us-east-1-801598032724/2022-08-05-sagemaker-feature-store/fs_offline/studio'</code></pre>
</div>
</div>
</section>
<section id="create-feature-group-from-sagemaker-studio-ide" class="level2">
<h2 class="anchored" data-anchor-id="create-feature-group-from-sagemaker-studio-ide">Create feature group from SageMaker studio IDE</h2>
<p>Let’s see how we can create a feature group using SageMaker Studio IDE. You don’t need to write any code while creating a feature group using Studio IDE. From the left sidebar, use the <code>SageMaker Resources</code> menu to open the <code>Feature Group</code> pane, and click the <code>create feature group</code> option. This will open a new tab in IDE to create a feature group.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-08-05-sagemaker-feature-store/create-feature-group.PNG" class="img-fluid figure-img"></p>
<figcaption>create-feature-group.PNG</figcaption>
</figure>
</div>
<p>On the <code>create feature group</code> tab, define the following settings: - Feature group name : “bank-marketing-studio” - Description (optional) : “The data is related to direct marketing campaigns (phone calls) of a Portuguese banking institution.” - Feature group storage configurations - Enable online store : Check this box. Note that for the online store there is no S3 bucket requirement. - Enable offline store : Check this box too. - Enter S3 location from <code>fs_offline_bucket_studio</code> - IAM Role ARN : Default SageMaker role. - Enable Data Catalog for offline store - Select <code>continue</code></p>
<p>On the next page, you will be asked to specify feature definitions. There are two ways to define them. - Using Table, and manually fill each feature and its type - Using JSON. We will use this option to define the features and their types.</p>
<p>Remember that the feature group only supports three data types: string, integral, and fractional. So we need to create a mapping between Pandas Dataframe data types and that of a feature store. - “object” -&gt; “String” - “int64” -&gt; “Integral” - “float64” -&gt; “Fractional”</p>
<div id="cell-32" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">##</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># map DataFrame types to feature group.</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw">def</span> get_mapping(dt):</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a>    feature_store_dtype_mapping <span class="op">=</span> {</span>
<span id="cb24-6"><a href="#cb24-6"></a>        <span class="st">"object"</span>: <span class="st">"String"</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>        <span class="st">"int64"</span>: <span class="st">"Integral"</span>,</span>
<span id="cb24-8"><a href="#cb24-8"></a>        <span class="st">"float64"</span>: <span class="st">"Fractional"</span>,</span>
<span id="cb24-9"><a href="#cb24-9"></a>    }</span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a>    <span class="cf">return</span> feature_store_dtype_mapping[<span class="bu">str</span>(dt)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-33" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">##</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="co"># DataFrame feature data types</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>age                 int64
job                object
marital            object
education          object
default            object
housing            object
loan               object
contact            object
month              object
day_of_week        object
duration            int64
campaign            int64
pdays               int64
previous            int64
poutcome           object
emp.var.rate      float64
cons.price.idx    float64
cons.conf.idx     float64
euribor3m         float64
nr.employed       float64
y                  object
FS_id               int64
FS_event_time      object
dtype: object</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">##</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co"># prepare list of feature names and correct data types</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>feature_names <span class="op">=</span> df.columns.tolist()</span>
<span id="cb27-4"><a href="#cb27-4"></a>feature_types <span class="op">=</span> [get_mapping(dt) <span class="cf">for</span> dt <span class="kw">in</span> df.dtypes]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Feature names allow alphanumeric characters including dashes and underscores. So let’s remove the “.” character from the feature names.</p>
<div id="cell-36" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">##</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co"># fix feature names</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="cf">for</span> indx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_names)):</span>
<span id="cb28-4"><a href="#cb28-4"></a>    feature_names[indx] <span class="op">=</span> feature_names[indx].replace(<span class="st">"."</span>, <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">##</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># corrected feature names</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>feature_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>['age',
 'job',
 'marital',
 'education',
 'default',
 'housing',
 'loan',
 'contact',
 'month',
 'day_of_week',
 'duration',
 'campaign',
 'pdays',
 'previous',
 'poutcome',
 'emp_var_rate',
 'cons_price_idx',
 'cons_conf_idx',
 'euribor3m',
 'nr_employed',
 'y',
 'FS_id',
 'FS_event_time']</code></pre>
</div>
</div>
<p>Now we are ready to prepare JSON for feature definitions. JSON created should be of the following format.</p>
<pre><code>[
    {
        "FeatureName": "age",
        "FeatureType": "Integral"
    }
]</code></pre>
<p>Let’s prepare it.</p>
<div id="cell-39" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>df_features <span class="op">=</span> pd.DataFrame({<span class="st">"FeatureName"</span>: feature_names, <span class="st">"FeatureType"</span>: feature_types})</span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="bu">print</span>(df_features.to_json(orient<span class="op">=</span><span class="st">"records"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{"FeatureName":"age","FeatureType":"Integral"},{"FeatureName":"job","FeatureType":"String"},{"FeatureName":"marital","FeatureType":"String"},{"FeatureName":"education","FeatureType":"String"},{"FeatureName":"default","FeatureType":"String"},{"FeatureName":"housing","FeatureType":"String"},{"FeatureName":"loan","FeatureType":"String"},{"FeatureName":"contact","FeatureType":"String"},{"FeatureName":"month","FeatureType":"String"},{"FeatureName":"day_of_week","FeatureType":"String"},{"FeatureName":"duration","FeatureType":"Integral"},{"FeatureName":"campaign","FeatureType":"Integral"},{"FeatureName":"pdays","FeatureType":"Integral"},{"FeatureName":"previous","FeatureType":"Integral"},{"FeatureName":"poutcome","FeatureType":"String"},{"FeatureName":"emp_var_rate","FeatureType":"Fractional"},{"FeatureName":"cons_price_idx","FeatureType":"Fractional"},{"FeatureName":"cons_conf_idx","FeatureType":"Fractional"},{"FeatureName":"euribor3m","FeatureType":"Fractional"},{"FeatureName":"nr_employed","FeatureType":"Fractional"},{"FeatureName":"y","FeatureType":"String"},{"FeatureName":"FS_id","FeatureType":"Integral"},{"FeatureName":"FS_event_time","FeatureType":"String"}]</code></pre>
</div>
</div>
<p>Copy the JSON from the last cell output and past it in feature definition JSON input. Click <code>continue</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-08-05-sagemaker-feature-store/feature-definition.PNG" class="img-fluid figure-img"></p>
<figcaption>feature-definition.PNG</figcaption>
</figure>
</div>
<p>On the next page, it will ask for the required features. - record identifier feature name : select <code>FS_ID</code> - event type feature name : select <code>FS_event_time</code></p>
<p>Click <code>continue</code> and create the feature group.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-08-05-sagemaker-feature-store/feature-group-created.PNG" class="img-fluid figure-img"></p>
<figcaption>feature-group-created.PNG</figcaption>
</figure>
</div>
</section>
<section id="create-feature-group-from-sagemaker-sdk" class="level2">
<h2 class="anchored" data-anchor-id="create-feature-group-from-sagemaker-sdk">Create feature group from SageMaker SDK</h2>
<p>We have seen how we can create a feature group from SageMaker studio IDE. Let’s also see how to create it using SageMaker SDK.</p>
<div id="cell-42" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">##</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co"># define a feature group</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="im">from</span> sagemaker.feature_store.feature_group <span class="im">import</span> FeatureGroup</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a>feature_group_name <span class="op">=</span> <span class="st">"bank-marketing-sdk"</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>feature_group <span class="op">=</span> FeatureGroup(name<span class="op">=</span>feature_group_name, sagemaker_session<span class="op">=</span>session)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I have created a FeatureGroup, now we need to define its schema (FeatureDefinitions). When I check the <a href="https://sagemaker.readthedocs.io/en/stable/api/prep_data/feature_store.html">SageMaker Python SDK Feature Store APIs reference</a>, I could not find any method to provide <code>FeatureDefinitions</code> to a feature group. But feature store documentation examples <a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_featurestore.html">amazon_sagemaker_featurestore</a> mention that we can use <code>feature_group.load_feature_definitions()</code> method to load the feature definitions from Pandas dataframe. When I checked the <code>sagemaker-python-sdk</code> GitHub page there is an <a href="https://github.com/aws/sagemaker-python-sdk/issues/2677">open issue</a> that says “The documentation does not include the load_feature_definitions() method for the FeatureGroup class”, and is still open.</p>
<p>To get more understanding of this method we can check the source code for sagemaker feature group class <a href="https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/feature_store/feature_group.py">github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/feature_store/feature_group.py</a>. If we check the signature and documentation for this method it says:</p>
<pre><code>def load_feature_definitions(
        self,
        data_frame: DataFrame,
    ) -&gt; Sequence[FeatureDefinition]:
    
        """Load feature definitions from a Pandas DataFrame.
        Column name is used as feature name. Feature type is inferred from the dtype
        of the column. Dtype int_, int8, int16, int32, int64, uint8, uint16, uint32
        and uint64 are mapped to Integral feature type. Dtype float_, float16, float32
        and float64 are mapped to Fractional feature type. string dtype is mapped to
        String feature type.
        No feature definitions will be loaded if the given data_frame contains
        unsupported dtypes.
        Args:
            data_frame (DataFrame):
        Returns:
            list of FeatureDefinition
        """</code></pre>
<p>That is * It loads feature definitions from a Pandas DataFrame * DataFrame column names are used as feature names * Feature types are inferred from the dtype of columns * Dtype int_, int8, int16, int32, int64, uint8, uint16, uint32 and uint64 are mapped to <code>Integral</code> feature type * Dtype float_, float16, float32 and float64 are mapped to <code>Fractional</code> feature type * Dtype string is mapped to <code>String</code> feature type * No feature definitions will be loaded if the given data_frame contains unsupported dtypes</p>
<p>In the last section, we have seen that our dataframe has <code>object</code> data types that are not supported. For backward compatibility reasons, Pandas DataFrame infers columns with strings as <code>object</code> data type. With Pandas 1.0 onwards we can explicitly use <code>string</code> type for such columns.</p>
<p>Let’s see what happens when we use unsupported data types for feature definition.</p>
<div id="cell-44" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">##</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co"># load unsupported feature definitions. This will generate an error.</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>feature_group.load_feature_definitions(data_frame<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-24-f77a8abe3ce7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span class="ansi-red-fg">##</span>
<span class="ansi-green-fg ansi-bold">      2</span> <span class="ansi-red-fg"># load unsupported feature definitions. This will generate an error.</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>feature_group<span class="ansi-blue-fg">.</span>load_feature_definitions<span class="ansi-blue-fg">(</span>data_frame<span class="ansi-blue-fg">=</span>df<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/feature_store/feature_group.py</span> in <span class="ansi-cyan-fg">load_feature_definitions</span><span class="ansi-blue-fg">(self, data_frame)</span>
<span class="ansi-green-fg ansi-bold">    570</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    571</span>                 raise ValueError(
<span class="ansi-green-fg">--&gt; 572</span><span class="ansi-red-fg">                     </span><span class="ansi-blue-fg">f"Failed to infer Feature type based on dtype {data_frame[column].dtype} "</span>
<span class="ansi-green-fg ansi-bold">    573</span>                     <span class="ansi-blue-fg">f"for column {column}."</span>
<span class="ansi-green-fg ansi-bold">    574</span>                 )

<span class="ansi-red-fg">ValueError</span>: Failed to infer Feature type based on dtype object for column job.</pre>
</div>
</div>
</div>
<p>It throws an error, “ValueError: Failed to infer Feature type based on dtype object for column job.”</p>
<p>Okay, let’s convet columns to proper data types.</p>
<div id="cell-46" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">##</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co"># list of columns with `object` data type</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>df.select_dtypes(<span class="st">"object"</span>).columns.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>['job',
 'marital',
 'education',
 'default',
 'housing',
 'loan',
 'contact',
 'month',
 'day_of_week',
 'poutcome',
 'y',
 'FS_event_time']</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">##</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># covert `object` columns to `string` data type</span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(<span class="st">"object"</span>).columns.tolist():</span>
<span id="cb39-4"><a href="#cb39-4"></a>    df[col] <span class="op">=</span> df[col].astype(<span class="st">"string"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s verify the data types of all columns.</p>
<div id="cell-49" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>age                 int64
job                string
marital            string
education          string
default            string
housing            string
loan               string
contact            string
month              string
day_of_week        string
duration            int64
campaign            int64
pdays               int64
previous            int64
poutcome           string
emp.var.rate      float64
cons.price.idx    float64
cons.conf.idx     float64
euribor3m         float64
nr.employed       float64
y                  string
FS_id               int64
FS_event_time      string
dtype: object</code></pre>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp.var.rate</th>
<th data-quarto-table-cell-role="th">cons.price.idx</th>
<th data-quarto-table-cell-role="th">cons.conf.idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr.employed</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">FS_id</th>
<th data-quarto-table-cell-role="th">FS_event_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>56</td>
<td>housemaid</td>
<td>married</td>
<td>basic.4y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>261</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>0</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>57</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>unknown</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>149</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>1</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>226</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>2</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>40</td>
<td>admin.</td>
<td>married</td>
<td>basic.6y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>151</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>3</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>56</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>no</td>
<td>yes</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>307</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>4</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s load the feature definitions again.</p>
<div id="cell-52" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>feature_group.load_feature_definitions(data_frame<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>[FeatureDefinition(feature_name='age', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='job', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='marital', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='education', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='default', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='housing', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='loan', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='contact', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='month', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='day_of_week', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='duration', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='campaign', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='pdays', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='previous', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='poutcome', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='emp.var.rate', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons.price.idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons.conf.idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='euribor3m', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='nr.employed', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='y', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='FS_id', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='FS_event_time', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;)]</code></pre>
</div>
</div>
<p>We have defined our feature group and its feature definitions, but it has not been created. To create it we need to call <code>create</code> method on the feature group. For this let’s define s3 URI for our feature store offline data storage.</p>
<div id="cell-54" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>fs_offline_bucket_sdk <span class="op">=</span> <span class="ss">f"s3://</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>bucket_prefix<span class="sc">}</span><span class="ss">/fs_offline/sdk"</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>fs_offline_bucket_sdk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>'s3://sagemaker-us-east-1-801598032724/2022-08-05-sagemaker-feature-store/fs_offline/sdk'</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">##</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># Now create feature group</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>record_identifier_name <span class="op">=</span> <span class="st">"FS_id"</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>event_time_feature_name <span class="op">=</span> <span class="st">"FS_event_time"</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>description <span class="op">=</span> <span class="st">"The data is related with direct marketing campaigns (phone calls) of a Portuguese banking institution"</span></span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>feature_group.create(</span>
<span id="cb47-8"><a href="#cb47-8"></a>    record_identifier_name<span class="op">=</span>record_identifier_name,</span>
<span id="cb47-9"><a href="#cb47-9"></a>    event_time_feature_name<span class="op">=</span>event_time_feature_name,</span>
<span id="cb47-10"><a href="#cb47-10"></a>    enable_online_store<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-11"><a href="#cb47-11"></a>    s3_uri<span class="op">=</span>fs_offline_bucket_sdk,</span>
<span id="cb47-12"><a href="#cb47-12"></a>    role_arn<span class="op">=</span>role,</span>
<span id="cb47-13"><a href="#cb47-13"></a>    description<span class="op">=</span>description,</span>
<span id="cb47-14"><a href="#cb47-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ClientError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-5459ca8fa447&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg ansi-bold">     11</span>     s3_uri<span class="ansi-blue-fg">=</span>fs_offline_bucket_sdk<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg ansi-bold">     12</span>     role_arn<span class="ansi-blue-fg">=</span>role<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg">     </span>description<span class="ansi-blue-fg">=</span>description<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg ansi-bold">     14</span> )

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/feature_store/feature_group.py</span> in <span class="ansi-cyan-fg">create</span><span class="ansi-blue-fg">(self, s3_uri, record_identifier_name, event_time_feature_name, role_arn, online_store_kms_key_id, enable_online_store, offline_store_kms_key_id, disable_glue_table_creation, data_catalog_config, description, tags)</span>
<span class="ansi-green-fg ansi-bold">    519</span>             )
<span class="ansi-green-fg ansi-bold">    520</span> 
<span class="ansi-green-fg">--&gt; 521</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>sagemaker_session<span class="ansi-blue-fg">.</span>create_feature_group<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>create_feature_store_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    522</span> 
<span class="ansi-green-fg ansi-bold">    523</span>     <span class="ansi-green-fg">def</span> delete<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/session.py</span> in <span class="ansi-cyan-fg">create_feature_group</span><span class="ansi-blue-fg">(self, feature_group_name, record_identifier_name, event_time_feature_name, feature_definitions, role_arn, online_store_config, offline_store_config, description, tags)</span>
<span class="ansi-green-fg ansi-bold">   4076</span>             Tags<span class="ansi-blue-fg">=</span>tags<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg ansi-bold">   4077</span>         )
<span class="ansi-green-fg">-&gt; 4078</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>sagemaker_client<span class="ansi-blue-fg">.</span>create_feature_group<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">   4079</span> 
<span class="ansi-green-fg ansi-bold">   4080</span>     def describe_feature_group(

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/botocore/client.py</span> in <span class="ansi-cyan-fg">_api_call</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    506</span>                 )
<span class="ansi-green-fg ansi-bold">    507</span>             <span class="ansi-red-fg"># The "self" in this scope is referring to the BaseClient.</span>
<span class="ansi-green-fg">--&gt; 508</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_make_api_call<span class="ansi-blue-fg">(</span>operation_name<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    509</span> 
<span class="ansi-green-fg ansi-bold">    510</span>         _api_call<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>py_operation_name<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/botocore/client.py</span> in <span class="ansi-cyan-fg">_make_api_call</span><span class="ansi-blue-fg">(self, operation_name, api_params)</span>
<span class="ansi-green-fg ansi-bold">    913</span>             error_code <span class="ansi-blue-fg">=</span> parsed_response<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Error"</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Code"</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    914</span>             error_class <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>exceptions<span class="ansi-blue-fg">.</span>from_code<span class="ansi-blue-fg">(</span>error_code<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 915</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> error_class<span class="ansi-blue-fg">(</span>parsed_response<span class="ansi-blue-fg">,</span> operation_name<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg ansi-bold">    916</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg ansi-bold">    917</span>             <span class="ansi-green-fg">return</span> parsed_response

<span class="ansi-red-fg">ClientError</span>: An error occurred (ValidationException) when calling the CreateFeatureGroup operation: 4 validation errors detected: Value 'emp.var.rate' at 'featureDefinitions.16.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'cons.price.idx' at 'featureDefinitions.17.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'cons.conf.idx' at 'featureDefinitions.18.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'nr.employed' at 'featureDefinitions.20.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}</pre>
</div>
</div>
</div>
<p>We got an error as we have not fixed feature names. Error is saying that the feature name should satisfy the regular expression pattern: <code>^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}</code>. Let’s fix our column names.</p>
<div id="cell-57" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>col_names <span class="op">=</span> df.columns.tolist()</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(col_names)):</span>
<span id="cb48-3"><a href="#cb48-3"></a>    col_names[idx] <span class="op">=</span> col_names[idx].replace(<span class="st">"."</span>, <span class="st">"_"</span>)</span>
<span id="cb48-4"><a href="#cb48-4"></a></span>
<span id="cb48-5"><a href="#cb48-5"></a>df.columns <span class="op">=</span> col_names</span>
<span id="cb48-6"><a href="#cb48-6"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp_var_rate</th>
<th data-quarto-table-cell-role="th">cons_price_idx</th>
<th data-quarto-table-cell-role="th">cons_conf_idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr_employed</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">FS_id</th>
<th data-quarto-table-cell-role="th">FS_event_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>56</td>
<td>housemaid</td>
<td>married</td>
<td>basic.4y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>261</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>0</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>57</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>unknown</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>149</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>1</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>226</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>2</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>40</td>
<td>admin.</td>
<td>married</td>
<td>basic.6y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>151</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>3</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>56</td>
<td>services</td>
<td>married</td>
<td>high.school</td>
<td>no</td>
<td>no</td>
<td>yes</td>
<td>telephone</td>
<td>may</td>
<td>mon</td>
<td>307</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>1.1</td>
<td>93.994</td>
<td>-36.4</td>
<td>4.857</td>
<td>5191.0</td>
<td>no</td>
<td>4</td>
<td>2022-08-08T06:06:07.524Z</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>After updating feature names, load the feature group definitions again.</p>
<div id="cell-59" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>feature_group.load_feature_definitions(data_frame<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>[FeatureDefinition(feature_name='age', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='job', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='marital', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='education', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='default', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='housing', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='loan', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='contact', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='month', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='day_of_week', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='duration', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='campaign', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='pdays', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='previous', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='poutcome', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='emp_var_rate', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons_price_idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons_conf_idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='euribor3m', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='nr_employed', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='y', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='FS_id', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='FS_event_time', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;)]</code></pre>
</div>
</div>
<p>Now create the feature group.</p>
<div id="cell-61" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="co">##</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co"># create feature group</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>feature_group.create(</span>
<span id="cb51-4"><a href="#cb51-4"></a>    record_identifier_name<span class="op">=</span>record_identifier_name,</span>
<span id="cb51-5"><a href="#cb51-5"></a>    event_time_feature_name<span class="op">=</span>event_time_feature_name,</span>
<span id="cb51-6"><a href="#cb51-6"></a>    enable_online_store<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb51-7"><a href="#cb51-7"></a>    s3_uri<span class="op">=</span>fs_offline_bucket_sdk,</span>
<span id="cb51-8"><a href="#cb51-8"></a>    role_arn<span class="op">=</span>role,</span>
<span id="cb51-9"><a href="#cb51-9"></a>    description<span class="op">=</span>description,</span>
<span id="cb51-10"><a href="#cb51-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>{'FeatureGroupArn': 'arn:aws:sagemaker:us-east-1:801598032724:feature-group/bank-marketing-sdk',
 'ResponseMetadata': {'RequestId': '5c2afeb1-fa03-442b-a3ee-80b1b0ae1069',
  'HTTPStatusCode': 200,
  'HTTPHeaders': {'x-amzn-requestid': '5c2afeb1-fa03-442b-a3ee-80b1b0ae1069',
   'content-type': 'application/x-amz-json-1.1',
   'content-length': '95',
   'date': 'Mon, 08 Aug 2022 06:06:32 GMT'},
  'RetryAttempts': 0}}</code></pre>
</div>
</div>
<p>Feature group creation is an async method, and you need to wait for its creation before ingesting any data into it. For this you can use <code>feature_group.describe</code> method to get feature store creation status.</p>
<div id="cell-63" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a>feature_group.describe().get(<span class="st">'FeatureGroupStatus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>'Creating'</code></pre>
</div>
</div>
<p>We can create a wrapper function around this method to wait till the feature group is ready.</p>
<div id="cell-65" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="im">import</span> time</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="kw">def</span> wait_for_feature_group_creation_complete(feature_group):</span>
<span id="cb55-4"><a href="#cb55-4"></a>    status <span class="op">=</span> feature_group.describe().get(<span class="st">"FeatureGroupStatus"</span>)</span>
<span id="cb55-5"><a href="#cb55-5"></a>    <span class="bu">print</span>(<span class="ss">f"Initial status: </span><span class="sc">{</span>status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-6"><a href="#cb55-6"></a>    <span class="cf">while</span> status <span class="op">==</span> <span class="st">"Creating"</span>:</span>
<span id="cb55-7"><a href="#cb55-7"></a>        <span class="bu">print</span>(<span class="ss">f"Waiting for feature group: </span><span class="sc">{</span>feature_group<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> to be created ..."</span>)</span>
<span id="cb55-8"><a href="#cb55-8"></a>        time.sleep(<span class="dv">5</span>)</span>
<span id="cb55-9"><a href="#cb55-9"></a>        status <span class="op">=</span> feature_group.describe().get(<span class="st">"FeatureGroupStatus"</span>)</span>
<span id="cb55-10"><a href="#cb55-10"></a></span>
<span id="cb55-11"><a href="#cb55-11"></a>    <span class="bu">print</span>(<span class="ss">f"FeatureGroup </span><span class="sc">{</span>feature_group<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> was successfully created."</span>)</span>
<span id="cb55-12"><a href="#cb55-12"></a></span>
<span id="cb55-13"><a href="#cb55-13"></a></span>
<span id="cb55-14"><a href="#cb55-14"></a>wait_for_feature_group_creation_complete(feature_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initial status: Creating
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
FeatureGroup bank-marketing-sdk was successfully created.</code></pre>
</div>
</div>
</section>
</section>
<section id="ingest-data-to-feature-group" class="level1">
<h1>Ingest data to feature group</h1>
<p>Let’s ingest our data frame into this feature group.</p>
<div id="cell-67" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>feature_group.ingest(data_frame<span class="op">=</span>df, max_workers<span class="op">=</span><span class="dv">5</span>, max_processes <span class="op">=</span> <span class="dv">1</span>, wait<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>IngestionManagerPandas(feature_group_name='bank-marketing-sdk', sagemaker_fs_runtime_client_config=&lt;botocore.config.Config object at 0x7fb406ab9450&gt;, max_workers=5, max_processes=1, profile_name=None, _async_result=&lt;multiprocess.pool.MapResult object at 0x7fb405669810&gt;, _processing_pool=&lt;pool ProcessPool(ncpus=1)&gt;, _failed_indices=[])</code></pre>
</div>
</div>
<p>We can control the ingestion run time with <code>max_processes</code> and <code>max_workers</code> arguments. * <code>max_processes</code> defines the number of processes that will be created to ingest different partitions of the DataFrame in parallel * <code>max_workers</code> defines the number threads for each processor</p>
<p>For large datasets, instead of using ingestion API we can place the data directly on feature group S3 bucket offline storage location. For a detailed discussion on this topic follow the post from <a href="https://www.linkedin.com/in/heikohotz/">Heiko Hotz</a>: <a href="https://towardsdatascience.com/ingesting-historical-feature-data-into-sagemaker-feature-store-5618e41a11e6">ingesting-historical-feature-data-into-sagemaker-feature-store</a></p>
</section>
<section id="accessing-features-from-feature-store" class="level1">
<h1>Accessing features from feature store</h1>
<p>Now that we have our data available in the feature repository, we can access it from online and offline feature stores.</p>
<section id="accessing-online-feature-store-from-sdk" class="level2">
<h2 class="anchored" data-anchor-id="accessing-online-feature-store-from-sdk">Accessing online feature store from SDK</h2>
<p>Boto3 SDK <code>sagemaker-featurestore-runtime</code> allows us to interact with the online feature store. These are the available methods:</p>
<ul>
<li>batch_get_record()</li>
<li>can_paginate()</li>
<li>close()</li>
<li>delete_record()</li>
<li>get_paginator()</li>
<li>get_record()</li>
<li>get_waiter()</li>
<li>put_record()</li>
</ul>
<p>To read more about them use <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-featurestore-runtime.html">Boto3 SageMakerFeatureStoreRuntime</a> documentation.</p>
<div id="cell-69" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a>featurestore_runtime_client <span class="op">=</span> session.boto_session.client(</span>
<span id="cb59-2"><a href="#cb59-2"></a>    <span class="st">"sagemaker-featurestore-runtime"</span>, region_name<span class="op">=</span>region</span>
<span id="cb59-3"><a href="#cb59-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-70" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a><span class="co">##</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co"># select any random id to query online store</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>sample_feature_id <span class="op">=</span> <span class="bu">str</span>(df.sample().index.values[<span class="dv">0</span>])</span>
<span id="cb60-4"><a href="#cb60-4"></a>sample_feature_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'37156'</code></pre>
</div>
</div>
<p>Now query the online store.</p>
<div id="cell-72" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a><span class="op">%%</span>timeit</span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a>featurestore_runtime_client.get_record(FeatureGroupName<span class="op">=</span>feature_group_name, </span>
<span id="cb62-4"><a href="#cb62-4"></a>                                                        RecordIdentifierValueAsString<span class="op">=</span>sample_feature_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.37 ms ± 238 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>feature_record <span class="op">=</span> featurestore_runtime_client.get_record(</span>
<span id="cb64-2"><a href="#cb64-2"></a>    FeatureGroupName<span class="op">=</span>feature_group_name, RecordIdentifierValueAsString<span class="op">=</span>sample_feature_id</span>
<span id="cb64-3"><a href="#cb64-3"></a>)</span>
<span id="cb64-4"><a href="#cb64-4"></a></span>
<span id="cb64-5"><a href="#cb64-5"></a>feature_record</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>{'ResponseMetadata': {'RequestId': '946376b7-7745-4b25-9885-e93ba7a284a5',
  'HTTPStatusCode': 200,
  'HTTPHeaders': {'x-amzn-requestid': '946376b7-7745-4b25-9885-e93ba7a284a5',
   'content-type': 'application/json',
   'content-length': '1189',
   'date': 'Mon, 08 Aug 2022 06:08:49 GMT'},
  'RetryAttempts': 0},
 'Record': [{'FeatureName': 'age', 'ValueAsString': '39'},
  {'FeatureName': 'job', 'ValueAsString': 'blue-collar'},
  {'FeatureName': 'marital', 'ValueAsString': 'married'},
  {'FeatureName': 'education', 'ValueAsString': 'basic.9y'},
  {'FeatureName': 'default', 'ValueAsString': 'no'},
  {'FeatureName': 'housing', 'ValueAsString': 'no'},
  {'FeatureName': 'loan', 'ValueAsString': 'no'},
  {'FeatureName': 'contact', 'ValueAsString': 'cellular'},
  {'FeatureName': 'month', 'ValueAsString': 'aug'},
  {'FeatureName': 'day_of_week', 'ValueAsString': 'wed'},
  {'FeatureName': 'duration', 'ValueAsString': '394'},
  {'FeatureName': 'campaign', 'ValueAsString': '1'},
  {'FeatureName': 'pdays', 'ValueAsString': '999'},
  {'FeatureName': 'previous', 'ValueAsString': '0'},
  {'FeatureName': 'poutcome', 'ValueAsString': 'nonexistent'},
  {'FeatureName': 'emp_var_rate', 'ValueAsString': '-2.9'},
  {'FeatureName': 'cons_price_idx', 'ValueAsString': '92.201'},
  {'FeatureName': 'cons_conf_idx', 'ValueAsString': '-31.4'},
  {'FeatureName': 'euribor3m', 'ValueAsString': '0.884'},
  {'FeatureName': 'nr_employed', 'ValueAsString': '5076.2'},
  {'FeatureName': 'y', 'ValueAsString': 'yes'},
  {'FeatureName': 'FS_id', 'ValueAsString': '37156'},
  {'FeatureName': 'FS_event_time',
   'ValueAsString': '2022-08-08T06:06:07.834Z'}]}</code></pre>
</div>
</div>
</section>
<section id="accessing-offline-feature-store-from-sdk" class="level2">
<h2 class="anchored" data-anchor-id="accessing-offline-feature-store-from-sdk">Accessing offline feature store from SDK</h2>
<p>Let’s query the offline store to get the same data. For offline feature storage, SageMaker stages the data in S3 bucket and creates AWS Data Catalog on it. This catalog is registered in AWS Athena and we can use Athena APIs to query offline store.</p>
<div id="cell-75" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>query <span class="op">=</span> feature_group.athena_query()</span>
<span id="cb66-2"><a href="#cb66-2"></a>query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>AthenaQuery(catalog='AwsDataCatalog', database='sagemaker_featurestore', table_name='bank-marketing-sdk-1659938792', sagemaker_session=&lt;sagemaker.session.Session object at 0x7fb40934c890&gt;, _current_query_execution_id=None, _result_bucket=None, _result_file_prefix=None)</code></pre>
</div>
</div>
<div id="cell-76" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>table_name <span class="op">=</span> query.table_name</span>
<span id="cb68-2"><a href="#cb68-2"></a>table_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>'bank-marketing-sdk-1659938792'</code></pre>
</div>
</div>
<div id="cell-77" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>query_string <span class="op">=</span> <span class="ss">f'SELECT * FROM "</span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">" WHERE FS_id = </span><span class="sc">{</span>sample_feature_id<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>query_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'SELECT * FROM "bank-marketing-sdk-1659938792" WHERE FS_id = 37156'</code></pre>
</div>
</div>
<div id="cell-78" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="op">%%</span>timeit</span>
<span id="cb72-2"><a href="#cb72-2"></a>query.run(query_string<span class="op">=</span>query_string,output_location<span class="op">=</span><span class="ss">f's3://</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>bucket_prefix<span class="sc">}</span><span class="ss">/query_results/'</span>)</span>
<span id="cb72-3"><a href="#cb72-3"></a>query.wait()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.21 s ± 29.4 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<p>Notice that the offline store has taken a much longer time to return the results compared to the online store.</p>
<div id="cell-80" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>dataset <span class="op">=</span> query.as_dataframe()</span>
<span id="cb74-2"><a href="#cb74-2"></a>dataset.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp_var_rate</th>
<th data-quarto-table-cell-role="th">cons_price_idx</th>
<th data-quarto-table-cell-role="th">cons_conf_idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr_employed</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">fs_id</th>
<th data-quarto-table-cell-role="th">fs_event_time</th>
<th data-quarto-table-cell-role="th">write_time</th>
<th data-quarto-table-cell-role="th">api_invocation_time</th>
<th data-quarto-table-cell-role="th">is_deleted</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Data in an online store becomes available immediately but it can take a few minutes to become available in an offline store. That is why we have not received any data in the last cell. Let’s run the same query again after a few minutes.</p>
<div id="cell-82" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">##</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co"># run query again</span></span>
<span id="cb75-3"><a href="#cb75-3"></a>query.run(query_string<span class="op">=</span>query_string,output_location<span class="op">=</span><span class="ss">f's3://</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>bucket_prefix<span class="sc">}</span><span class="ss">/query_results/'</span>)</span>
<span id="cb75-4"><a href="#cb75-4"></a>query.wait()</span>
<span id="cb75-5"><a href="#cb75-5"></a></span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="co"># get query response</span></span>
<span id="cb75-7"><a href="#cb75-7"></a>dataset <span class="op">=</span> query.as_dataframe()</span>
<span id="cb75-8"><a href="#cb75-8"></a>dataset.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">job</th>
<th data-quarto-table-cell-role="th">marital</th>
<th data-quarto-table-cell-role="th">education</th>
<th data-quarto-table-cell-role="th">default</th>
<th data-quarto-table-cell-role="th">housing</th>
<th data-quarto-table-cell-role="th">loan</th>
<th data-quarto-table-cell-role="th">contact</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">campaign</th>
<th data-quarto-table-cell-role="th">pdays</th>
<th data-quarto-table-cell-role="th">previous</th>
<th data-quarto-table-cell-role="th">poutcome</th>
<th data-quarto-table-cell-role="th">emp_var_rate</th>
<th data-quarto-table-cell-role="th">cons_price_idx</th>
<th data-quarto-table-cell-role="th">cons_conf_idx</th>
<th data-quarto-table-cell-role="th">euribor3m</th>
<th data-quarto-table-cell-role="th">nr_employed</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">fs_id</th>
<th data-quarto-table-cell-role="th">fs_event_time</th>
<th data-quarto-table-cell-role="th">write_time</th>
<th data-quarto-table-cell-role="th">api_invocation_time</th>
<th data-quarto-table-cell-role="th">is_deleted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>39</td>
<td>blue-collar</td>
<td>married</td>
<td>basic.9y</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>cellular</td>
<td>aug</td>
<td>wed</td>
<td>394</td>
<td>1</td>
<td>999</td>
<td>0</td>
<td>nonexistent</td>
<td>-2.9</td>
<td>92.201</td>
<td>-31.4</td>
<td>0.884</td>
<td>5076.2</td>
<td>yes</td>
<td>37156</td>
<td>2022-08-08T06:06:07.834Z</td>
<td>2022-08-08 06:13:03.665</td>
<td>2022-08-08 06:07:43.000</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="accessing-offline-store-from-athena" class="level2">
<h2 class="anchored" data-anchor-id="accessing-offline-store-from-athena">Accessing offline store from Athena</h2>
<p>This time lets query the offline feature store directly from AWS Athena service.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-08-05-sagemaker-feature-store/feature_store_athena.PNG" class="img-fluid figure-img"></p>
<figcaption>feature_store_athena.PNG</figcaption>
</figure>
</div>
</section>
</section>
<section id="clean-up" class="level1">
<h1>Clean up</h1>
<p>Run the last cell to delete the feature store if no longer needed.</p>
<div id="cell-87" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>feature_group.delete()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/hassaanbinaslam\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="hassaanbinaslam/myblog_utterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>