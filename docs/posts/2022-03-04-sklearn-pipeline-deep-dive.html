<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-03-04">
<meta name="keywords" content="sklearn, transformer, pipeline, ColumnTransformer, FunctionTransformer">
<meta name="description" content="A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.">

<title>Random Thoughts - Sklearn Pipeline and Transformers Deep Dive</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1ST9BH6HX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-D1ST9BH6HX', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Random Thoughts - Sklearn Pipeline and Transformers Deep Dive">
<meta property="og:description" content="A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.">
<meta property="og:image" content="images/2022-03-04-sklearn-pipeline-deep-dive.jpeg">
<meta property="og:site-name" content="Random Thoughts">
<meta name="twitter:title" content="Random Thoughts - Sklearn Pipeline and Transformers Deep Dive">
<meta name="twitter:description" content="A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.">
<meta name="twitter:image" content="images/2022-03-04-sklearn-pipeline-deep-dive.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Random Thoughts</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hassaanbinaslam/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hassaanbinaslam/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hassaanbinaslam"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#environment-details" id="toc-environment-details" class="nav-link" data-scroll-target="#environment-details">Environment Details</a></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data">Loading Data</a></li>
  </ul></li>
  <li><a href="#some-terminology-first" id="toc-some-terminology-first" class="nav-link" data-scroll-target="#some-terminology-first">Some Terminology First</a>
  <ul class="collapse">
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">Datasets</a></li>
  <li><a href="#estimator" id="toc-estimator" class="nav-link" data-scroll-target="#estimator">Estimator</a></li>
  <li><a href="#transformer" id="toc-transformer" class="nav-link" data-scroll-target="#transformer">Transformer</a></li>
  <li><a href="#fit" id="toc-fit" class="nav-link" data-scroll-target="#fit">Fit</a></li>
  </ul></li>
  <li><a href="#sklearn-pipeline" id="toc-sklearn-pipeline" class="nav-link" data-scroll-target="#sklearn-pipeline">Sklearn Pipeline</a></li>
  <li><a href="#columntransformer" id="toc-columntransformer" class="nav-link" data-scroll-target="#columntransformer">ColumnTransformer</a></li>
  <li><a href="#functiontransformer" id="toc-functiontransformer" class="nav-link" data-scroll-target="#functiontransformer">FunctionTransformer</a>
  <ul class="collapse">
  <li><a href="#where-are-the-rest-of-the-columns" id="toc-where-are-the-rest-of-the-columns" class="nav-link" data-scroll-target="#where-are-the-rest-of-the-columns">Where are the rest of the columns?</a></li>
  <li><a href="#what-happens-if-i-change-the-sequence-in-columntranformer" id="toc-what-happens-if-i-change-the-sequence-in-columntranformer" class="nav-link" data-scroll-target="#what-happens-if-i-change-the-sequence-in-columntranformer">What happens if I change the sequence in ColumnTranformer?</a></li>
  </ul></li>
  <li><a href="#pipeline-inside-columntransformer" id="toc-pipeline-inside-columntransformer" class="nav-link" data-scroll-target="#pipeline-inside-columntransformer">Pipeline inside ColumnTransformer</a></li>
  <li><a href="#custom-transformer" id="toc-custom-transformer" class="nav-link" data-scroll-target="#custom-transformer">Custom Transformer</a></li>
  <li><a href="#feature-engineering-with-custom-transformer" id="toc-feature-engineering-with-custom-transformer" class="nav-link" data-scroll-target="#feature-engineering-with-custom-transformer">Feature Engineering with Custom Transformer</a></li>
  <li><a href="#sklean-pipeline-with-feature-importance" id="toc-sklean-pipeline-with-feature-importance" class="nav-link" data-scroll-target="#sklean-pipeline-with-feature-importance">Sklean Pipeline with Feature Importance</a></li>
  <li><a href="#the-complete-pipeline" id="toc-the-complete-pipeline" class="nav-link" data-scroll-target="#the-complete-pipeline">The complete Pipeline</a>
  <ul class="collapse">
  <li><a href="#train-model" id="toc-train-model" class="nav-link" data-scroll-target="#train-model">Train Model</a></li>
  <li><a href="#plot-feature-importance" id="toc-plot-feature-importance" class="nav-link" data-scroll-target="#plot-feature-importance">Plot Feature Importance</a></li>
  <li><a href="#pickle-test" id="toc-pickle-test" class="nav-link" data-scroll-target="#pickle-test">Pickle Test</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sklearn Pipeline and Transformers Deep Dive</h1>
  <div class="quarto-categories">
    <div class="quarto-category">ml</div>
    <div class="quarto-category">sklearn</div>
  </div>
  </div>

<div>
  <div class="description">
    A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 4, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><img src="images/2022-03-04-sklearn-pipeline-deep-dive.jpeg" class="img-fluid"></p>
<section id="about" class="level2">
<h2 class="anchored" data-anchor-id="about">About</h2>
<p>This notebook shows various ways to work with Skearn Pipelines. * We will start with some of the limitations of pipelines and how to overcome them * We will discuss getting a dataframe from a pipeline instead of a NumPy array, and the benefits of this approach * We will learn how to use CustomTransformer and a FunctionTransformer * We will also build a custom transformer to do some feature engineering * Along the way, we will also see how to avoid common mistakes while creating pipelines</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<section id="environment-details" class="level3">
<h3 class="anchored" data-anchor-id="environment-details">Environment Details</h3>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> platform <span class="im">import</span> python_version</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> sklearn, numpy, matplotlib, pandas</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="bu">print</span>(<span class="st">"python=="</span> <span class="op">+</span> python_version())</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="bu">print</span>(<span class="st">"sklearn=="</span> <span class="op">+</span> sklearn.__version__)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="bu">print</span>(<span class="st">"numpy=="</span> <span class="op">+</span> numpy.__version__)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="bu">print</span>(<span class="st">"pandas=="</span> <span class="op">+</span> pandas.__version__)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="bu">print</span>(<span class="st">"matplotlib=="</span> <span class="op">+</span> matplotlib.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>python==3.8.8
sklearn==1.0.2
numpy==1.20.1
pandas==1.2.3
matplotlib==3.5.1</code></pre>
</div>
</div>
</section>
<section id="loading-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-data">Loading Data</h3>
<p>For this example we will use the original <code>Titanic</code> dataset, describing the survival status of individual passengers on the Titanic ship.</p>
<p>Some notes from original source: * The variables on our extracted dataset are ‘pclass’, ‘name’, ‘sex’, ‘age’, ‘sibsp’, ‘parch’, ‘ticket’, ‘fare’,‘cabin’, ‘embarked’, ‘boat’, ‘body’, and ‘home.dest’. * pclass refers to passenger class (1st, 2nd, 3rd), and is a proxy for socio-economic class. * Age is in years, and some infants had fractional values. * sibsp = Number of Siblings/Spouses aboard * parch = Number of Parents/Children aboard * The target is either a person survived or not (1 or 0)</p>
<p><strong>Important note</strong>: The purpose of this notebook is not to train a best model on titanic data, but to understand the working of Sklearn pipeline and transformers. So please be mindful of that.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_openml</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>np.random.seed(<span class="dv">42</span>) <span class="co"># for consistency</span></span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Load data from https://www.openml.org/d/40945</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>X, y <span class="op">=</span> fetch_openml(<span class="st">"titanic"</span>, version<span class="op">=</span><span class="dv">1</span>, as_frame<span class="op">=</span><span class="va">True</span>, return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>cabin</th>
      <th>embarked</th>
      <th>boat</th>
      <th>body</th>
      <th>home.dest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>Allen, Miss. Elisabeth Walton</td>
      <td>female</td>
      <td>29.0000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24160</td>
      <td>211.3375</td>
      <td>B5</td>
      <td>S</td>
      <td>2</td>
      <td>NaN</td>
      <td>St Louis, MO</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>Allison, Master. Hudson Trevor</td>
      <td>male</td>
      <td>0.9167</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>11</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>Allison, Miss. Helen Loraine</td>
      <td>female</td>
      <td>2.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>Allison, Mr. Hudson Joshua Creighton</td>
      <td>male</td>
      <td>30.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>135.0</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>Allison, Mrs. Hudson J C (Bessie Waldo Daniels)</td>
      <td>female</td>
      <td>25.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">##</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># let's check the frequency of missing values in each feature</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>X.isnull().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>body         1188
cabin        1014
boat          823
home.dest     564
age           263
embarked        2
fare            1
pclass          0
name            0
sex             0
sibsp           0
parch           0
ticket          0
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">##</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># let's drop top 4 features with highest percentage of missing data</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># This step is done to make our working with pipeline simpler and easier to understand</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>X.drop([<span class="st">'body'</span>, <span class="st">'cabin'</span>, <span class="st">'boat'</span>, <span class="st">'home.dest'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, stratify<span class="op">=</span>y, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>X_train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>999</th>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>female</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>7.7500</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>392</th>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>female</td>
      <td>24.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>27.7208</td>
      <td>C</td>
    </tr>
    <tr>
      <th>628</th>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>female</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>31.2750</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1165</th>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>male</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>7.2250</td>
      <td>C</td>
    </tr>
    <tr>
      <th>604</th>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>female</td>
      <td>16.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>7.6500</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="some-terminology-first" class="level2">
<h2 class="anchored" data-anchor-id="some-terminology-first">Some Terminology First</h2>
<section id="datasets" class="level3">
<h3 class="anchored" data-anchor-id="datasets"><a href="https://scikit-learn.org/stable/tutorial/statistical_inference/settings.html#datasets">Datasets</a></h3>
<p>Scikit-learn deals with learning information from one or more datasets that are represented as 2D arrays. They can be understood as a list of multi-dimensional observations. We say that the first axis of these arrays is the <strong>samples axis</strong>, while the second is the <strong>features axis</strong>. &gt; (n_samples, n_features)</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">##</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># for our titanic dataset:</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># n_samples = 1309</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># n_features = 9</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>(1309, 9)</code></pre>
</div>
</div>
</section>
<section id="estimator" class="level3">
<h3 class="anchored" data-anchor-id="estimator"><a href="https://scikit-learn.org/stable/tutorial/statistical_inference/settings.html#estimators-objects">Estimator</a></h3>
<p>An estimator is any object that learns from data; it may be a classification, regression or clustering algorithm or a transformer that extracts/filters useful features from raw data.</p>
<p>All estimator objects expose a fit method that takes a dataset (usually a 2-d array) &gt; estimator.fit(data)</p>
</section>
<section id="transformer" class="level3">
<h3 class="anchored" data-anchor-id="transformer"><a href="https://scikit-learn.org/stable/glossary.html#term-transformer">Transformer</a></h3>
<p>An estimator supporting <code>transform</code> and/or <code>fit_transform</code> methods.</p>
<p>A transformer, transforms the input, usually only X, into some transformed space. Output is an array or sparse matrix of length n_samples and with the number of columns fixed after <strong>fitting</strong>.</p>
</section>
<section id="fit" class="level3">
<h3 class="anchored" data-anchor-id="fit"><a href="https://scikit-learn.org/stable/glossary.html#term-fit">Fit</a></h3>
<p>The fit method is provided on every estimator. It usually takes some samples X, targets y if the model is supervised, and potentially other sample properties such as sample_weight.</p>
<p>It should: * clear any prior attributes stored on the estimator, unless warm_start is used * validate and interpret any parameters, ideally raising an error if invalid * validate the input data * estimate and store model attributes from the estimated parameters and provided data; and * return the now fitted estimator to facilitate method chaining</p>
<p>Note: * <strong>Fitting</strong> = Calling <code>fit</code> (or <code>fit_transform</code>, <code>fit_predict</code>) method on an estimator. * <strong>Fitted</strong> = The state of an estimator after fitting.</p>
</section>
</section>
<section id="sklearn-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="sklearn-pipeline"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline">Sklearn Pipeline</a></h2>
<blockquote class="blockquote">
<p>class sklearn.pipeline.Pipeline(steps, *, memory=None, verbose=False)</p>
</blockquote>
<p>It is a <em>pipeline of transformers with a final estimator</em>.</p>
<p>It sequentially applies a list of <strong>transforms</strong> and a final <strong>estimator</strong>. Intermediate steps of the pipeline must be <strong>transforms</strong>, that is, they must implement <strong>fit</strong> and <strong>transform</strong> methods. The final estimator only needs to implement <strong>fit</strong>.</p>
<p>Lets create a simple pipeline to better understand its componets. Steps in our pipeline will be * replace missing values using the mean along each <em>numerical feature</em> column; and * then scale them</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb9-6"><a href="#cb9-6"></a>    (<span class="st">'imputer'</span>, SimpleImputer()),</span>
<span id="cb9-7"><a href="#cb9-7"></a>    (<span class="st">'scaler'</span>, StandardScaler())</span>
<span id="cb9-8"><a href="#cb9-8"></a>])</span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co"># our first pipeline has been initialized</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</code></pre>
</div>
</div>
<p>We can also visualize the pipeline as a diagram. It has two steps: imputer and scaler in sequence.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">from</span> sklearn <span class="im">import</span> set_config</span>
<span id="cb11-2"><a href="#cb11-2"></a>set_config(display<span class="op">=</span><span class="st">"diagram"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<style>#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf {color: black;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf pre{padding: 0;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable {background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator:hover {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-item {z-index: 1;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:only-child::after {width: 0;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-text-repr-fallback {display: none;}</style><div id="sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="389aae22-0524-4e0c-b66e-f1a4ef5f4e21" type="checkbox"><label for="389aae22-0524-4e0c-b66e-f1a4ef5f4e21" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e19aeb3-49b0-4aaa-80df-65cd4ecfe474" type="checkbox"><label for="2e19aeb3-49b0-4aaa-80df-65cd4ecfe474" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="438d0fc7-aaa5-4cc1-a34e-6a7d8c32dba4" type="checkbox"><label for="438d0fc7-aaa5-4cc1-a34e-6a7d8c32dba4" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>now lets call <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline.fit_transform"><strong>fit_transform</strong></a> method to run this pipeline, and preprocess our loaded data</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#collapse-output</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>pipe.fit_transform(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: Cannot use mean strategy with non-numeric data:
could not convert string to float: "McCarthy, Miss. Catherine 'Katie'"</code></pre>
</div>
</div>
<p>Aaargh! this is not what we intended. Let us try to understand why our pipeline did not work and then fix it. The exception message says:</p>
<pre><code>ValueError: Cannot use mean strategy with non-numeric data: could not convert string to float: "McCarthy, Miss. Catherine 'Katie'</code></pre>
<p>From the error message we can deduce that Pipeline is trying to apply its transformers on all columns in the dataset. This was not our intention, as we wanted to apply the transformers to numeric data only. Let’s limit our simple pipeline to numerical columns and run again.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>num_cols <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'fare'</span>]</span>
<span id="cb15-2"><a href="#cb15-2"></a>pipe.fit_transform(X_train[num_cols], y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>array([[ 0.        , -0.49963779],
       [-0.43641134, -0.09097855],
       [-1.44872891, -0.01824953],
       ...,
       [-0.98150542, -0.49349894],
       [-0.82576425, -0.44336498],
       [-0.59215251, -0.49349894]])</code></pre>
</div>
</div>
<p>Alright, our pipeline has run now and we can also observe a few outcomes. * When we apply a pipeline to a dataset it will run transformers to all features in the dataset. * Output from one transformer will be passed on to the next one until we reach the end of the pipeline * If we want to apply different transformers for numerical and categorical features (heterogeneous data) then the pipeline will not work for us. We would have to create separate pipelines for the different feature sets and then join the output.</p>
<p>To overcome the limitation of a pipeline for heterogeneous data, Sklearn recommends using <code>ColumnTransformer</code>. With ColumnTransformer we can provide column names against the transformers on which we want to apply them.</p>
</section>
<section id="columntransformer" class="level2">
<h2 class="anchored" data-anchor-id="columntransformer"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html">ColumnTransformer</a></h2>
<p>Let’s see our first ColumnTransformer in action.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># Note the sequence when creating a ColumnTransformer</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># 1. a name for the transformer</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co"># 2. the transformer</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># 3. the column names</span></span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a>pipe <span class="op">=</span> ColumnTransformer([</span>
<span id="cb17-10"><a href="#cb17-10"></a>    (<span class="st">'standardscaler'</span>, StandardScaler(), [<span class="st">'age'</span>, <span class="st">'fare'</span>] ),</span>
<span id="cb17-11"><a href="#cb17-11"></a>    (<span class="st">'onehotencoder'</span>, OneHotEncoder(), [<span class="st">'sex'</span>])</span>
<span id="cb17-12"><a href="#cb17-12"></a>    ])</span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<style>#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d {color: black;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d pre{padding: 0;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable {background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator:hover {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-item {z-index: 1;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:only-child::after {width: 0;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-text-repr-fallback {display: none;}</style><div id="sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="21a9ab6a-cd1c-46d6-805e-5a6f5e959d4a" type="checkbox"><label for="21a9ab6a-cd1c-46d6-805e-5a6f5e959d4a" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="462d9f3e-0bfe-4465-97b6-04434fba3f13" type="checkbox"><label for="462d9f3e-0bfe-4465-97b6-04434fba3f13" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d040066d-e670-468f-a54c-a2b680ce0092" type="checkbox"><label for="d040066d-e670-468f-a54c-a2b680ce0092" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="63db649c-2bf6-43a1-8f64-4150194536ea" type="checkbox"><label for="63db649c-2bf6-43a1-8f64-4150194536ea" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e78c3d5-e5e0-472a-bfc4-975c93357c49" type="checkbox"><label for="2e78c3d5-e5e0-472a-bfc4-975c93357c49" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">##</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># Let's execute our pipeline to see the output.</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>pipe.fit_transform(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>array([[        nan, -0.49939913,  1.        ,  0.        ],
       [-0.39043136, -0.09093509,  1.        ,  0.        ],
       [-1.2960919 , -0.01824081,  1.        ,  0.        ],
       ...,
       [-0.87809473, -0.49326321,  0.        ,  1.        ],
       [-0.73876234, -0.4431532 ,  0.        ,  1.        ],
       [-0.52976375, -0.49326321,  0.        ,  1.        ]])</code></pre>
</div>
</div>
<section id="get_feature_names_outinput_featuresnone" class="level4">
<h4 class="anchored" data-anchor-id="get_feature_names_outinput_featuresnone"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer.get_feature_names_out">get_feature_names_out(input_features=None)</a></h4>
<p>At this point I will also introduce a very useful function <code>get_feature_names_out(input_features=None)</code>. Using this method we can get output feature names as well.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>pipe.get_feature_names_out()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>array(['standardscaler__age', 'standardscaler__fare',
       'onehotencoder__sex_female', 'onehotencoder__sex_male'],
      dtype=object)</code></pre>
</div>
</div>
<p>Notice the output * Output feature names appear as <code>&lt;transformer_name&gt;__&lt;feature_name&gt;</code> * For OneHotEncoded feature “sex”, output feature names have the label attached to them</p>
</section>
<section id="make_column_transformer" class="level4">
<h4 class="anchored" data-anchor-id="make_column_transformer"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.make_column_transformer.html">make_column_transformer</a></h4>
<p>Sklean also provides a wrapper function for <code>ColumnTransformer</code> where we don’t have to provide names for the transformers.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># Note the sequence when using make_column_transformer</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># 1. the transformer</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># 2. the column names</span></span>
<span id="cb22-6"><a href="#cb22-6"></a></span>
<span id="cb22-7"><a href="#cb22-7"></a>pipe <span class="op">=</span> make_column_transformer(</span>
<span id="cb22-8"><a href="#cb22-8"></a>    (StandardScaler(), [<span class="st">'age'</span>, <span class="st">'fare'</span>]),</span>
<span id="cb22-9"><a href="#cb22-9"></a>    (OneHotEncoder(), [<span class="st">'sex'</span>] ),</span>
<span id="cb22-10"><a href="#cb22-10"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span> <span class="co"># to keep output feature names simple</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>)</span>
<span id="cb22-12"><a href="#cb22-12"></a></span>
<span id="cb22-13"><a href="#cb22-13"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<style>#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e {color: black;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e pre{padding: 0;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable {background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator:hover {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-item {z-index: 1;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:only-child::after {width: 0;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-text-repr-fallback {display: none;}</style><div id="sk-49b26e74-1e32-4f57-ac80-d53883a6b13e" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ddaf98b5-df69-409b-86f6-a26fae31b4dd" type="checkbox"><label for="ddaf98b5-df69-409b-86f6-a26fae31b4dd" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bc47c38d-0fbd-4cfc-ae01-bc12ecd46658" type="checkbox"><label for="bc47c38d-0fbd-4cfc-ae01-bc12ecd46658" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8c04b557-0f7c-4228-962d-1e3b3535f7b8" type="checkbox"><label for="8c04b557-0f7c-4228-962d-1e3b3535f7b8" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="09d678b6-4e36-4d96-a707-a8074fe889e0" type="checkbox"><label for="09d678b6-4e36-4d96-a707-a8074fe889e0" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d3cd275c-c821-4111-b8d4-304a90fdbf15" type="checkbox"><label for="d3cd275c-c821-4111-b8d4-304a90fdbf15" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">##</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co"># Let's execute our pipeline.</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>pipe.fit_transform(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array([[        nan, -0.49939913,  1.        ,  0.        ],
       [-0.39043136, -0.09093509,  1.        ,  0.        ],
       [-1.2960919 , -0.01824081,  1.        ,  0.        ],
       ...,
       [-0.87809473, -0.49326321,  0.        ,  1.        ],
       [-0.73876234, -0.4431532 ,  0.        ,  1.        ],
       [-0.52976375, -0.49326321,  0.        ,  1.        ]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">##</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="co"># notice the feature names this time. they are shorter.</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co"># we have used attribute "verbose_feature_names_out=False" in our pipeline above.</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>pipe.get_feature_names_out()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array(['age', 'fare', 'sex_female', 'sex_male'], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="important-difference-between-pipeline-and-columntransformer" class="level4">
<h4 class="anchored" data-anchor-id="important-difference-between-pipeline-and-columntransformer">Important difference between Pipeline and ColumnTransformer</h4>
<ul>
<li>Pipeline applies transformer in sequence on all columns</li>
<li>ColumnTranformer applies transformers in parallel to specified columns and then concats the output</li>
</ul>
</section>
<section id="open-questions" class="level4">
<h4 class="anchored" data-anchor-id="open-questions">Open questions?</h4>
<p>So our ColumnTransformer is working. But we have a few more questions to address. * Why is the output from our pipeline or ColumnTransformer not shown as a dataframe with output features nicely separated in different columns? * Our input dataset had more features besides age, fare, and sex. Why are they not present in the output? * What happens if I change the sequence of transformers, and feature names in my ColumnTransformer?</p>
<p>In the coming sections, we will try to address these questions.</p>
<section id="why-is-the-output-not-a-dataframe" class="level5">
<h5 class="anchored" data-anchor-id="why-is-the-output-not-a-dataframe"><strong>Why is the output not a dataframe?</strong></h5>
<p>The output from a pipeline or a ColumnTransformer is an nd-array where the first index is the number of samples, and second index are the output features <code>(n_samples, n_output_features)</code>. Since we are only getting numpy array as an output, we are losing information about the column names.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="bu">print</span>(<span class="bu">type</span>(temp))</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="bu">print</span>(temp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt;
(1047, 4)</code></pre>
</div>
</div>
</section>
<section id="can-we-get-the-feature-names-back" class="level5">
<h5 class="anchored" data-anchor-id="can-we-get-the-feature-names-back"><strong>Can we get the feature names back?</strong></h5>
<p>We have already seen that we can get the output feature names using method <code>get_feature_names_out</code>. But this time let’s try to analyze our ColumnsTransformer more closely. The transformer attributes discussed here also applies to Pipeline object.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">##</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># print the internals of ColumnTransformer</span></span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a>set_config(display<span class="op">=</span><span class="st">'text'</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</code></pre>
</div>
</div>
<p>ColumnTransformer has an attribute ‘transformers’ that is keeping a list of all the provided transformers. Let’s print it.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>pipe.transformers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>[('standardscaler', StandardScaler(), ['age', 'fare']),
 ('onehotencoder', OneHotEncoder(), ['sex'])]</code></pre>
</div>
</div>
<p>These are the transformers list at the initialization time. If we want to check the transformers after <code>fit</code> function has been called, then we need to print a different attribute <code>transformers_</code>.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>pipe.transformers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>[('standardscaler', StandardScaler(), ['age', 'fare']),
 ('onehotencoder', OneHotEncoder(), ['sex']),
 ('remainder', 'drop', [0, 1, 4, 5, 6, 8])]</code></pre>
</div>
</div>
<p>You can see the difference. There is an extra transformer with the name <code>remainder</code> at the end. It was not present at the initialization time. What it does is that it drops all remaining columns from the dataset that have not been explicitly used in the ColumnTransformer. Since, at the initialization time, ColumnTransformer does not know about the <strong>other columns</strong> that it needs to drop this transformer is missing. During fit it sees the dataset and knows about the other columns, it then keeps a list of them to drop <strong>(0, 1, 4, 5, 6, 8)</strong>.</p>
<p>We can also index through the transformers as well to fetch anyone from the list.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co">##</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># second transformer from the list</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>pipe.transformers_[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>('onehotencoder', OneHotEncoder(), ['sex'])</code></pre>
</div>
</div>
<p>Notice the tuple sequence. * First is the name * Second is the <strong>transformer</strong> * Third are the column names</p>
<p>We can also call <code>get_feature_names_out</code> method on a separate transformer from the list.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">##</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co"># output features from second tranformer</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>pipe.transformers_[<span class="dv">1</span>][<span class="dv">1</span>].get_feature_names_out()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array(['sex_female', 'sex_male'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co">##</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># output features from last tranformer</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>pipe.transformers_[<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].get_feature_names_out()</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co"># No. We cannot do this on last transformer (remainder).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'str' object has no attribute 'get_feature_names_out'</code></pre>
</div>
</div>
<p>We now have output feature names, and the output (nd-array). Can we convert them to a DataFrame?</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb41-4"><a href="#cb41-4"></a>col_names <span class="op">=</span> pipe.get_feature_names_out()</span>
<span id="cb41-5"><a href="#cb41-5"></a></span>
<span id="cb41-6"><a href="#cb41-6"></a>output <span class="op">=</span> pd.DataFrame(temp.T, col_names).T</span>
<span id="cb41-7"><a href="#cb41-7"></a>output.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="functiontransformer" class="level2">
<h2 class="anchored" data-anchor-id="functiontransformer"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html">FunctionTransformer</a></h2>
<p>We know how to convert the transformer output to a DataFrame. It would be much simpler if we don’t have to do an extra step, and can directly get a Dataframe from our fitted ColumnTransformer.</p>
<p>For this we can take the help of <code>FunctionTransformer</code> &gt; A FunctionTransformer forwards its X (and optionally y) arguments to a user-defined function or function object and returns the result of this function.</p>
<p>Let’s see a FunctionTransformer in action.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> FunctionTransformer</span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb42-4"><a href="#cb42-4"></a>    (StandardScaler(), [<span class="st">'age'</span>, <span class="st">'fare'</span>]),</span>
<span id="cb42-5"><a href="#cb42-5"></a>    (OneHotEncoder(), [<span class="st">'sex'</span>] ),</span>
<span id="cb42-6"><a href="#cb42-6"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>)</span>
<span id="cb42-8"><a href="#cb42-8"></a></span>
<span id="cb42-9"><a href="#cb42-9"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb42-10"><a href="#cb42-10"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb42-11"><a href="#cb42-11"></a>                    (<span class="st">"dataframer"</span>,FunctionTransformer(<span class="kw">lambda</span> x: pd.DataFrame(x, columns <span class="op">=</span> preprocessor.get_feature_names_out())))</span>
<span id="cb42-12"><a href="#cb42-12"></a>                    ])</span>
<span id="cb42-13"><a href="#cb42-13"></a></span>
<span id="cb42-14"><a href="#cb42-14"></a>set_config(display<span class="op">=</span><span class="st">"diagram"</span>)</span>
<span id="cb42-15"><a href="#cb42-15"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<style>#sk-dc5aef48-8c2a-4f33-9085-34090768e983 {color: black;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 pre{padding: 0;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable {background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator:hover {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-item {z-index: 1;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:only-child::after {width: 0;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-text-repr-fallback {display: none;}</style><div id="sk-dc5aef48-8c2a-4f33-9085-34090768e983" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="49d0b146-1bc2-4c8c-b4c2-432107121872" type="checkbox"><label for="49d0b146-1bc2-4c8c-b4c2-432107121872" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b9c9c9fd-6abd-464a-a965-4eee6608e760" type="checkbox"><label for="b9c9c9fd-6abd-464a-a965-4eee6608e760" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="18e37f3b-5e1e-43a5-bdbc-98386493f20a" type="checkbox"><label for="18e37f3b-5e1e-43a5-bdbc-98386493f20a" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="39144de1-a891-4e83-8278-614246a7e0a1" type="checkbox"><label for="39144de1-a891-4e83-8278-614246a7e0a1" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="687bb43d-5c04-4da5-adbe-0700e7186fa5" type="checkbox"><label for="687bb43d-5c04-4da5-adbe-0700e7186fa5" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0378e35b-0d19-4235-81fd-855750059d41" type="checkbox"><label for="0378e35b-0d19-4235-81fd-855750059d41" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d18eac3c-4f6f-4f6e-8830-e1122927172d" type="checkbox"><label for="d18eac3c-4f6f-4f6e-8830-e1122927172d" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;)</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Notice that we have applied FunctionTransformer after ColumnTransformer in a Pipeline. When we fit our pipeline on the dataset, ColumnTransformer will be fitted first and then the FunctionTransformer. Since the ColumnTransformer has been fitted first, we will be able to call <code>get_feature_names_out</code> on it while passing data to FunctionTransformer.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="co">##</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co"># let's run our pipeline again</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb43-4"><a href="#cb43-4"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This is looking good. We are now getting back a dataframe directly from the pipeline. With a dataframe it is a lot easier to view and verify the output from the preprocessor.</p>
<p>But we have to be very careful with FunctionTransformer. In Sklearn docs, it says</p>
<p><strong>Note: If a lambda is used as the function, then the resulting transformer will not be pickleable.</strong></p>
<p>Huh! that is a very concerning point. We have also used a lambda function, and we will not be able to pickle it. Let’s check it first.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="im">import</span> pickle</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="co"># save our pipeline</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>s1 <span class="op">=</span> pickle.dumps(pipe)</span>
<span id="cb44-5"><a href="#cb44-5"></a></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="co"># reload it</span></span>
<span id="cb44-7"><a href="#cb44-7"></a>s2 <span class="op">=</span> pickle.loads(s1)</span>
<span id="cb44-8"><a href="#cb44-8"></a>s2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>PicklingError: Can't pickle &lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;: attribute lookup &lt;lambda&gt; on __main__ failed</code></pre>
</div>
</div>
<p>The documentation was right about it. We have used a Lambda function in our FunctionTranformer and we got a pickle error. Since, the limitation is said for Lambda function, changing it with a normal function should work. Let’s do that.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">def</span> get_dataframe(X, transformer):</span>
<span id="cb46-2"><a href="#cb46-2"></a>    <span class="co">""" </span></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="co">    x: an nd-array</span></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co">    transformer: fitted transformer</span></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="co">    """</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>    col_names <span class="op">=</span> transformer.get_feature_names_out()</span>
<span id="cb46-7"><a href="#cb46-7"></a>    output <span class="op">=</span> pd.DataFrame(X.T, col_names).T</span>
<span id="cb46-8"><a href="#cb46-8"></a>    <span class="cf">return</span> output</span>
<span id="cb46-9"><a href="#cb46-9"></a></span>
<span id="cb46-10"><a href="#cb46-10"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb46-11"><a href="#cb46-11"></a>    (StandardScaler(), [<span class="st">'age'</span>, <span class="st">'fare'</span>]),</span>
<span id="cb46-12"><a href="#cb46-12"></a>    (OneHotEncoder(), [<span class="st">'sex'</span>] ),</span>
<span id="cb46-13"><a href="#cb46-13"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb46-14"><a href="#cb46-14"></a>)</span>
<span id="cb46-15"><a href="#cb46-15"></a></span>
<span id="cb46-16"><a href="#cb46-16"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb46-17"><a href="#cb46-17"></a></span>
<span id="cb46-18"><a href="#cb46-18"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb46-19"><a href="#cb46-19"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb46-20"><a href="#cb46-20"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb46-21"><a href="#cb46-21"></a>                ])</span>
<span id="cb46-22"><a href="#cb46-22"></a></span>
<span id="cb46-23"><a href="#cb46-23"></a>set_config(display<span class="op">=</span><span class="st">"diagram"</span>)</span>
<span id="cb46-24"><a href="#cb46-24"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<style>#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 {color: black;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 pre{padding: 0;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable {background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator:hover {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-item {z-index: 1;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:only-child::after {width: 0;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-text-repr-fallback {display: none;}</style><div id="sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c1dd7b9c-8051-437c-a176-950e15eec6bc" type="checkbox"><label for="c1dd7b9c-8051-437c-a176-950e15eec6bc" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="73b087ba-e430-4766-a778-60104e03bc77" type="checkbox"><label for="73b087ba-e430-4766-a778-60104e03bc77" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="69d75b34-10a2-4774-ac52-f5e9afb59db4" type="checkbox"><label for="69d75b34-10a2-4774-ac52-f5e9afb59db4" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d33f4bc8-d8f4-401a-a7ad-925058469130" type="checkbox"><label for="d33f4bc8-d8f4-401a-a7ad-925058469130" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a15bdd72-d5d0-4c65-bccd-96270b7cfbfd" type="checkbox"><label for="a15bdd72-d5d0-4c65-bccd-96270b7cfbfd" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="93342583-a2e7-4912-a003-5c407b1dadfe" type="checkbox"><label for="93342583-a2e7-4912-a003-5c407b1dadfe" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8a9f3153-55f2-4f14-a771-4371c8673e32" type="checkbox"><label for="8a9f3153-55f2-4f14-a771-4371c8673e32" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                             StandardScaler(),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(),
                                                                             ['sex'])],
                                                              verbose_feature_names_out=False)})</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Notice the arguments for FunctionTransformer in the above code. * first argument is the function to be called * second argument are the parameters to be passed to our function</p>
<p>The sequence of arguments for the callable function will be * first argument will be the output from any previous step in the pipeline (if there is any). In our case, it is nd-array coming from ColumnTransformer. It will be mapped to <code>X</code>. We don’t have to do anything about it. * second argument (if any) we want to pass to function. In our case we need it to be the fitted transformer from the previous step so we have explicitly passed it using <code>kw_args</code> as key-value pair. Where key name is the same as callable method argument name (‘transformer’ in our case).</p>
<p>Now let’s do our pickle test one more time.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">##</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># save our pipeline</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>s1 <span class="op">=</span> pickle.dumps(pipe)</span>
<span id="cb47-4"><a href="#cb47-4"></a></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co"># reload it</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>s2 <span class="op">=</span> pickle.loads(s1)</span>
<span id="cb47-7"><a href="#cb47-7"></a>s2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<style>#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 {color: black;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 pre{padding: 0;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable {background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator:hover {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-item {z-index: 1;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:only-child::after {width: 0;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-text-repr-fallback {display: none;}</style><div id="sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ec9bb235-5034-4154-8f6b-e8ab4b383581" type="checkbox"><label for="ec9bb235-5034-4154-8f6b-e8ab4b383581" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bb60241a-02b2-4fae-ae5e-e587f5fcb569" type="checkbox"><label for="bb60241a-02b2-4fae-ae5e-e587f5fcb569" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4ef00a54-ef13-4006-b1e0-febf19c07340" type="checkbox"><label for="4ef00a54-ef13-4006-b1e0-febf19c07340" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1d5d96ff-c056-40fb-a65d-7daa33aa6951" type="checkbox"><label for="1d5d96ff-c056-40fb-a65d-7daa33aa6951" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="44041671-e734-4d47-b00c-81d699a7b28a" type="checkbox"><label for="44041671-e734-4d47-b00c-81d699a7b28a" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a8fd907f-d663-419e-bd03-d35a0b28a057" type="checkbox"><label for="a8fd907f-d663-419e-bd03-d35a0b28a057" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e32941e4-8a75-49d1-ba1d-0bd1869df507" type="checkbox"><label for="e32941e4-8a75-49d1-ba1d-0bd1869df507" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                             StandardScaler(),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(),
                                                                             ['sex'])],
                                                              verbose_feature_names_out=False)})</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>Alright, no more issues so let’s proceed to our next question.</p>
<section id="where-are-the-rest-of-the-columns" class="level3">
<h3 class="anchored" data-anchor-id="where-are-the-rest-of-the-columns">Where are the rest of the columns?</h3>
<p>By default, only the specified columns in transformers are transformed and combined in the output, and the non-specified columns are dropped. (default of <code>remainder='drop'</code>). By specifying <code>remainder='passthrough'</code>, all remaining columns that were not specified in transformers will be automatically passed through. This subset of columns is concatenated with the output of the transformers.</p>
<p>Let’s see it in action.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb48-2"><a href="#cb48-2"></a>    (StandardScaler(), [<span class="st">'age'</span>, <span class="st">'fare'</span>]),</span>
<span id="cb48-3"><a href="#cb48-3"></a>    (OneHotEncoder(), [<span class="st">'sex'</span>] ),</span>
<span id="cb48-4"><a href="#cb48-4"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>    remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>)</span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="co"># get_dataframe is already defined in last section. Intentionally omitted here. </span></span>
<span id="cb48-9"><a href="#cb48-9"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb48-10"><a href="#cb48-10"></a></span>
<span id="cb48-11"><a href="#cb48-11"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb48-12"><a href="#cb48-12"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb48-13"><a href="#cb48-13"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb48-14"><a href="#cb48-14"></a>                ])</span>
<span id="cb48-15"><a href="#cb48-15"></a></span>
<span id="cb48-16"><a href="#cb48-16"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb48-17"><a href="#cb48-17"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We have our remaining features back now, so let’s proceed to our next question.</p>
</section>
<section id="what-happens-if-i-change-the-sequence-in-columntranformer" class="level3">
<h3 class="anchored" data-anchor-id="what-happens-if-i-change-the-sequence-in-columntranformer">What happens if I change the sequence in ColumnTranformer?</h3>
<p>It is better to make some changes and then see the results. I am making two changes in ColumnTransformer 1. Changed the order of transformers (OHE before scaling) 2. Changed the order of features inside the transformer (‘fare’ before ‘age’)</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb49-2"><a href="#cb49-2"></a>    (OneHotEncoder(), [<span class="st">'sex'</span>] ),</span>
<span id="cb49-3"><a href="#cb49-3"></a>    (StandardScaler(), [<span class="st">'fare'</span>, <span class="st">'age'</span>]),</span>
<span id="cb49-4"><a href="#cb49-4"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb49-5"><a href="#cb49-5"></a>    remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>)</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="co"># get_dataframe is already defined in last section. Intentionally omitted here. </span></span>
<span id="cb49-9"><a href="#cb49-9"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb49-10"><a href="#cb49-10"></a></span>
<span id="cb49-11"><a href="#cb49-11"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb49-12"><a href="#cb49-12"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb49-13"><a href="#cb49-13"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb49-14"><a href="#cb49-14"></a>                ])</span>
<span id="cb49-15"><a href="#cb49-15"></a></span>
<span id="cb49-16"><a href="#cb49-16"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb49-17"><a href="#cb49-17"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>fare</th>
      <th>age</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.499399</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.090935</td>
      <td>-0.390431</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.018241</td>
      <td>-1.296092</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.510137</td>
      <td>-0.320765</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.501444</td>
      <td>-0.947761</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can see that changing the sequence in ColumnTransformer does change the output. Also note * Specified columns in transformers are transformed and combined in the output * Transformers sequence in ColumnTransformer also represents the columns sequence in the output * When <code>remainder=passthrough</code> is used then remaining columns will be appended at the end. Remainder columns sequence will be same as in the input.</p>
</section>
</section>
<section id="pipeline-inside-columntransformer" class="level2">
<h2 class="anchored" data-anchor-id="pipeline-inside-columntransformer">Pipeline inside ColumnTransformer</h2>
<p>Let’s assume we have more requirements this time. I want * for numerical features (age, fare): impute the missing values first, and then scale them * for categorical features (sex): one hot encode them</p>
<p>Our pipeline will look like this.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a><span class="co">#collapse-output</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>numeric_features <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"fare"</span>]</span>
<span id="cb50-3"><a href="#cb50-3"></a>numeric_transformer <span class="op">=</span> Pipeline(</span>
<span id="cb50-4"><a href="#cb50-4"></a>    steps<span class="op">=</span>[</span>
<span id="cb50-5"><a href="#cb50-5"></a>        (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>)),</span>
<span id="cb50-6"><a href="#cb50-6"></a>        (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb50-7"><a href="#cb50-7"></a>        ])</span>
<span id="cb50-8"><a href="#cb50-8"></a></span>
<span id="cb50-9"><a href="#cb50-9"></a>categorical_features <span class="op">=</span> [<span class="st">"sex"</span>]</span>
<span id="cb50-10"><a href="#cb50-10"></a>categorical_transformer <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb50-11"><a href="#cb50-11"></a></span>
<span id="cb50-12"><a href="#cb50-12"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb50-13"><a href="#cb50-13"></a>        (numeric_transformer, numeric_features), <span class="co"># note "numeric_transformer" is a pipeline this time</span></span>
<span id="cb50-14"><a href="#cb50-14"></a>        (categorical_transformer, categorical_features),</span>
<span id="cb50-15"><a href="#cb50-15"></a>        remainder<span class="op">=</span><span class="st">'passthrough'</span>,</span>
<span id="cb50-16"><a href="#cb50-16"></a>        verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb50-17"><a href="#cb50-17"></a>)</span>
<span id="cb50-18"><a href="#cb50-18"></a></span>
<span id="cb50-19"><a href="#cb50-19"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb50-20"><a href="#cb50-20"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb50-21"><a href="#cb50-21"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb50-22"><a href="#cb50-22"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb50-23"><a href="#cb50-23"></a>                ])</span>
<span id="cb50-24"><a href="#cb50-24"></a></span>
<span id="cb50-25"><a href="#cb50-25"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb50-26"><a href="#cb50-26"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: Estimator imputer does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?</code></pre>
</div>
</div>
<p>Oh geez! What went wrong this time. The error message says</p>
<pre><code>AttributeError: Estimator imputer does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?</code></pre>
<p>From the error message I am getting that &gt; Estimator imputer does not provide get_feature_names_out</p>
<p>Hmmm, this is strange. Why is this estimator missing a very useful function? Let’s check the docs first on <a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html">SimpleImputer</a>. For the docs I indeed could not find this method <code>get_feature_names_out()</code> for this transformer. A little googling lead me to this Sklearn Github issue page <a href="https://github.com/scikit-learn/scikit-learn/issues/21308">Implement get_feature_names_out for all estimators</a>. Developers are actively adding <code>get_feature_names_out()</code> to all estimators and transformers, and it looks like this feature has not been implemented for <code>SimpleImputer</code> till Sklearn version==1.0.2.</p>
<p>But no worries we can overcome this limitation, and implement this feature ourselves through a custom transformer.</p>
</section>
<section id="custom-transformer" class="level2">
<h2 class="anchored" data-anchor-id="custom-transformer"><a href="https://scikit-learn.org/stable/developers/develop.html#rolling-your-own-estimator">Custom Transformer</a></h2>
<p>We can create a custom transformer or an estimator simply by inheriting a class from <code>BaseEstimator</code> and optionally the mixin classes in <code>sklearn.base</code>. Sklean provides a template that we can use to create our custom transformer. Template link is here: https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L146</p>
<p>Let us use the same pipeline as in last cell but replace <code>SimpleImputer</code> with a custom one.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb53-2"><a href="#cb53-2"></a></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="kw">class</span> SimpleImputerCustom(BaseEstimator, TransformerMixin):</span>
<span id="cb53-4"><a href="#cb53-4"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, strategy<span class="op">=</span><span class="st">'mean'</span>):</span>
<span id="cb53-5"><a href="#cb53-5"></a>        <span class="va">self</span>.strategy <span class="op">=</span> strategy</span>
<span id="cb53-6"><a href="#cb53-6"></a>        <span class="va">self</span>.imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="va">self</span>.strategy)</span>
<span id="cb53-7"><a href="#cb53-7"></a>       </span>
<span id="cb53-8"><a href="#cb53-8"></a>        </span>
<span id="cb53-9"><a href="#cb53-9"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb53-10"><a href="#cb53-10"></a>        <span class="va">self</span>.imputer.fit(X, y)</span>
<span id="cb53-11"><a href="#cb53-11"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb53-12"><a href="#cb53-12"></a>    </span>
<span id="cb53-13"><a href="#cb53-13"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb53-14"><a href="#cb53-14"></a>        <span class="cf">return</span> <span class="va">self</span>.imputer.transform(X)</span>
<span id="cb53-15"><a href="#cb53-15"></a>    </span>
<span id="cb53-16"><a href="#cb53-16"></a>    <span class="kw">def</span> get_feature_names_out(<span class="va">self</span>, input_features<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb53-17"><a href="#cb53-17"></a>        <span class="co"># we have returned the input features name as out features will have the same name</span></span>
<span id="cb53-18"><a href="#cb53-18"></a>        <span class="cf">return</span> input_features</span>
<span id="cb53-19"><a href="#cb53-19"></a></span>
<span id="cb53-20"><a href="#cb53-20"></a></span>
<span id="cb53-21"><a href="#cb53-21"></a>numeric_features <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"fare"</span>]</span>
<span id="cb53-22"><a href="#cb53-22"></a>numeric_transformer <span class="op">=</span> Pipeline(</span>
<span id="cb53-23"><a href="#cb53-23"></a>    steps<span class="op">=</span>[</span>
<span id="cb53-24"><a href="#cb53-24"></a>            (<span class="st">"imputer"</span>, SimpleImputerCustom(strategy<span class="op">=</span><span class="st">'mean'</span>)),</span>
<span id="cb53-25"><a href="#cb53-25"></a>            (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb53-26"><a href="#cb53-26"></a>             ]</span>
<span id="cb53-27"><a href="#cb53-27"></a>)</span>
<span id="cb53-28"><a href="#cb53-28"></a></span>
<span id="cb53-29"><a href="#cb53-29"></a></span>
<span id="cb53-30"><a href="#cb53-30"></a>categorical_features <span class="op">=</span> [<span class="st">"sex"</span>]</span>
<span id="cb53-31"><a href="#cb53-31"></a>categorical_transformer <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb53-32"><a href="#cb53-32"></a></span>
<span id="cb53-33"><a href="#cb53-33"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb53-34"><a href="#cb53-34"></a>        (numeric_transformer, numeric_features), <span class="co"># note "numeric_transformer" is a pipeline</span></span>
<span id="cb53-35"><a href="#cb53-35"></a>        (categorical_transformer, categorical_features),</span>
<span id="cb53-36"><a href="#cb53-36"></a>        remainder<span class="op">=</span><span class="st">'passthrough'</span>,</span>
<span id="cb53-37"><a href="#cb53-37"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb53-38"><a href="#cb53-38"></a>)</span>
<span id="cb53-39"><a href="#cb53-39"></a></span>
<span id="cb53-40"><a href="#cb53-40"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb53-41"><a href="#cb53-41"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb53-42"><a href="#cb53-42"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb53-43"><a href="#cb53-43"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb53-44"><a href="#cb53-44"></a>                ])</span>
<span id="cb53-45"><a href="#cb53-45"></a></span>
<span id="cb53-46"><a href="#cb53-46"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb53-47"><a href="#cb53-47"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>-0.499638</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.436411</td>
      <td>-0.090979</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.448729</td>
      <td>-0.01825</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.358541</td>
      <td>-0.510381</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.059376</td>
      <td>-0.501684</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="feature-engineering-with-custom-transformer" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering-with-custom-transformer">Feature Engineering with Custom Transformer</h2>
<p>So far, so good! Let’s assume that we have another requirement and it is about feature engineering. We have to combine ‘sibsp’ and ‘parch’ into two new features: family_size and is_alone.</p>
<p>Let’s implement this now.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">class</span> FamilyFeatureTransformer(BaseEstimator, TransformerMixin):</span>
<span id="cb54-2"><a href="#cb54-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb54-3"><a href="#cb54-3"></a>        <span class="cf">pass</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>       </span>
<span id="cb54-5"><a href="#cb54-5"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb54-6"><a href="#cb54-6"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb54-7"><a href="#cb54-7"></a>    </span>
<span id="cb54-8"><a href="#cb54-8"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb54-9"><a href="#cb54-9"></a>        X[<span class="st">'family_size'</span>] <span class="op">=</span> X[<span class="st">'parch'</span>] <span class="op">+</span> X[<span class="st">'sibsp'</span>]</span>
<span id="cb54-10"><a href="#cb54-10"></a>        X.drop([<span class="st">'parch'</span>, <span class="st">'sibsp'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># we can drop this feature now</span></span>
<span id="cb54-11"><a href="#cb54-11"></a>        X[<span class="st">'is_alone'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-12"><a href="#cb54-12"></a>        X.loc[X[<span class="st">'family_size'</span>] <span class="op">&gt;</span> <span class="dv">1</span>, <span class="st">'is_alone'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-13"><a href="#cb54-13"></a>        <span class="cf">return</span> X</span>
<span id="cb54-14"><a href="#cb54-14"></a>    </span>
<span id="cb54-15"><a href="#cb54-15"></a>    <span class="kw">def</span> get_feature_names_out(<span class="va">self</span>, input_features<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb54-16"><a href="#cb54-16"></a>        <span class="co"># this time we have created new features. Their names are different from input features.</span></span>
<span id="cb54-17"><a href="#cb54-17"></a>        <span class="co"># so we have explicitly mentioned them here.</span></span>
<span id="cb54-18"><a href="#cb54-18"></a>        <span class="cf">return</span> [<span class="st">'family_size'</span>, <span class="st">'is_alone'</span>]</span>
<span id="cb54-19"><a href="#cb54-19"></a></span>
<span id="cb54-20"><a href="#cb54-20"></a>numeric_features <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"fare"</span>]</span>
<span id="cb54-21"><a href="#cb54-21"></a>numeric_transformer <span class="op">=</span> Pipeline(</span>
<span id="cb54-22"><a href="#cb54-22"></a>    steps<span class="op">=</span>[</span>
<span id="cb54-23"><a href="#cb54-23"></a>            (<span class="st">"imputer"</span>, SimpleImputerCustom(strategy<span class="op">=</span><span class="st">'mean'</span>)),</span>
<span id="cb54-24"><a href="#cb54-24"></a>            (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb54-25"><a href="#cb54-25"></a>             ]</span>
<span id="cb54-26"><a href="#cb54-26"></a>)</span>
<span id="cb54-27"><a href="#cb54-27"></a></span>
<span id="cb54-28"><a href="#cb54-28"></a>categorical_features <span class="op">=</span> [<span class="st">"sex"</span>]</span>
<span id="cb54-29"><a href="#cb54-29"></a>categorical_transformer <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb54-30"><a href="#cb54-30"></a></span>
<span id="cb54-31"><a href="#cb54-31"></a>family_features <span class="op">=</span> [<span class="st">"parch"</span>, <span class="st">"sibsp"</span>]</span>
<span id="cb54-32"><a href="#cb54-32"></a>family_transformer <span class="op">=</span> FamilyFeatureTransformer()</span>
<span id="cb54-33"><a href="#cb54-33"></a></span>
<span id="cb54-34"><a href="#cb54-34"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb54-35"><a href="#cb54-35"></a>        (numeric_transformer, numeric_features), </span>
<span id="cb54-36"><a href="#cb54-36"></a>        (categorical_transformer, categorical_features),</span>
<span id="cb54-37"><a href="#cb54-37"></a>        (family_transformer, family_features),</span>
<span id="cb54-38"><a href="#cb54-38"></a>        remainder<span class="op">=</span><span class="st">'drop'</span>, <span class="co"># let's drop extra features this time</span></span>
<span id="cb54-39"><a href="#cb54-39"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb54-40"><a href="#cb54-40"></a>)</span>
<span id="cb54-41"><a href="#cb54-41"></a></span>
<span id="cb54-42"><a href="#cb54-42"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb54-43"><a href="#cb54-43"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb54-44"><a href="#cb54-44"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb54-45"><a href="#cb54-45"></a>                    (<span class="st">"dataframer"</span>, dataframer)</span>
<span id="cb54-46"><a href="#cb54-46"></a>                ])</span>
<span id="cb54-47"><a href="#cb54-47"></a></span>
<span id="cb54-48"><a href="#cb54-48"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb54-49"><a href="#cb54-49"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>family_size</th>
      <th>is_alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000000</td>
      <td>-0.499638</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.436411</td>
      <td>-0.090979</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.448729</td>
      <td>-0.018250</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.358541</td>
      <td>-0.510381</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.059376</td>
      <td>-0.501684</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sklean-pipeline-with-feature-importance" class="level2">
<h2 class="anchored" data-anchor-id="sklean-pipeline-with-feature-importance">Sklean Pipeline with Feature Importance</h2>
<p>Alright, we have our required features ready and we can now pass them to a classifier. Let’s use RandomForrest as our classifier and run our pipeline with it.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb55-3"><a href="#cb55-3"></a></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="co"># 'preprocessor' and 'dataframer' are already declared in last section, and intentionally omitted here.</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb55-6"><a href="#cb55-6"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb55-7"><a href="#cb55-7"></a>                    (<span class="st">"dataframer"</span>, dataframer),</span>
<span id="cb55-8"><a href="#cb55-8"></a>                    (<span class="st">'rf_estimator'</span>, RandomForestClassifier())</span>
<span id="cb55-9"><a href="#cb55-9"></a></span>
<span id="cb55-10"><a href="#cb55-10"></a>                ])</span>
<span id="cb55-11"><a href="#cb55-11"></a></span>
<span id="cb55-12"><a href="#cb55-12"></a>temp <span class="op">=</span> pipe.fit_transform(X_train, y_train)</span>
<span id="cb55-13"><a href="#cb55-13"></a>temp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'RandomForestClassifier' object has no attribute 'transform'</code></pre>
</div>
</div>
<p>Okay, looks like we have made a mistake here. Error message is saying</p>
<pre><code>AttributeError: 'RandomForestClassifier' object has no attribute 'transform'</code></pre>
<p>I get that. In our pipeline we have an estimator that does not have a <code>transform</code> method defined for it. We should use <code>predict</code> method instead.</p>
<p>Note: * Estimators implement predict method (<a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L11">Template reference Estimator</a>, <a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L74">Template reference Classifier</a>) * Transformers implement transform method (<a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L146">Template reference Transformer</a>) * <code>fit_transform</code> is same calling <code>fit</code> and then <code>transform</code></p>
<p>Let us fix the error and run our pipeline again.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a><span class="co">##</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="co"># pipeline created in last section and intentionally omitted here.</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>pipe.fit(X_train, y_train)</span>
<span id="cb58-4"><a href="#cb58-4"></a>y_pred <span class="op">=</span> pipe.predict(X_test)</span>
<span id="cb58-5"><a href="#cb58-5"></a>accuracy_score(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0.7862595419847328</code></pre>
</div>
</div>
<p>Let’s see how our final pipeline looks visually.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a><span class="co">##</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co"># set_config(display='text')</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<style>#sk-094f6b23-72e9-4895-8e98-607e2a1a464e {color: black;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e pre{padding: 0;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable {background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator:hover {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-item {z-index: 1;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:only-child::after {width: 0;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-text-repr-fallback {display: none;}</style><div id="sk-094f6b23-72e9-4895-8e98-607e2a1a464e" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ca76dfde-00f2-4057-a29c-a8116207019d" type="checkbox"><label for="ca76dfde-00f2-4057-a29c-a8116207019d" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4e3834d5-ce09-4677-875a-61109d70af6a" type="checkbox"><label for="4e3834d5-ce09-4677-875a-61109d70af6a" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputerCustom()),
                                                 ('scaler', StandardScaler())]),
                                 ['age', 'fare']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['sex']),
                                ('familyfeaturetransformer',
                                 FamilyFeatureTransformer(),
                                 ['parch', 'sibsp'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f25f2e93-bb80-4e54-bfff-b7263183cbd3" type="checkbox"><label for="f25f2e93-bb80-4e54-bfff-b7263183cbd3" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="108a879c-a560-40ae-a624-db3e332efe26" type="checkbox"><label for="108a879c-a560-40ae-a624-db3e332efe26" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputerCustom</label><div class="sk-toggleable__content"><pre>SimpleImputerCustom()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="39c8a3a9-d36f-42c3-ab7c-86e69958a54f" type="checkbox"><label for="39c8a3a9-d36f-42c3-ab7c-86e69958a54f" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="484841a9-3d3d-4e15-9c6e-4f41d0b4e65e" type="checkbox"><label for="484841a9-3d3d-4e15-9c6e-4f41d0b4e65e" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f9bd1712-adee-4275-b38c-903a02139b82" type="checkbox"><label for="f9bd1712-adee-4275-b38c-903a02139b82" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="09a0f69d-bb27-405a-87df-bae3d2aeda22" type="checkbox"><label for="09a0f69d-bb27-405a-87df-bae3d2aeda22" class="sk-toggleable__label sk-toggleable__label-arrow">familyfeaturetransformer</label><div class="sk-toggleable__content"><pre>['parch', 'sibsp']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="09ebfae6-ee32-43db-a2eb-0bb75605ff87" type="checkbox"><label for="09ebfae6-ee32-43db-a2eb-0bb75605ff87" class="sk-toggleable__label sk-toggleable__label-arrow">FamilyFeatureTransformer</label><div class="sk-toggleable__content"><pre>FamilyFeatureTransformer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="173bb70a-3517-42e8-abbb-67fabd971aae" type="checkbox"><label for="173bb70a-3517-42e8-abbb-67fabd971aae" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                             Pipeline(steps=[('imputer',
                                                                                              SimpleImputerCustom()),
                                                                                             ('scaler',
                                                                                              StandardScaler())]),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(handle_unknown='ignore'),
                                                                             ['sex']),
                                                                            ('familyfeaturetransformer',
                                                                             FamilyFeatureTransformer(),
                                                                             ['parch',
                                                                              'sibsp'])],
                                                              verbose_feature_names_out=False)})</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d648296-9d3f-453c-92f0-23fd7bb38a06" type="checkbox"><label for="2d648296-9d3f-453c-92f0-23fd7bb38a06" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div></div></div></div></div></div></div>
</div>
</div>
<p>We can also get the importance of features in our dataset from RandomForrest classifier.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a>clf <span class="op">=</span> pipe[<span class="op">-</span><span class="dv">1</span>] <span class="co"># last estimator is the RF classifier</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>importances <span class="op">=</span> clf.feature_importances_</span>
<span id="cb61-5"><a href="#cb61-5"></a>features <span class="op">=</span> clf.feature_names_in_</span>
<span id="cb61-6"><a href="#cb61-6"></a></span>
<span id="cb61-7"><a href="#cb61-7"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb61-8"><a href="#cb61-8"></a></span>
<span id="cb61-9"><a href="#cb61-9"></a>plt.title(<span class="st">'Feature Importances'</span>)</span>
<span id="cb61-10"><a href="#cb61-10"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices], color<span class="op">=</span><span class="st">'b'</span>, align<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb61-11"><a href="#cb61-11"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), [features[i] <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb61-12"><a href="#cb61-12"></a>plt.xlabel(<span class="st">'Relative Importance'</span>)</span>
<span id="cb61-13"><a href="#cb61-13"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-03-04-sklearn-pipeline-deep-dive_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that all the feature names were passed to the RF Classifier and that is why we were able to get them back using its attribute <code>feature_names_in_</code>. This can be super useful when you have many model deployed in the environment, and you can just use the model object to get information about the features it was trained on.</p>
<p>For a moment let’s also remove the feature names from our pipeline and see how it will effect our feature importance plot.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb62-2"><a href="#cb62-2"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb62-3"><a href="#cb62-3"></a>                    <span class="co"># ("dataframer", dataframer),</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>                    (<span class="st">'rf_estimator'</span>, RandomForestClassifier())</span>
<span id="cb62-5"><a href="#cb62-5"></a></span>
<span id="cb62-6"><a href="#cb62-6"></a>                ])</span>
<span id="cb62-7"><a href="#cb62-7"></a></span>
<span id="cb62-8"><a href="#cb62-8"></a><span class="co"># fit the pipeline</span></span>
<span id="cb62-9"><a href="#cb62-9"></a>pipe.fit(X_train, y_train)</span>
<span id="cb62-10"><a href="#cb62-10"></a></span>
<span id="cb62-11"><a href="#cb62-11"></a><span class="co"># get the feature importance plot</span></span>
<span id="cb62-12"><a href="#cb62-12"></a>clf <span class="op">=</span> pipe[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb62-13"><a href="#cb62-13"></a>importances <span class="op">=</span> clf.feature_importances_</span>
<span id="cb62-14"><a href="#cb62-14"></a>features <span class="op">=</span> clf.feature_names_in_</span>
<span id="cb62-15"><a href="#cb62-15"></a></span>
<span id="cb62-16"><a href="#cb62-16"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb62-17"><a href="#cb62-17"></a></span>
<span id="cb62-18"><a href="#cb62-18"></a>plt.title(<span class="st">'Feature Importances'</span>)</span>
<span id="cb62-19"><a href="#cb62-19"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices], color<span class="op">=</span><span class="st">'b'</span>, align<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb62-20"><a href="#cb62-20"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), [features[i] <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb62-21"><a href="#cb62-21"></a>plt.xlabel(<span class="st">'Relative Importance'</span>)</span>
<span id="cb62-22"><a href="#cb62-22"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'RandomForestClassifier' object has no attribute 'feature_names_in_'</code></pre>
</div>
</div>
<p>No feature names were passed to our classifier this time and it is missing <code>feature_names_in_</code> attribute. We can circumvent this and still get feature importance plot.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb64-2"><a href="#cb64-2"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb64-3"><a href="#cb64-3"></a>                    <span class="co"># ("dataframer", dataframer),</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>                    (<span class="st">'rf_estimator'</span>, RandomForestClassifier())</span>
<span id="cb64-5"><a href="#cb64-5"></a></span>
<span id="cb64-6"><a href="#cb64-6"></a>                ])</span>
<span id="cb64-7"><a href="#cb64-7"></a></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="co"># fit the pipeline</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>pipe.fit(X_train, y_train)</span>
<span id="cb64-10"><a href="#cb64-10"></a></span>
<span id="cb64-11"><a href="#cb64-11"></a><span class="co"># get the feature importance plot</span></span>
<span id="cb64-12"><a href="#cb64-12"></a>clf <span class="op">=</span> pipe[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb64-13"><a href="#cb64-13"></a>importances <span class="op">=</span> clf.feature_importances_</span>
<span id="cb64-14"><a href="#cb64-14"></a><span class="co"># features = clf.feature_names_in_</span></span>
<span id="cb64-15"><a href="#cb64-15"></a></span>
<span id="cb64-16"><a href="#cb64-16"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb64-17"><a href="#cb64-17"></a></span>
<span id="cb64-18"><a href="#cb64-18"></a>plt.title(<span class="st">'Feature Importances'</span>)</span>
<span id="cb64-19"><a href="#cb64-19"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices], color<span class="op">=</span><span class="st">'b'</span>, align<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb64-20"><a href="#cb64-20"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), [i <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb64-21"><a href="#cb64-21"></a>plt.xlabel(<span class="st">'Relative Importance'</span>)</span>
<span id="cb64-22"><a href="#cb64-22"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-03-04-sklearn-pipeline-deep-dive_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This time we get the same plot but not withOUT feature names, and it is not useful anymore. So definitely we need to keep the feature names with the final estimator. Feature names can help us a lot in interpreting the model.</p>
</section>
<section id="the-complete-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="the-complete-pipeline">The complete Pipeline</h2>
<p>For an easy reference, let’s put the whole pipeline in one place. ### Load Data</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_openml</span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-4"><a href="#cb65-4"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb65-5"><a href="#cb65-5"></a></span>
<span id="cb65-6"><a href="#cb65-6"></a>np.random.seed(<span class="dv">42</span>) <span class="co"># for consistency</span></span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a>X, y <span class="op">=</span> fetch_openml(<span class="st">"titanic"</span>, version<span class="op">=</span><span class="dv">1</span>, as_frame<span class="op">=</span><span class="va">True</span>, return_X_y<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-9"><a href="#cb65-9"></a></span>
<span id="cb65-10"><a href="#cb65-10"></a>X.drop([<span class="st">'body'</span>, <span class="st">'cabin'</span>, <span class="st">'boat'</span>, <span class="st">'home.dest'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-11"><a href="#cb65-11"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, stratify<span class="op">=</span>y, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb65-12"><a href="#cb65-12"></a>X_train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>999</th>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>female</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>7.7500</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>392</th>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>female</td>
      <td>24.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>27.7208</td>
      <td>C</td>
    </tr>
    <tr>
      <th>628</th>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>female</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>31.2750</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1165</th>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>male</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>7.2250</td>
      <td>C</td>
    </tr>
    <tr>
      <th>604</th>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>female</td>
      <td>16.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>7.6500</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="train-model" class="level3">
<h3 class="anchored" data-anchor-id="train-model">Train Model</h3>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, FunctionTransformer, StandardScaler</span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb66-5"><a href="#cb66-5"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb66-6"><a href="#cb66-6"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb66-8"><a href="#cb66-8"></a></span>
<span id="cb66-9"><a href="#cb66-9"></a><span class="kw">class</span> FamilyFeatureTransformer(BaseEstimator, TransformerMixin):</span>
<span id="cb66-10"><a href="#cb66-10"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb66-11"><a href="#cb66-11"></a>        <span class="cf">pass</span></span>
<span id="cb66-12"><a href="#cb66-12"></a>       </span>
<span id="cb66-13"><a href="#cb66-13"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb66-14"><a href="#cb66-14"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb66-15"><a href="#cb66-15"></a>    </span>
<span id="cb66-16"><a href="#cb66-16"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb66-17"><a href="#cb66-17"></a>        X[<span class="st">'family_size'</span>] <span class="op">=</span> X[<span class="st">'parch'</span>] <span class="op">+</span> X[<span class="st">'sibsp'</span>]</span>
<span id="cb66-18"><a href="#cb66-18"></a>        X.drop([<span class="st">'parch'</span>, <span class="st">'sibsp'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># we can drop this feature now</span></span>
<span id="cb66-19"><a href="#cb66-19"></a>        X[<span class="st">'is_alone'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb66-20"><a href="#cb66-20"></a>        X.loc[X[<span class="st">'family_size'</span>] <span class="op">&gt;</span> <span class="dv">1</span>, <span class="st">'is_alone'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb66-21"><a href="#cb66-21"></a>        <span class="cf">return</span> X</span>
<span id="cb66-22"><a href="#cb66-22"></a>    </span>
<span id="cb66-23"><a href="#cb66-23"></a>    <span class="kw">def</span> get_feature_names_out(<span class="va">self</span>, input_features<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb66-24"><a href="#cb66-24"></a>        <span class="co"># this time we have created new features. Their names are different from input features.</span></span>
<span id="cb66-25"><a href="#cb66-25"></a>        <span class="co"># so we have explicitly mentioned them here.</span></span>
<span id="cb66-26"><a href="#cb66-26"></a>        <span class="cf">return</span> [<span class="st">'family_size'</span>, <span class="st">'is_alone'</span>]</span>
<span id="cb66-27"><a href="#cb66-27"></a></span>
<span id="cb66-28"><a href="#cb66-28"></a><span class="kw">class</span> SimpleImputerCustom(BaseEstimator, TransformerMixin):</span>
<span id="cb66-29"><a href="#cb66-29"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, strategy<span class="op">=</span><span class="st">'mean'</span>):</span>
<span id="cb66-30"><a href="#cb66-30"></a>        <span class="va">self</span>.strategy <span class="op">=</span> strategy</span>
<span id="cb66-31"><a href="#cb66-31"></a>        <span class="va">self</span>.imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="va">self</span>.strategy)</span>
<span id="cb66-32"><a href="#cb66-32"></a>       </span>
<span id="cb66-33"><a href="#cb66-33"></a>        </span>
<span id="cb66-34"><a href="#cb66-34"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb66-35"><a href="#cb66-35"></a>        <span class="va">self</span>.imputer.fit(X, y)</span>
<span id="cb66-36"><a href="#cb66-36"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb66-37"><a href="#cb66-37"></a>    </span>
<span id="cb66-38"><a href="#cb66-38"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb66-39"><a href="#cb66-39"></a>        <span class="cf">return</span> <span class="va">self</span>.imputer.transform(X)</span>
<span id="cb66-40"><a href="#cb66-40"></a>    </span>
<span id="cb66-41"><a href="#cb66-41"></a>    <span class="kw">def</span> get_feature_names_out(<span class="va">self</span>, input_features<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb66-42"><a href="#cb66-42"></a>        <span class="co"># we have returned the input features name as out features will have the same name</span></span>
<span id="cb66-43"><a href="#cb66-43"></a>        <span class="cf">return</span> input_features</span>
<span id="cb66-44"><a href="#cb66-44"></a></span>
<span id="cb66-45"><a href="#cb66-45"></a><span class="kw">def</span> get_dataframe(X, transformer):</span>
<span id="cb66-46"><a href="#cb66-46"></a>    <span class="co">""" </span></span>
<span id="cb66-47"><a href="#cb66-47"></a><span class="co">    x: an nd-array</span></span>
<span id="cb66-48"><a href="#cb66-48"></a><span class="co">    transformer: fitted transformer</span></span>
<span id="cb66-49"><a href="#cb66-49"></a><span class="co">    """</span></span>
<span id="cb66-50"><a href="#cb66-50"></a>    col_names <span class="op">=</span> transformer.get_feature_names_out()</span>
<span id="cb66-51"><a href="#cb66-51"></a>    output <span class="op">=</span> pd.DataFrame(X.T, col_names).T</span>
<span id="cb66-52"><a href="#cb66-52"></a>    <span class="cf">return</span> output</span>
<span id="cb66-53"><a href="#cb66-53"></a>    </span>
<span id="cb66-54"><a href="#cb66-54"></a>numeric_features <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"fare"</span>]</span>
<span id="cb66-55"><a href="#cb66-55"></a>numeric_transformer <span class="op">=</span> Pipeline(</span>
<span id="cb66-56"><a href="#cb66-56"></a>    steps<span class="op">=</span>[</span>
<span id="cb66-57"><a href="#cb66-57"></a>            (<span class="st">"imputer"</span>, SimpleImputerCustom(strategy<span class="op">=</span><span class="st">'mean'</span>)),</span>
<span id="cb66-58"><a href="#cb66-58"></a>            (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb66-59"><a href="#cb66-59"></a>             ]</span>
<span id="cb66-60"><a href="#cb66-60"></a>)</span>
<span id="cb66-61"><a href="#cb66-61"></a></span>
<span id="cb66-62"><a href="#cb66-62"></a>categorical_features <span class="op">=</span> [<span class="st">"sex"</span>]</span>
<span id="cb66-63"><a href="#cb66-63"></a>categorical_transformer <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb66-64"><a href="#cb66-64"></a></span>
<span id="cb66-65"><a href="#cb66-65"></a>family_features <span class="op">=</span> [<span class="st">"parch"</span>, <span class="st">"sibsp"</span>]</span>
<span id="cb66-66"><a href="#cb66-66"></a>family_transformer <span class="op">=</span> FamilyFeatureTransformer()</span>
<span id="cb66-67"><a href="#cb66-67"></a></span>
<span id="cb66-68"><a href="#cb66-68"></a>preprocessor <span class="op">=</span> make_column_transformer(</span>
<span id="cb66-69"><a href="#cb66-69"></a>        (numeric_transformer, numeric_features), </span>
<span id="cb66-70"><a href="#cb66-70"></a>        (categorical_transformer, categorical_features),</span>
<span id="cb66-71"><a href="#cb66-71"></a>        (family_transformer, family_features),</span>
<span id="cb66-72"><a href="#cb66-72"></a>        remainder<span class="op">=</span><span class="st">'drop'</span>, <span class="co"># let's drop extra features this time</span></span>
<span id="cb66-73"><a href="#cb66-73"></a>    verbose_feature_names_out<span class="op">=</span><span class="va">False</span></span>
<span id="cb66-74"><a href="#cb66-74"></a>)</span>
<span id="cb66-75"><a href="#cb66-75"></a></span>
<span id="cb66-76"><a href="#cb66-76"></a>dataframer <span class="op">=</span> FunctionTransformer(func<span class="op">=</span>get_dataframe, kw_args<span class="op">=</span>{<span class="st">"transformer"</span>: preprocessor})</span>
<span id="cb66-77"><a href="#cb66-77"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb66-78"><a href="#cb66-78"></a>                    (<span class="st">"preprocess"</span>, preprocessor),</span>
<span id="cb66-79"><a href="#cb66-79"></a>                    (<span class="st">"dataframer"</span>, dataframer),</span>
<span id="cb66-80"><a href="#cb66-80"></a>                    (<span class="st">'rf_estimator'</span>, RandomForestClassifier())</span>
<span id="cb66-81"><a href="#cb66-81"></a></span>
<span id="cb66-82"><a href="#cb66-82"></a>                ])</span>
<span id="cb66-83"><a href="#cb66-83"></a></span>
<span id="cb66-84"><a href="#cb66-84"></a>pipe.fit(X_train, y_train)</span>
<span id="cb66-85"><a href="#cb66-85"></a>y_pred <span class="op">=</span> pipe.predict(X_test)</span>
<span id="cb66-86"><a href="#cb66-86"></a>accuracy_score(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.8015267175572519</code></pre>
</div>
</div>
</section>
<section id="plot-feature-importance" class="level3">
<h3 class="anchored" data-anchor-id="plot-feature-importance">Plot Feature Importance</h3>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb68-2"><a href="#cb68-2"></a></span>
<span id="cb68-3"><a href="#cb68-3"></a>clf <span class="op">=</span> pipe[<span class="op">-</span><span class="dv">1</span>] <span class="co"># last estimator is the RF classifier</span></span>
<span id="cb68-4"><a href="#cb68-4"></a>importances <span class="op">=</span> clf.feature_importances_</span>
<span id="cb68-5"><a href="#cb68-5"></a>features <span class="op">=</span> clf.feature_names_in_</span>
<span id="cb68-6"><a href="#cb68-6"></a></span>
<span id="cb68-7"><a href="#cb68-7"></a>indices <span class="op">=</span> np.argsort(importances)</span>
<span id="cb68-8"><a href="#cb68-8"></a></span>
<span id="cb68-9"><a href="#cb68-9"></a>plt.title(<span class="st">'Feature Importances'</span>)</span>
<span id="cb68-10"><a href="#cb68-10"></a>plt.barh(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices], color<span class="op">=</span><span class="st">'b'</span>, align<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb68-11"><a href="#cb68-11"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), [features[i] <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb68-12"><a href="#cb68-12"></a>plt.xlabel(<span class="st">'Relative Importance'</span>)</span>
<span id="cb68-13"><a href="#cb68-13"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-03-04-sklearn-pipeline-deep-dive_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="pickle-test" class="level3">
<h3 class="anchored" data-anchor-id="pickle-test">Pickle Test</h3>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="im">from</span> sklearn <span class="im">import</span> set_config</span>
<span id="cb69-2"><a href="#cb69-2"></a>set_config(display<span class="op">=</span><span class="st">"diagram"</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="im">import</span> pickle</span>
<span id="cb69-5"><a href="#cb69-5"></a></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="co"># save our pipeline</span></span>
<span id="cb69-7"><a href="#cb69-7"></a>s1 <span class="op">=</span> pickle.dumps(pipe)</span>
<span id="cb69-8"><a href="#cb69-8"></a></span>
<span id="cb69-9"><a href="#cb69-9"></a><span class="co"># reload it</span></span>
<span id="cb69-10"><a href="#cb69-10"></a>s2 <span class="op">=</span> pickle.loads(s1)</span>
<span id="cb69-11"><a href="#cb69-11"></a>s2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<style>#sk-561aebda-eb81-4234-8134-ac945ae0df01 {color: black;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 pre{padding: 0;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable {background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator:hover {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-item {z-index: 1;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:only-child::after {width: 0;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-text-repr-fallback {display: none;}</style><div id="sk-561aebda-eb81-4234-8134-ac945ae0df01" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ce161ee7-57d7-4081-bf25-e6fc94b1e0d0" type="checkbox"><label for="ce161ee7-57d7-4081-bf25-e6fc94b1e0d0" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7113a6a8-63db-403d-8c92-759f9c794fce" type="checkbox"><label for="7113a6a8-63db-403d-8c92-759f9c794fce" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputerCustom()),
                                                 ('scaler', StandardScaler())]),
                                 ['age', 'fare']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['sex']),
                                ('familyfeaturetransformer',
                                 FamilyFeatureTransformer(),
                                 ['parch', 'sibsp'])],
                  verbose_feature_names_out=False)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5920ba7f-d5c9-4979-8dda-eb0ae3c2db59" type="checkbox"><label for="5920ba7f-d5c9-4979-8dda-eb0ae3c2db59" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7e025bdd-c9ff-49d9-bee8-cc643b14d053" type="checkbox"><label for="7e025bdd-c9ff-49d9-bee8-cc643b14d053" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputerCustom</label><div class="sk-toggleable__content"><pre>SimpleImputerCustom()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ac2cc19d-8e5b-4005-b3d4-2d9972dd075c" type="checkbox"><label for="ac2cc19d-8e5b-4005-b3d4-2d9972dd075c" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="302e430e-5d2f-44e2-a797-7c92d40a6f84" type="checkbox"><label for="302e430e-5d2f-44e2-a797-7c92d40a6f84" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e1eef113-4e5f-4f60-8b2d-f2698e9a0f6d" type="checkbox"><label for="e1eef113-4e5f-4f60-8b2d-f2698e9a0f6d" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fedcce1a-e1b1-497e-826a-e23991cd9301" type="checkbox"><label for="fedcce1a-e1b1-497e-826a-e23991cd9301" class="sk-toggleable__label sk-toggleable__label-arrow">familyfeaturetransformer</label><div class="sk-toggleable__content"><pre>['parch', 'sibsp']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="394e3193-4df5-4f05-8acd-f0e5fccd524e" type="checkbox"><label for="394e3193-4df5-4f05-8acd-f0e5fccd524e" class="sk-toggleable__label sk-toggleable__label-arrow">FamilyFeatureTransformer</label><div class="sk-toggleable__content"><pre>FamilyFeatureTransformer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="57a500e9-b6cc-4e50-b227-45c7f27b2b54" type="checkbox"><label for="57a500e9-b6cc-4e50-b227-45c7f27b2b54" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161997DF3A0&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                             Pipeline(steps=[('imputer',
                                                                                              SimpleImputerCustom()),
                                                                                             ('scaler',
                                                                                              StandardScaler())]),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(handle_unknown='ignore'),
                                                                             ['sex']),
                                                                            ('familyfeaturetransformer',
                                                                             FamilyFeatureTransformer(),
                                                                             ['parch',
                                                                              'sibsp'])],
                                                              verbose_feature_names_out=False)})</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="91e95626-95a2-491b-97e1-526e185c50b4" type="checkbox"><label for="91e95626-95a2-491b-97e1-526e185c50b4" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div></div></div></div></div></div></div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="hassaanbinaslam/myblog_utterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>